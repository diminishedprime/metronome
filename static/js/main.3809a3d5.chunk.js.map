{"version":3,"sources":["click.wav","Tuner.tsx","TempoMarking.tsx","hooks.ts","Common.tsx","TimeSignature.tsx","metronome.ts","TapIn.tsx","SubDivisions.tsx","Dial.tsx","types.ts","Scales.tsx","serviceWorker.ts","App.tsx","index.tsx"],"names":["module","exports","__webpack_require__","p","markings","name","range","fromBPM","bpm","filter","_ref3","_ref","test","_ref2","Object","slicedToArray","from","to","inRange","TempoMarking","_ref4","react_default","a","createElement","style","minHeight","map","_ref5","idx","key","className","useLocalStorage","initialValue","override","arguments","length","undefined","_useState","useState","firstValue","fromLocal","localStorage","getItem","Function","JSON","parse","window","setItem","stringify","_useState2","value","setValue","useCallback","valueAction","oldValue","newValue","useToggle","sideEffect","toggleState","_useState3","_useState4","old","Button","_ref$classes","classes","children","props","objectWithoutProperties","concat","join","allProps","assign","Buttons","_ref2$classes","TimeSignature","setSignature","numerator","signature","currentBeat","_useToggle","_useToggle2","edit","toggleEdit","set","denominator","Fragment","marginTop","onClick","R","beat","bg","Common_Button","click","require","scheduleNote","audioContext","time","gain","buffer","pitch","sound","createBufferSource","detune","volume","createGain","connect","destination","start","beatsFor","startOfBeatTime","secondsPerBeat","divisions","on","noteOffset","division","useScheduleAhead","playing","schedulerState","setNextBeatTime","scheduleAhead","url","updateBuffer","useEffect","fetch","then","response","arrayBuffer","decodeAudioData","useAudioBuffer","nextNoteTimeRef","useRef","schedulerStateRef","dep","mutableRef","current","useMutable","delay","initialTime","currentTime","id","setInterval","nextNoteTime","_schedulerState$curre","subDivisions","schedule","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","subDivision","forEach","err","return","scheduleGroup","clearInterval","useDisplayUpdater","nextBeatTime","incCurrentBeat","nextBeatTimeRef","useLayoutEffect","useMutableLayout","animationFrame","tick","loop","now","nextBeat","requestAnimationFrame","cancelAnimationFrame","calculateBPM","tapTimes","Math","trunc","TapIn","setBPM","taps","setTaps","performance","newTaps","tap","SubDivisions","toggle","label","noteIdx","0","1","2","3","4","5","6","7","8","9","10","11","notes","i","j","base","pow","centsPerOctave","frequency","octave","note","push","Tuner","analyser","setAnalyser","setDataArray","_useState5","_useState6","sampleRate","setSampleRate","_useState7","_useState8","freq","setFreq","AudioContext","mediaDevices","navigator","getUserMedia","audio","thing","createAnalyser","fftSize","createMediaStreamSource","close","bufferLength","frequencyBinCount","dataArray","Float32Array","getFloatFrequencyData","_dataArray$reduce","reduce","b","maxIdx","resolution","_freqToPitch","low","high","lowPitch","highPitch","average","difference","cents","originalFrequency","freqToPitch","toFixed","Mode","Pitch","ScaleMode","Outer","styled","div","_templateObject","Inner","_templateObject2","ChildContainer","_templateObject3","InfiniKnob","_ref$size","size","addDiff","PI","radians","setRadions","radiansRef","mouseDown","setMouseDown","mouseDownRef","totalDiff","setTotalDiff","totalDiffRef","knobContainer","onMouseUp","_","addToBuffer","diff","abs","oldDiff","moveKnob","e","clientX","clientY","box","getBoundingClientRect","boxCenter","left","width","y","top","height","x","newRadians","atan2","onMouseMove","addEventListener","removeEventListener","sin","cos","ref","onMouseDown","preventDefault","onTouchMove","t0","changedTouches","getScaleByFilter","scalesDB","getScalesByFilter","scales","entries","lilMap","scale","initScalesDB","addScale","mode","pitchMap","known","learning","scaleFor","A","Major","B_Flat","B","C","D_Flat","D","E_Flat","E","F","G_Flat","G","A_Flat","Minor","ScalesGroup","toggleLearning","toggleKnown","Common_Buttons","LearnScales","_ref6","addBPM","reset","scaleMode","startMetronome","floor","random","shuffle","s","LEARNING","KNOWN","_ref7","scaleKeys","setScales","currentKey","maybeScale","nextScaleText","_ref8","alignSelf","fontWeight","display","marginBottom","marginRight","flexGrow","justifyContent","nu","slice","Scales","_ref9","stopMetronome","_useLocalStorage","_useLocalStorage2","setScalesDB","NOT_STARTED","setScaleMode","_ref10","_ref11","disabled","Scales_ScalesGroup","Scales_LearnScales","_ref12","n","isLocalhost","Boolean","location","hostname","match","register","config","URL","process","href","origin","swUrl","contentType","headers","get","status","indexOf","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","console","log","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","error","bpmL","signatureL","makeInitialState","Metronome","setPlaying","setAudioContext","_useLocalStorage2$","_useLocalStorage2$$sc","setState","_useMetronome","setCurrentBeat","oldBeat","newBeat","useMetronome","_useMetronome2","showScales","toggleScales","_useToggle3","_useToggle4","showTuner","toggleTuner","updateAvailable","setUpdateAvailable","_useToggle5","_useToggle6","showDial","toggleDial","maxWidth","margin","paddingLeft","paddingRight","src_TimeSignature","Dial","over","src_TempoMarking","src_SubDivisions","divisionIdx","src_TapIn","src_Scales","src_Tuner","paddingTop","App","App_Metronome","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.3809a3d5.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/click.b48ed3e5.wav\";","import React, { useEffect, useState, useRef, useLayoutEffect } from \"react\";\n\nconst noteIdx: { [note: number]: string } = {\n  0: \"A\",\n  1: \"Bb\",\n  2: \"B\",\n  3: \"C\",\n  4: \"Db\",\n  5: \"D\",\n  6: \"Eb\",\n  7: \"E\",\n  8: \"F\",\n  9: \"Gb\",\n  10: \"G\",\n  11: \"Ab\"\n};\n\nconst A4 = 440;\nconst notes: Array<{\n  octave: number;\n  note: string;\n  frequency: number;\n  centsPerOctave: number;\n}> = [];\nfor (let i = -4; i < 4; i++) {\n  for (let j = 0; j < 12; j++) {\n    const base = A4 * Math.pow(2, i);\n    const centsPerOctave = base / 1200;\n    const frequency = base * Math.pow(2, j / 12);\n    const octave = i + 4;\n    const note = noteIdx[j];\n    notes.push({ octave, note, frequency, centsPerOctave });\n  }\n}\n\nconst freqToPitch = (freq: number) => {\n  let low = 0;\n  for (let i = 0; i < notes.length; i++) {\n    let note = notes[i];\n    if (note.frequency >= freq) {\n      low = i;\n      break;\n    }\n  }\n  const high = low + 1;\n  const lowPitch = notes[low];\n  const highPitch = notes[high];\n  const average = (lowPitch.frequency + highPitch.frequency) / 2;\n  let note = notes[high];\n  let difference = note.frequency - freq;\n  if (freq < average) {\n    note = notes[low];\n  }\n  const cents = note.centsPerOctave * difference;\n  return Object.assign(note, { originalFrequency: freq, difference, cents });\n};\n\nconst Tuner = () => {\n  const [analyser, setAnalyser] = useState<AnalyserNode>();\n  const [, setDataArray] = useState();\n  const [sampleRate, setSampleRate] = useState<number>();\n  const [freq, setFreq] = useState<number>(440);\n\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n\n  useEffect(() => {\n    const audioContext = new AudioContext();\n    setSampleRate(audioContext.sampleRate);\n    const mediaDevices = navigator.mediaDevices;\n    if (mediaDevices) {\n      mediaDevices.getUserMedia({ audio: true }).then((thing: MediaStream) => {\n        const analyser = audioContext.createAnalyser();\n        // If this isn't big, I don't have very good frequency accuracy, and I\n        // can't change the sample rate because web audio sucks.\n        analyser.fftSize = 8192;\n        const mic = audioContext.createMediaStreamSource(thing);\n        mic.connect(analyser);\n        setAnalyser(analyser);\n      });\n    }\n    return () => {\n      audioContext.close();\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    let animationFrame: number;\n\n    const tick = () => {\n      const bufferLength = analyser!.frequencyBinCount;\n      const dataArray = new Float32Array(bufferLength);\n      analyser!.getFloatFrequencyData(dataArray);\n      setDataArray(dataArray);\n\n      const [, maxIdx] = dataArray.reduce(\n        (a, b, i) => (a[0] < b ? [b, i] : a),\n        [-Infinity, -1]\n      );\n\n      const resolution = sampleRate! / analyser!.fftSize;\n      const freq = resolution * maxIdx;\n      setFreq(freq);\n\n      loop();\n    };\n\n    const loop = () => {\n      animationFrame = requestAnimationFrame(tick);\n    };\n\n    if (analyser !== undefined) {\n      loop();\n      return () => {\n        cancelAnimationFrame(animationFrame);\n      };\n    }\n  }, [analyser, sampleRate]);\n\n  const { octave, note, cents } = freqToPitch(freq || 0);\n  return (\n    <div className=\"box\">\n      <div className=\"has-text-centered\">\n        <div className=\"is-size-1\">{note + octave}</div>\n        <div>\n          {cents.toFixed(2)} Cents {cents < 0 ? \"flat\" : \"sharp\"}\n        </div>\n      </div>\n      {false && <canvas width={\"100%\"} height={\"100\"} ref={canvasRef} />}\n    </div>\n  );\n};\n\nexport default Tuner;\n","import React from \"react\";\n\ninterface Marking {\n  range: [number, number];\n  name: string;\n}\n\nexport const markings: Array<Marking> = [\n  { name: \"Larghissimo\", range: [0, 24] },\n  { name: \"Grave\", range: [25, 45] },\n  { name: \"Largo\", range: [40, 60] },\n  { name: \"Lento\", range: [45, 60] },\n  { name: \"Larghetto\", range: [60, 66] },\n  { name: \"Adagio\", range: [66, 76] },\n  { name: \"Andante\", range: [76, 108] },\n  { name: \"Marcia moderato\", range: [83, 85] },\n  { name: \"Andante moderato\", range: [92, 112] },\n  { name: \"Moderato\", range: [108, 120] },\n  { name: \"Allegro\", range: [120, 156] },\n  { name: \"Vivace\", range: [156, 176] },\n  { name: \"Vivacissimo\", range: [172, 176] },\n  { name: \"Allegrissimo\", range: [172, 176] },\n  { name: \"Presto\", range: [168, 200] },\n  { name: \"Prestissimo\", range: [200, 250] }\n];\n\nconst inRange = ([from, to]: [number, number], test: number) => {\n  return test >= from && test <= to;\n};\n\nconst fromBPM = (bpm: number): Array<Marking> => {\n  return markings.filter(({ range }) => inRange(range, bpm));\n};\n\ninterface Props {\n  bpm: number;\n}\n\nconst TempoMarking = ({ bpm }: Props) => {\n  const markings = fromBPM(bpm);\n  return (\n      <div style={{minHeight: '6.5em'}}>\n          {markings.map(({ name, range }, idx) => (\n              <div key={idx} className=\"has-text-centered\">\n                  {name} - {range[0]} - {range[1]}\n              </div>\n          ))}\n              </div>\n  );\n};\n\nexport default TempoMarking;\n","import { useState, Dispatch, SetStateAction, useCallback } from \"react\";\n\nexport const useLocalStorage = <T>(\n  key: string,\n  initialValue: T | (() => T),\n  override: boolean = false\n): [T, Dispatch<SetStateAction<T>>] => {\n  const [value, setValue] = useState(() => {\n    let firstValue;\n    const fromLocal = localStorage.getItem(key);\n    if (fromLocal !== null && fromLocal !== undefined && !override) {\n      firstValue = JSON.parse(fromLocal);\n    } else {\n      firstValue =\n        initialValue instanceof Function ? initialValue() : initialValue;\n    }\n    window.localStorage.setItem(key, JSON.stringify(firstValue));\n    return firstValue;\n  });\n\n  const setNewValue: Dispatch<SetStateAction<T>> = useCallback(\n    (valueAction: SetStateAction<T>) => {\n      setValue((oldValue: T) => {\n        const newValue =\n          valueAction instanceof Function ? valueAction(oldValue) : valueAction;\n        window.localStorage.setItem(key, JSON.stringify(newValue));\n        return newValue;\n      });\n    },\n    [key]\n  );\n\n  return [value, setNewValue];\n};\n\nexport const useToggle = (\n  initialValue: boolean,\n  sideEffect = (toggleState: boolean) => {}\n): [boolean, () => void] => {\n  const [value, setValue] = useState(initialValue);\n  const toggle = () =>\n    setValue((old: boolean) => {\n      const newValue = !old;\n      sideEffect(newValue);\n      return newValue;\n    });\n  return [value, toggle];\n};\n","import React from \"react\";\n\ninterface ButtonProps\n  extends React.DetailedHTMLProps<\n    React.ButtonHTMLAttributes<HTMLButtonElement>,\n    HTMLButtonElement\n  > {\n  classes?: string[];\n}\n\nexport const Button = ({ classes = [], children, ...props }: ButtonProps) => {\n  const className = `button ${classes.join(\" \")}`;\n  const allProps = Object.assign(props, { className });\n  return <button {...allProps}>{children}</button>;\n};\n\ninterface ButtonsProps\n  extends React.DetailedHTMLProps<\n    React.HTMLAttributes<HTMLDivElement>,\n    HTMLDivElement\n  > {\n  classes?: string[];\n}\n\nexport const Buttons = ({ classes = [], children, ...props }: ButtonsProps) => {\n  const className = `buttons has-addons ${classes.join(\" \")}`;\n  const allProps = Object.assign(props, { className });\n  return <div {...allProps}>{children}</div>;\n};\n","import React from \"react\";\nimport * as R from \"ramda\";\nimport { Signature } from \"./types\";\nimport { useToggle } from \"./hooks\";\nimport { Button } from \"./Common\";\n\ninterface Props {\n  signature: Signature;\n  currentBeat: number | undefined;\n  setSignature: (s: Signature) => void;\n}\n\nconst TimeSignature = ({\n  setSignature,\n  signature: { numerator },\n  currentBeat\n}: Props) => {\n  const [edit, toggleEdit] = useToggle(false);\n  const set = (numerator: number, denominator = 4) => () => {\n    setSignature({ numerator, denominator });\n    toggleEdit();\n  };\n  return (\n    <>\n      <section\n        style={{ marginTop: \"10px\" }}\n        className=\"section is-mobile columns\"\n        onClick={toggleEdit}\n      >\n        {R.range(0, numerator).map((beat: number) => {\n          const bg =\n            beat === currentBeat\n              ? \"has-background-primary\"\n              : \"has-background-light\";\n          return (\n            <div\n              className={`column margin-sm has-text-centered ${bg}`}\n              key={beat}\n            >\n              {beat + 1}\n            </div>\n          );\n        })}\n      </section>\n      {edit && (\n        <section className=\"section buttons is-centered\">\n          <Button onClick={set(2)}>2/4</Button>\n          <Button onClick={set(3)}>3/4</Button>\n          <Button onClick={set(4)}>4/4</Button>\n          <Button onClick={set(5)}>5/4</Button>\n        </section>\n      )}\n    </>\n  );\n};\n\nexport default TimeSignature;\n","import {\n  useEffect,\n  useRef,\n  useLayoutEffect,\n  useState,\n  useCallback,\n  MutableRefObject,\n  Dispatch,\n  SetStateAction\n} from \"react\";\nimport { Beat, SchedulerState, SubDivision } from \"./types\";\nimport * as R from \"ramda\";\nconst click = require(\"./click.wav\");\n\nconst scheduleNote = (\n  audioContext: AudioContext,\n  { time, gain, buffer, pitch }: Beat\n) => {\n  const sound = audioContext.createBufferSource();\n  sound.buffer = buffer;\n  sound.detune.value = -pitch;\n\n  const volume = audioContext.createGain();\n  volume.gain.value = gain;\n\n  sound.connect(volume);\n  volume.connect(audioContext.destination);\n\n  sound.start(time);\n};\n\nconst beatsFor = (\n  startOfBeatTime: number,\n  secondsPerBeat: number,\n  { divisions, on, pitch, gain }: SubDivision,\n  buffer: AudioBuffer\n): Array<Beat> => {\n  if (on) {\n    const noteOffset = secondsPerBeat / divisions;\n\n    return R.range(1, divisions).map(division => {\n      const time = startOfBeatTime + division * noteOffset;\n      return { time, pitch, gain: gain * 0.5, buffer };\n    });\n  }\n  return [];\n};\n\nconst scheduleGroup = (\n  nextNoteTime: MutableRefObject<number>,\n  schedulerState: MutableRefObject<SchedulerState>,\n  buffer: AudioBuffer | undefined,\n  setNextBeatTime: (time: number) => void,\n  audioContext: AudioContext\n) => {\n  const { bpm, subDivisions, scheduleAhead } = schedulerState.current;\n  const secondsPerBeat = 60.0 / bpm;\n  const schedule = (beat: Beat) => {\n    scheduleNote(audioContext, beat);\n  };\n  while (nextNoteTime.current < audioContext.currentTime + scheduleAhead) {\n    // Quarter Note\n    scheduleNote(audioContext, {\n      time: nextNoteTime.current,\n      pitch: 0,\n      gain: 0.5,\n      buffer: buffer!\n    });\n    setNextBeatTime(nextNoteTime.current);\n    // Adds the scheduled note so the gui can refresh at the right time.\n    // Subdivisions\n    for (const subDivision of subDivisions) {\n      const beats = beatsFor(\n        nextNoteTime.current,\n        secondsPerBeat,\n        subDivision,\n        buffer!\n      );\n      beats.forEach(schedule);\n    }\n    nextNoteTime.current += secondsPerBeat;\n  }\n};\n\nconst useAudioBuffer = (\n  audioContext: AudioContext | undefined,\n  url: string\n): AudioBuffer | undefined => {\n  const [buffer, updateBuffer] = useState<AudioBuffer>();\n  useEffect(() => {\n    if (audioContext !== undefined) {\n      fetch(url)\n        .then(response => response.arrayBuffer())\n        .then(buffer => audioContext.decodeAudioData(buffer))\n        .then(updateBuffer);\n    }\n  }, [url, audioContext]);\n  return buffer;\n};\n\nconst useMutableLayout = <T>(dep: T): MutableRefObject<T> => {\n  const mutableRef = useRef<T>(dep);\n  useLayoutEffect(() => {\n    mutableRef.current = dep;\n  }, [dep]);\n  return mutableRef;\n};\n\nconst useMutable = <T>(dep: T): MutableRefObject<T> => {\n  const mutableRef = useRef<T>(dep);\n  useEffect(() => {\n    mutableRef.current = dep;\n  }, [dep]);\n  return mutableRef;\n};\n\nconst useScheduleAhead = (\n  playing: boolean,\n  schedulerState: SchedulerState,\n  setNextBeatTime: (time: number) => void,\n  audioContext: AudioContext | undefined\n) => {\n  const { scheduleAhead } = schedulerState;\n  const buffer = useAudioBuffer(audioContext, click);\n  const nextNoteTimeRef = useRef<number>(0);\n  const schedulerStateRef = useMutable(schedulerState);\n  const delay = playing ? (scheduleAhead * 1000) / 2 : undefined;\n\n  useEffect(() => {\n    if (delay !== undefined && audioContext !== undefined) {\n      const initialTime = audioContext.currentTime + 0.1;\n      nextNoteTimeRef.current = initialTime;\n      const tick = () => {\n        scheduleGroup(\n          nextNoteTimeRef,\n          schedulerStateRef,\n          buffer,\n          setNextBeatTime,\n          audioContext\n        );\n      };\n      const id = setInterval(tick, delay);\n      return () => {\n        clearInterval(id);\n      };\n    }\n  }, [delay, buffer, schedulerStateRef, setNextBeatTime, audioContext]);\n};\n\nconst useDisplayUpdater = (\n  playing: boolean,\n  audioContext: AudioContext | undefined,\n  nextBeatTime: number | undefined,\n  setNextBeatTime: (time: number | undefined) => void,\n  incCurrentBeat: () => void\n) => {\n  const nextBeatTimeRef = useMutableLayout(nextBeatTime);\n\n  useLayoutEffect(() => {\n    if (audioContext !== undefined) {\n      let animationFrame: number;\n      const tick = () => {\n        loop();\n        const now = audioContext.currentTime;\n        const nextBeat = nextBeatTimeRef.current;\n        if (nextBeat !== undefined && now <= nextBeat) {\n          setNextBeatTime(undefined);\n          incCurrentBeat();\n        }\n      };\n\n      const loop = () => {\n        animationFrame = requestAnimationFrame(tick);\n      };\n\n      if (playing) {\n        loop();\n        return () => {\n          cancelAnimationFrame(animationFrame);\n        };\n      }\n    }\n  }, [playing, audioContext, incCurrentBeat, nextBeatTimeRef, setNextBeatTime]);\n};\n\nexport const useMetronome = (\n  playing: boolean,\n  schedulerState: SchedulerState,\n  audioContext: AudioContext | undefined\n): [number | undefined, Dispatch<SetStateAction<number | undefined>>] => {\n  // TODO - don't update if the tab is in the background\n  const [nextBeatTime, setNextBeatTime] = useState<number>();\n  const [currentBeat, setCurrentBeat] = useState<number | undefined>();\n  const {\n    signature: { numerator }\n  } = schedulerState;\n\n  const incCurrentBeat = useCallback(\n    () =>\n      setCurrentBeat(oldBeat => {\n        if (oldBeat === undefined) {\n          return 0;\n        }\n        let newBeat = oldBeat + 1;\n        if (oldBeat >= numerator - 1) {\n          newBeat = 0;\n        }\n        return newBeat;\n      }),\n    [numerator]\n  );\n\n  useScheduleAhead(playing, schedulerState, setNextBeatTime, audioContext);\n  useDisplayUpdater(\n    playing,\n    audioContext,\n    nextBeatTime,\n    setNextBeatTime,\n    incCurrentBeat\n  );\n\n  return [currentBeat, setCurrentBeat];\n};\n","import React, { useState } from \"react\";\nimport * as R from \"ramda\";\nimport { Button } from \"./Common\";\n\ninterface Props {\n  setBPM: (bpm: number) => void;\n}\n\nconst calculateBPM = R.pipe(\n  (tapTimes: number[]) => R.aperture(2, tapTimes),\n  R.map(([a, b]) => b - a),\n  R.mean,\n  R.divide(60000),\n  Math.trunc\n);\n\nconst TapIn = ({ setBPM }: Props) => {\n  const [taps, setTaps] = useState<number[]>([]);\n\n  const onTap = () => {\n    const now = performance.now();\n    const newTaps = R.append(now, taps).filter(tap => now - tap < 3000);\n    if (newTaps.length > 1) {\n      const bpm = calculateBPM(newTaps);\n      setBPM(bpm);\n    }\n    setTaps(newTaps);\n  };\n\n  return <Button onClick={onTap}>Tap In</Button>;\n};\n\nexport default TapIn;\n","import React from \"react\";\nimport { SubDivision } from \"./types\";\nimport { Button } from \"./Common\";\n\ntype Toggle = (idx: number) => void;\n\ninterface Props {\n  subDivisions: Array<SubDivision>;\n  toggle: Toggle;\n}\n\nconst SubDivisions = ({ subDivisions, toggle }: Props) => (\n  <>\n    {subDivisions.map(({ label, on }, idx) => (\n      <Button\n        classes={[on ? \"is-primary\" : \"\"]}\n        key={idx}\n        onClick={() => toggle(idx)}\n      >\n        {label}\n      </Button>\n    ))}\n  </>\n);\n\nexport default SubDivisions;\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport styled from \"styled-components\";\n\nconst Outer = styled.div`\n  margin: auto;\n  position: relative;\n  height: 300px;\n  width: 300px;\n  border-radius: 300px;\n  display: flex;\n  margin-bottom: 10px;\n`;\n\nconst Inner = styled.div`\n  width: 100px;\n  height: 100px;\n  border-radius: 100px;\n  position: absolute;\n  touch-action: none;\n`;\n\ninterface Props {\n  addDiff: (diff: number) => void;\n  size?: number;\n}\n\nconst InfiniKnob = ({\n  size = 300,\n  addDiff,\n  children\n}: Props &\n  React.DetailedHTMLProps<\n    React.HTMLAttributes<HTMLDivElement>,\n    HTMLDivElement\n  >) => {\n  const [radians, setRadions] = useState((Math.PI * 3) / 2);\n  const radiansRef = useRef(Math.PI);\n  useEffect(() => {\n    radiansRef.current = radians;\n  }, [radians]);\n\n  const [mouseDown, setMouseDown] = useState(false);\n  const mouseDownRef = useRef(false);\n  useEffect(() => {\n    mouseDownRef.current = mouseDown;\n  }, [mouseDown]);\n\n  const [totalDiff, setTotalDiff] = useState(0);\n  const totalDiffRef = useRef(0);\n  useEffect(() => {\n    totalDiffRef.current = totalDiff;\n  }, [totalDiff]);\n\n  const knobContainer = useRef<HTMLDivElement>(null);\n\n  const onMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\n    setMouseDown(true);\n    e.preventDefault();\n  };\n\n  const onMouseUp = useCallback((_: MouseEvent) => {\n    setMouseDown(false);\n  }, []);\n\n  const addToBuffer = useCallback(\n    (diff: number) => {\n      const threshold = 0.2;\n      if (Math.abs(totalDiffRef.current) < threshold) {\n        setTotalDiff(oldDiff => oldDiff + diff);\n      } else {\n        addDiff(totalDiffRef.current > 0 ? -1 : 1);\n        setTotalDiff(0);\n      }\n    },\n    [addDiff]\n  );\n\n  const moveKnob = useCallback(\n    (e: React.Touch | React.MouseEvent | MouseEvent) => {\n      const { clientX, clientY } = e;\n      const box = knobContainer.current!.getBoundingClientRect();\n\n      const boxCenter = {\n        x: box.left + box.width / 2,\n        y: box.top + box.height / 2\n      };\n      const y = -(boxCenter.y - clientY);\n      const x = -(boxCenter.x - clientX);\n      const newRadians = Math.atan2(y, x);\n      let diff = radiansRef.current - newRadians;\n      if (diff < -Math.PI) {\n        diff = -radiansRef.current - newRadians;\n      } else if (diff > Math.PI) {\n        diff = radiansRef.current - -newRadians;\n      }\n      if (diff !== 0) {\n        addToBuffer(diff);\n      }\n      const same = newRadians === radiansRef.current;\n      if (!same) {\n        setRadions(newRadians);\n      }\n    },\n    [addToBuffer]\n  );\n\n  const onMouseMove = useCallback(\n    (e: React.MouseEvent<HTMLDivElement> | MouseEvent) => {\n      if (mouseDownRef.current) {\n        moveKnob(e);\n      }\n    },\n    [moveKnob]\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"mouseup\", onMouseUp);\n    window.addEventListener(\"mousemove\", onMouseMove);\n    return () => {\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n    };\n  }, [onMouseMove, onMouseUp]);\n\n  const onTouchMove = (e: React.TouchEvent<HTMLDivElement>) => {\n    const t = e.changedTouches;\n    const t0 = t[0];\n    moveKnob(t0);\n  };\n\n  const top =\n    size / 2 +\n    Math.sin(radians) * (size / 4) +\n    (Math.sin(radians) * size) / 16 -\n    size / 6;\n  const left =\n    size / 2 +\n    Math.cos(radians) * (size / 4) +\n    (Math.cos(radians) * size) / 16 -\n    size / 6;\n\n  return (\n    <Outer ref={knobContainer} className=\"has-background-primary\">\n      <Inner\n        className=\"has-background-info\"\n        onMouseDown={onMouseDown}\n        onTouchMove={onTouchMove}\n        style={{\n          top,\n          left\n        }}\n      />\n      <ChildContainer>{children}</ChildContainer>\n    </Outer>\n  );\n};\n\nconst ChildContainer = styled.div`\n  align-self: center;\n  margin: auto;\n  z-index: 1;\n  pointer-events: none;\n`;\n\nexport default InfiniKnob;\n","export interface SubDivision {\n  on: boolean;\n  pitch: number;\n  divisions: number;\n  label: string;\n  gain: number;\n}\n\nexport interface Signature {\n  numerator: number;\n  denominator: number;\n}\n\nexport interface SchedulerState {\n  bpm: number;\n  subDivisions: Array<SubDivision>;\n  signature: Signature;\n  scheduleAhead: number;\n}\n\nexport interface Beat {\n  time: number;\n  pitch: number;\n  gain: number;\n  buffer: AudioBuffer;\n}\n\nexport enum Mode {\n  Major = \"Major\",\n  Minor = \"Minor\"\n}\n\nexport enum Pitch {\n  A = \"A\",\n  B_Flat = \"Bb\",\n  B = \"B\",\n  C = \"C\",\n  D_Flat = \"Db\",\n  D = \"D\",\n  E_Flat = \"Eb\",\n  E = \"E\",\n  F = \"F\",\n  G_Flat = \"Gb\",\n  G = \"G\",\n  A_Flat = \"Ab\"\n}\n\nexport interface Scale {\n  mode: Mode;\n  pitch: Pitch;\n  known: boolean;\n  learning: boolean;\n  bpm: number;\n}\n\nexport type ScalesDB = {\n  [pitch: string]: {\n    [mode: string]: Scale;\n  };\n}; // Map<Pitch, Map<Mode, Scale>>;\n","import React, { useEffect, useState } from \"react\";\n\nimport { useLocalStorage } from \"./hooks\";\nimport * as R from \"ramda\";\nimport { Button, Buttons } from \"./Common\";\nimport { Scale, Pitch, Mode, ScalesDB } from \"./types\";\n\nenum ScaleMode {\n  NOT_STARTED = \"Not Started\",\n  LEARNING = \"Learning\",\n  KNOWN = \"Known\"\n}\n\ninterface Props {\n  startMetronome: (bpm: number) => void;\n  stopMetronome: () => void;\n}\n\nconst getScaleByFilter = (\n  scalesDB: ScalesDB,\n  filter: (s: Scale) => boolean\n): Scale | undefined => {\n  return getScalesByFilter(scalesDB, filter)[0];\n};\n\nconst getScalesByFilter = (\n  scalesDB: ScalesDB,\n  filter: (s: Scale) => boolean\n) => {\n  let scales: Scale[] = [];\n  Object.entries(scalesDB).forEach(([, lilMap]) => {\n    Object.entries(lilMap).forEach(([, scale]) => {\n      if (filter(scale)) {\n        scales.push(scale);\n      }\n    });\n  });\n  return scales;\n};\n\nconst initScalesDB = (): ScalesDB => {\n  const scalesDB: ScalesDB = {};\n  const scaleFor = (pitch: Pitch, mode: Mode): Scale => ({\n    pitch,\n    mode,\n    known: false,\n    learning: false,\n    bpm: 60\n  });\n\n  const addScale = (pitch: Pitch, mode: Mode): void => {\n    let pitchMap = scalesDB[pitch];\n    if (pitchMap === undefined) {\n      pitchMap = {};\n      scalesDB[pitch] = pitchMap;\n    }\n    pitchMap[mode] = scaleFor(pitch, mode);\n  };\n  // TODO(me) - clean up scale names & add sharps.\n  // Major\n  addScale(Pitch.A, Mode.Major);\n  addScale(Pitch.B_Flat, Mode.Major);\n  addScale(Pitch.B, Mode.Major);\n  addScale(Pitch.C, Mode.Major);\n  addScale(Pitch.D_Flat, Mode.Major);\n  addScale(Pitch.D, Mode.Major);\n  addScale(Pitch.E_Flat, Mode.Major);\n  addScale(Pitch.E, Mode.Major);\n  addScale(Pitch.F, Mode.Major);\n  addScale(Pitch.G_Flat, Mode.Major);\n  addScale(Pitch.G, Mode.Major);\n  addScale(Pitch.A_Flat, Mode.Major);\n\n  // Minor\n  addScale(Pitch.A, Mode.Minor);\n  addScale(Pitch.B_Flat, Mode.Minor);\n  addScale(Pitch.B, Mode.Minor);\n  addScale(Pitch.C, Mode.Minor);\n  addScale(Pitch.D_Flat, Mode.Minor);\n  addScale(Pitch.D, Mode.Minor);\n  addScale(Pitch.E_Flat, Mode.Minor);\n  addScale(Pitch.E, Mode.Minor);\n  addScale(Pitch.F, Mode.Minor);\n  addScale(Pitch.G_Flat, Mode.Minor);\n  addScale(Pitch.G, Mode.Minor);\n  addScale(Pitch.A_Flat, Mode.Minor);\n  return scalesDB;\n};\n\nconst ScalesGroup = ({\n  pitch,\n  mode,\n  learning,\n  known,\n  toggleLearning,\n  toggleKnown\n}: Scale & { toggleLearning: () => void; toggleKnown: () => void }) => {\n  return (\n    <div className=\"is-grouped field has-addons\">\n      <div className=\"is-size-5 control is-expanded\">\n        {pitch} {mode}\n      </div>\n      <Buttons>\n        <Button classes={[known ? \"is-info\" : \"\"]} onClick={toggleKnown}>\n          Known\n        </Button>\n        <Button classes={[learning ? \"is-link\" : \"\"]} onClick={toggleLearning}>\n          Learning\n        </Button>\n      </Buttons>\n    </div>\n  );\n};\nfunction shuffle<T>(a: Array<T>) {\n  var j, x, i;\n  for (i = a.length - 1; i > 0; i--) {\n    j = Math.floor(Math.random() * (i + 1));\n    x = a[i];\n    a[i] = a[j];\n    a[j] = x;\n  }\n  return a;\n}\n\ninterface LearnScalesProps {\n  scalesDB: ScalesDB;\n  addBPM: (s: Scale, n: number) => () => void;\n  startMetronome: (bpm: number) => void;\n  reset: () => void;\n  scaleMode: ScaleMode;\n}\n\nconst LearnScales = ({\n  scalesDB,\n  addBPM,\n  reset,\n  scaleMode,\n  startMetronome\n}: LearnScalesProps) => {\n  const [scaleKeys, setScales] = useState<Array<[Mode, Pitch]>>(() =>\n    shuffle(\n      getScalesByFilter(scalesDB, s => {\n        if (scaleMode === ScaleMode.LEARNING) {\n          return s.learning;\n        } else if (scaleMode === ScaleMode.KNOWN) {\n          return s.known;\n        }\n        return false;\n      }).map(({ mode, pitch }) => [mode, pitch])\n    )\n  );\n  const nextScale = () => {\n    setScales(old => {\n      const nu = old.slice(1);\n      if (nu.length === 0) {\n        reset();\n      }\n      return nu;\n    });\n  };\n\n  const currentKey = scaleKeys[0] || [];\n  const maybeScale = getScaleByFilter(\n    scalesDB,\n    (s: Scale) => s.mode === currentKey[0] && s.pitch === currentKey[1]\n  );\n  useEffect(() => {\n    if (maybeScale !== undefined) {\n      startMetronome(maybeScale.bpm);\n    }\n  }, [maybeScale, startMetronome]);\n  const nextScaleText = scaleKeys.length > 1 ? \"Next Scale\" : \"Finish\";\n\n  // TODO - this error handling makes me sad, I should really do better.\n  if (scaleKeys.length === 0) {\n    return <div>No more scales</div>;\n  }\n  const scale = maybeScale!;\n  const { mode, pitch, bpm } = scale!;\n\n  return (\n    <div>\n      <div\n        style={{ alignSelf: \"center\", fontWeight: \"bold\" }}\n        className=\"control is-expanded is-size-5\"\n      >\n        {scaleMode}\n      </div>\n      <div style={{ display: \"flex\", marginBottom: \"5px\" }}>\n        <div style={{ alignSelf: \"center\", marginRight: \"10px\" }}>\n          {pitch} {mode} @ {bpm}bpm\n        </div>\n        <Buttons style={{ flexGrow: 1 }}>\n          <Button\n            classes={[\"is-danger\", \"is-outlined\"]}\n            style={{ flexGrow: 1 }}\n            onClick={addBPM(scale, -10)}\n          >\n            -10\n          </Button>\n          <Button\n            classes={[\"is-danger\", \"is-outlined\"]}\n            style={{ flexGrow: 1 }}\n            onClick={addBPM(scale, -1)}\n          >\n            -\n          </Button>\n          <Button\n            classes={[\"is-success\", \"is-outlined\"]}\n            style={{ flexGrow: 1 }}\n            onClick={addBPM(scale, 1)}\n          >\n            +\n          </Button>\n          <Button\n            classes={[\"is-success\", \"is-outlined\"]}\n            style={{ flexGrow: 1 }}\n            onClick={addBPM(scale, 10)}\n          >\n            +10\n          </Button>\n        </Buttons>\n      </div>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n        <Button onClick={reset}>Stop</Button>\n        <Button onClick={nextScale}>{nextScaleText}</Button>\n      </div>\n    </div>\n  );\n};\n\nconst Scales = ({ startMetronome, stopMetronome, ...props }: Props) => {\n  const [scalesDB, setScalesDB] = useLocalStorage(\n    \"@mjh/metronome/scales-db\",\n    initScalesDB\n  );\n\n  const [scaleMode, setScaleMode] = useState(ScaleMode.NOT_STARTED);\n\n  useEffect(() => {\n    if (scaleMode === ScaleMode.NOT_STARTED) {\n      stopMetronome();\n    }\n  }, [scaleMode, stopMetronome]);\n\n  const toggleLearning = ({ pitch, mode }: Scale) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"learning\"]), R.not));\n  };\n\n  const toggleKnown = ({ pitch, mode }: Scale) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"known\"]), R.not));\n  };\n\n  const addBPM = ({ pitch, mode }: Scale, n: number) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"bpm\"]), R.add(n)));\n  };\n\n  return (\n    <div className=\"box\" style={{ marginTop: \"10px\" }}>\n      {scaleMode === ScaleMode.NOT_STARTED ? (\n        <div style={{ marginBottom: \"5px\" }}>\n          <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n            <div\n              style={{ alignSelf: \"center\", fontWeight: \"bold\" }}\n              className=\"control is-expanded is-size-5\"\n            >\n              Scales\n            </div>\n            <Buttons>\n              <Button\n                onClick={() => setScaleMode(ScaleMode.KNOWN)}\n                disabled={\n                  getScaleByFilter(scalesDB, s => s.known) === undefined\n                }\n                classes={[\"is-info\", \"is-outlined\"]}\n              >\n                Start Known\n              </Button>\n              <Button\n                onClick={() => setScaleMode(ScaleMode.LEARNING)}\n                disabled={\n                  getScaleByFilter(scalesDB, s => s.learning) === undefined\n                }\n                classes={[\"is-link\", \"is-outlined\"]}\n              >\n                Start Learning\n              </Button>\n            </Buttons>\n          </div>\n          <hr />\n\n          {getScalesByFilter(scalesDB, s => s.mode === Mode.Major).map(\n            (scale: Scale) => (\n              <ScalesGroup\n                key={`${scale.pitch}-${scale.mode}`}\n                {...scale}\n                toggleLearning={toggleLearning(scale)}\n                toggleKnown={toggleKnown(scale)}\n              />\n            )\n          )}\n          <hr />\n          {getScalesByFilter(scalesDB, s => s.mode === Mode.Minor).map(\n            (scale: Scale) => (\n              <ScalesGroup\n                key={`${scale.pitch}-${scale.mode}`}\n                {...scale}\n                toggleLearning={toggleLearning(scale)}\n                toggleKnown={toggleKnown(scale)}\n              />\n            )\n          )}\n        </div>\n      ) : (\n        <LearnScales\n          scaleMode={scaleMode}\n          startMetronome={startMetronome}\n          addBPM={addBPM}\n          scalesDB={scalesDB}\n          reset={() => setScaleMode(ScaleMode.NOT_STARTED)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Scales;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React, { useEffect, useCallback } from \"react\";\nimport { useState } from \"react\";\nimport { over, set } from \"ramda\";\nimport * as R from \"ramda\";\nimport TempoMarking from \"./TempoMarking\";\nimport TimeSignature from \"./TimeSignature\";\nimport { SchedulerState, Signature } from \"./types\";\nimport { useMetronome } from \"./metronome\";\nimport TapIn from \"./TapIn\";\nimport SubDivisions from \"./SubDivisions\";\nimport Tuner from \"./Tuner\";\nimport Dial from \"./Dial\";\nimport Scales from \"./Scales\";\nimport { useLocalStorage, useToggle } from \"./hooks\";\nimport { Button, Buttons } from \"./Common\";\nimport * as serviceWorker from \"./serviceWorker\";\n\ninterface State {\n  schedulerState: SchedulerState;\n}\n\nconst subDivisionsL = (idx: number) =>\n  R.lensPath([\"schedulerState\", \"subDivisions\", idx, \"on\"]);\n\nconst bpmL = R.lensPath([\"schedulerState\", \"bpm\"]);\n\nconst signatureL = R.lensPath([\"schedulerState\", \"signature\"]);\n\nconst makeInitialState = (): State => ({\n  schedulerState: {\n    scheduleAhead: 0.2,\n    bpm: 120,\n    signature: {\n      numerator: 4,\n      denominator: 4\n    },\n    subDivisions: [\n      { on: false, pitch: 10, divisions: 2, label: \"2\", gain: 1.0 },\n      { on: false, pitch: 20, divisions: 3, label: \"3\", gain: 1.0 },\n      { on: false, pitch: 30, divisions: 4, label: \"4\", gain: 1.0 },\n      { on: false, pitch: 40, divisions: 5, label: \"5\", gain: 1.0 }\n      /* { on: false, pitch: 50, divisions: 6, label: \"6\", gain: 1.0 },\n       * { on: false, pitch: 60, divisions: 7, label: \"7\", gain: 1.0 },\n       * { on: false, pitch: 70, divisions: 8, label: \"8\", gain: 1.0 } */\n    ]\n  }\n});\n\nconst Metronome = () => {\n  const [playing, setPlaying] = useState(false);\n  const [audioContext, setAudioContext] = useState<AudioContext | undefined>();\n\n  useEffect(() => {\n    if (playing) {\n      setAudioContext(new AudioContext());\n    }\n  }, [playing]);\n\n  const [\n    {\n      schedulerState,\n      schedulerState: { bpm, subDivisions, signature }\n    },\n    setState\n  ] = useLocalStorage(\"@mjh/metronome/schedulerState\", makeInitialState);\n\n  const addDiff = (diff: number) =>\n    setState(\n      over(\n        bpmL,\n        R.pipe(\n          R.add(diff),\n          R.clamp(1, 250)\n        )\n      )\n    );\n\n  const setBPM = useCallback(\n    (bpm: number) => setState(set(bpmL, R.clamp(1, 250, bpm))),\n    [setState]\n  );\n\n  const toggleSubDivision = (divisionIdx: number) => {\n    setState(over(subDivisionsL(divisionIdx), R.not));\n  };\n\n  const [currentBeat, setCurrentBeat] = useMetronome(\n    playing,\n    schedulerState,\n    audioContext\n  );\n  const toggleStart = () => {\n    if (playing) {\n      setCurrentBeat(undefined);\n    }\n    setPlaying(R.not);\n  };\n\n  const startMetronome = useCallback(\n    (bpm: number) => {\n      setBPM(bpm);\n      setPlaying(true);\n    },\n    [setPlaying, setBPM]\n  );\n\n  const stopMetronome = useCallback(() => {\n    setPlaying(false);\n  }, []);\n\n  const setSignature = (s: Signature) => {\n    setState(set(signatureL, s));\n  };\n\n  const [showScales, toggleScales] = useToggle(false);\n  const [showTuner, toggleTuner] = useToggle(false);\n\n  const [updateAvailable, setUpdateAvailable] = useState(false);\n  useEffect(() => {\n    serviceWorker.register({\n      onUpdate: () => {\n        setUpdateAvailable(true);\n      }\n    });\n  });\n\n  const [showDial, toggleDial] = useToggle(true);\n\n  return (\n    <div\n      style={{\n        maxWidth: \"500px\",\n        margin: \"0 auto\",\n        paddingLeft: \"10px\",\n        paddingRight: \"10px\"\n      }}\n    >\n      {updateAvailable && (\n        <section\n          className=\"box is-grouped field has-addons\"\n          style={{ marginBottom: \"10px\" }}\n        >\n          <p style={{ alignSelf: \"center\" }} className=\"control is-expanded\">\n            An Update is Available!\n          </p>\n          <Button onClick={() => window.location.reload()}>Refresh</Button>\n        </section>\n      )}\n      <TimeSignature\n        setSignature={setSignature}\n        signature={signature}\n        currentBeat={currentBeat}\n      />\n      {showDial && (\n        <section className=\"section\">\n          <Dial addDiff={addDiff}>\n            <div className=\"has-text-centered is-size-1\">{bpm}</div>\n            <TempoMarking bpm={bpm} />\n          </Dial>\n        </section>\n      )}\n\n      <section className=\"section\">\n        <Buttons>\n          <SubDivisions\n            subDivisions={subDivisions}\n            toggle={toggleSubDivision}\n          />\n          <TapIn setBPM={setBPM} />\n          <Button\n            style={{ flexGrow: 1 }}\n            classes={[\"is-outlined\", playing ? \"is-danger\" : \"is-primary\"]}\n            onClick={toggleStart}\n          >\n            {playing ? \"Stop\" : \"Start\"}\n          </Button>\n        </Buttons>\n      </section>\n      {showScales && (\n        <Scales startMetronome={startMetronome} stopMetronome={stopMetronome} />\n      )}\n      {showTuner && <Tuner />}\n      <nav className=\"navbar is-fixed-bottom has-background-light\">\n        <div\n          style={{\n            maxWidth: \"500px\",\n            margin: \"0 auto\",\n            paddingTop: \"10px\",\n            paddingRight: \"10px\"\n          }}\n          className=\" buttons is-right\"\n        >\n          <Button classes={[showDial ? \"is-primary\" : \"\"]} onClick={toggleDial}>\n            Dial\n          </Button>\n          <Button\n            classes={[showScales ? \"is-primary\" : \"\"]}\n            onClick={toggleScales}\n          >\n            Scales\n          </Button>\n          <Button\n            classes={[showTuner ? \"is-primary\" : \"\"]}\n            onClick={toggleTuner}\n          >\n            Tuner\n          </Button>\n          <div>{`v${process.env.REACT_APP_VERSION}`}</div>\n        </div>\n      </nav>\n    </div>\n  );\n};\n\nconst App: React.FC = () => {\n  return <Metronome />;\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./bulma-overrides.sass\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}