(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{29:function(e,n,t){e.exports=t(42)},35:function(e,n,t){e.exports=t.p+"static/media/click.b48ed3e5.wav"},41:function(e,n,t){},42:function(e,n,t){"use strict";t.r(n);for(var a=t(0),r=t.n(a),i=t(12),o=t.n(i),c=t(1),u=t(26),s=t(50),l=t(47),f=t(48),m=t(23),d=t(46),v=t(45),b=t(51),g=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(a.useState)(function(){var a,r=localStorage.getItem(e);return a=null===r||void 0===r||t?n instanceof Function?n():n:JSON.parse(r),window.localStorage.setItem(e,JSON.stringify(a)),a}),i=Object(c.a)(r,2),o=i[0],u=i[1];return[o,function(n){u(function(t){var a=n instanceof Function?n(t):n;return window.localStorage.setItem(e,JSON.stringify(a)),a})}]},h=function(e){var n=Object(a.useState)(e),t=Object(c.a)(n,2),r=t[0],i=t[1];return[r,function(){return i(function(e){return!e})}]},p=t(11),j=function(e){var n=e.classes,t=void 0===n?[]:n,a=e.children,i=Object(p.a)(e,["classes","children"]),o="button ".concat(t.join(" ")),c=Object.assign(i,{className:o});return r.a.createElement("button",c,a)},E=function(e){var n=e.classes,t=void 0===n?[]:n,a=e.children,i=Object(p.a)(e,["classes","children"]),o="buttons has-addons ".concat(t.join(" ")),c=Object.assign(i,{className:o});return r.a.createElement("div",c,a)},O=function(e){var n=e.setSignature,t=e.signature.numerator,a=e.currentBeat,i=h(!1),o=Object(c.a)(i,2),u=o[0],s=o[1],l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return function(){n({numerator:e,denominator:t}),s()}};return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{style:{marginTop:"10px"},className:"section is-mobile columns",onClick:s},b.a(0,t).map(function(e){var n=e+1===a?"has-background-primary":"has-background-light";return r.a.createElement("div",{className:"column margin-sm has-text-centered ".concat(n),key:e},e+1)})),u&&r.a.createElement("section",{className:"section buttons is-centered"},r.a.createElement(j,{onClick:l(2)},"2/4"),r.a.createElement(j,{onClick:l(3)},"3/4"),r.a.createElement(j,{onClick:l(4)},"4/4"),r.a.createElement(j,{onClick:l(5)},"5/4")))},M=t(35),w=function(e,n){var t=n.time,a=n.gain,r=n.buffer,i=n.pitch,o=e.createBufferSource();o.buffer=r,o.detune.value=-i;var c=e.createGain();c.gain.value=a,o.connect(c),c.connect(e.destination),o.start(t)},S=function(e,n,t,a){var r=t.divisions,i=t.on,o=t.pitch,c=t.gain;if(i){var u=n/r;return b.a(1,r).map(function(n){return{time:e+n*u,pitch:o,gain:.5*c,buffer:a}})}return[]},y=function(e,n,t,r){var i=n.scheduleAhead,o=function(e){var n=Object(a.useState)(),t=Object(c.a)(n,2),r=t[0],i=t[1];return Object(a.useEffect)(function(){var n=new AudioContext;fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return n.decodeAudioData(e)}).then(i)},[e]),r}(M),u=Object(a.useRef)(0),s=function(e){var n=Object(a.useRef)(e);return Object(a.useEffect)(function(){n.current=e},[e]),n}(n),l=e?1e3*i/2:void 0;Object(a.useEffect)(function(){if(void 0!==l){var e=r.currentTime+.1;u.current=e;var n=setInterval(function(){!function(e,n,t,a,r){for(var i=n.current,o=i.bpm,c=i.subDivisions,u=i.scheduleAhead,s=60/o,l=function(e){w(r,e)};e.current<r.currentTime+u;){w(r,{time:e.current,pitch:0,gain:.5,buffer:t}),a(e.current);var f=!0,m=!1,d=void 0;try{for(var v,b=c[Symbol.iterator]();!(f=(v=b.next()).done);f=!0){var g=v.value;S(e.current,s,g,t).forEach(l)}}catch(h){m=!0,d=h}finally{try{f||null==b.return||b.return()}finally{if(m)throw d}}e.current+=s}}(u,s,o,t,r)},l);return function(){clearInterval(n)}}},[l,o,s,t,r])},x=function(e,n,t,r,i){var o=function(e){var n=Object(a.useRef)(e);return Object(a.useLayoutEffect)(function(){n.current=e},[e]),n}(t);Object(a.useLayoutEffect)(function(){var t,a=!0,c=function(){u();var e=n.currentTime,t=o.current;(void 0!==t&&e<=t||a)&&(r(void 0),i(),a=!1)},u=function(){t=requestAnimationFrame(c)};if(e)return u(),function(){cancelAnimationFrame(t)}},[e,n,i,o,r])},k=t(49),F=t(27),C=t(52),A=t(43),N=t(44),B=f.a(function(e){return k.a(2,e)},F.a(function(e){var n=Object(c.a)(e,2),t=n[0];return n[1]-t}),C.a,A.a(6e4),Math.trunc),D=function(e){var n=e.setBPM,t=Object(a.useState)([]),i=Object(c.a)(t,2),o=i[0],u=i[1];return r.a.createElement(j,{onClick:function(){var e=performance.now(),t=N.a(e,o).filter(function(n){return e-n<3e3});if(t.length>1){var a=B(t);n(a)}u(t)}},"Tap In")},L=function(e){var n=e.subDivisions,t=e.toggle;return r.a.createElement(r.a.Fragment,null,n.map(function(e,n){var a=e.label,i=e.on;return r.a.createElement(j,{classes:[i?"is-primary":""],key:n,onClick:function(){return t(n)}},a)}))},_={0:"A",1:"Bb",2:"B",3:"C",4:"Db",5:"D",6:"Eb",7:"E",8:"F",9:"Gb",10:"G",11:"Ab"},G=[],q=-4;q<4;q++)for(var T=0;T<12;T++){var W=440*Math.pow(2,q),R=W/1200,P=W*Math.pow(2,T/12),I=q+4,z=_[T];G.push({octave:I,note:z,frequency:P,centsPerOctave:R})}var U=function(){var e=Object(a.useState)(),n=Object(c.a)(e,2),t=n[0],i=n[1],o=Object(a.useState)(),u=Object(c.a)(o,2)[1],s=Object(a.useState)(),l=Object(c.a)(s,2),f=l[0],m=l[1],d=Object(a.useState)(440),v=Object(c.a)(d,2),b=v[0],g=v[1];Object(a.useRef)(null);Object(a.useEffect)(function(){var e=new AudioContext;m(e.sampleRate);var n=navigator.mediaDevices;return n&&n.getUserMedia({audio:!0}).then(function(n){var t=e.createAnalyser();t.fftSize=8192,e.createMediaStreamSource(n).connect(t),i(t)}),function(){e.close()}},[]),Object(a.useLayoutEffect)(function(){var e,n=function(){var e=t.frequencyBinCount,n=new Float32Array(e);t.getFloatFrequencyData(n),u(n);var r=n.reduce(function(e,n,t){return e[0]<n?[n,t]:e},[-1/0,-1]),i=Object(c.a)(r,2)[1],o=f/t.fftSize;g(o*i),a()},a=function(){e=requestAnimationFrame(n)};if(void 0!==t)return a(),function(){cancelAnimationFrame(e)}},[t,f]);var h=function(e){for(var n=0,t=0;t<G.length;t++)if(G[t].frequency>=e){n=t;break}var a=n+1,r=G[n],i=G[a],o=(r.frequency+i.frequency)/2,c=G[a],u=c.frequency-e;e<o&&(c=G[n]);var s=c.centsPerOctave*u;return Object.assign(c,{originalFrequency:e,difference:u,cents:s})}(b||0),p=h.octave,j=h.note,E=h.cents;return r.a.createElement("div",{className:"box"},r.a.createElement("div",{className:"has-text-centered"},r.a.createElement("div",{className:"is-size-1"},j+p),r.a.createElement("div",null,E.toFixed(2)," Cents ",E<0?"flat":"sharp")),!1)},J=t(17),$=t(18);function H(){var e=Object(J.a)(["\n  align-self: center;\n  margin: auto;\n  z-index: 1;\n  pointer-events: none;\n"]);return H=function(){return e},e}function K(){var e=Object(J.a)(["\n  width: 100px;\n  height: 100px;\n  border-radius: 100px;\n  position: absolute;\n"]);return K=function(){return e},e}function Q(){var e=Object(J.a)(["\n  margin: auto;\n  position: relative;\n  height: 300px;\n  width: 300px;\n  border-radius: 300px;\n  display: flex;\n  margin-bottom: 10px;\n"]);return Q=function(){return e},e}var V,X;$.a.div(Q()),$.a.div(K()),$.a.div(H());!function(e){e.Major="Major",e.Minor="Minor"}(V||(V={})),function(e){e.A="A",e.B_Flat="Bb",e.B="B",e.C="C",e.D_Flat="Db",e.D="D",e.E_Flat="Eb",e.E="E",e.F="F",e.G_Flat="Gb",e.G="G",e.A_Flat="Ab"}(X||(X={}));var Y=function(e,n){var t=[];return Object.entries(e).forEach(function(e){var a=Object(c.a)(e,2)[1];Object.entries(a).forEach(function(e){var a=Object(c.a)(e,2)[1];n(a)&&t.push(a)})}),t},Z=function(e,n){return Y(e,function(e){return e.mode===n})},ee=function(){var e={},n=function(n,t){var a=e[n];void 0===a&&(a={},e[n]=a),a[t]=function(e,n){return{pitch:e,mode:n,known:!1,learning:!1,bpm:60}}(n,t)};return n(X.A,V.Major),n(X.B_Flat,V.Major),n(X.B,V.Major),n(X.C,V.Major),n(X.D_Flat,V.Major),n(X.D,V.Major),n(X.E_Flat,V.Major),n(X.E,V.Major),n(X.F,V.Major),n(X.G_Flat,V.Major),n(X.G,V.Major),n(X.A_Flat,V.Major),n(X.A,V.Minor),n(X.B_Flat,V.Minor),n(X.B,V.Minor),n(X.C,V.Minor),n(X.D_Flat,V.Minor),n(X.D,V.Minor),n(X.E_Flat,V.Minor),n(X.E,V.Minor),n(X.F,V.Minor),n(X.G_Flat,V.Minor),n(X.G,V.Minor),n(X.A_Flat,V.Minor),e},ne=function(e){var n=e.title,t=e.children,a=h(!1),i=Object(c.a)(a,2),o=i[0],u=i[1];return r.a.createElement("div",null,r.a.createElement("div",{className:"is-grouped field has-addons"},r.a.createElement("div",{style:{alignSelf:"center",fontWeight:"bold"},className:"control is-expanded is-size-5"},n),r.a.createElement(j,{onClick:u},o?"-":"+")),o&&t)},te=function(e){var n=e.pitch,t=e.mode,a=e.learning,i=e.toggleLearning;return r.a.createElement("div",{className:"is-grouped field has-addons"},r.a.createElement("div",{className:"is-size-5 control is-expanded"},n),r.a.createElement(j,{onClick:i(n,t)},a?"Stop Learning":"Start Learning"))};var ae=function(e){var n=e.filter,t=e.scalesDB,i=e.addBPM,o=e.startMetronome,u=e.stopMetronome,s=Object(a.useState)(function(){return function(e){var n,t,a;for(a=e.length-1;a>0;a--)n=Math.floor(Math.random()*(a+1)),t=e[a],e[a]=e[n],e[n]=t;return e}(Y(t,n).map(function(e){return[e.mode,e.pitch]}))}),l=Object(c.a)(s,2),f=l[0],m=l[1],d=f[0]||[],v=function(e,n){return Y(e,n)[0]}(t,function(e){return e.mode===d[0]&&e.pitch===d[1]});Object(a.useEffect)(function(){void 0!==v&&o(v.bpm)},[v]);var b=f.length>1?"Next":"Last One";if(0===f.length)return r.a.createElement("div",null,"No more scales");var g=v,h=g,p=h.mode,E=h.pitch,O=h.bpm;return r.a.createElement("div",{className:""},r.a.createElement("div",null,E," ",p," @ ",O),r.a.createElement(j,{style:{flexGrow:1},onClick:i(g,-1)},"-"),r.a.createElement(j,{style:{flexGrow:1},onClick:i(g,1)},"+"),r.a.createElement(j,{classes:["is-right"],onClick:function(){m(function(e){var n=e.slice(1);return 0===n.length&&u(),n})}},b))},re=function(e){var n=e.startMetronome,t=e.stopMetronome,a=(Object(p.a)(e,["startMetronome","stopMetronome"]),g("@mjh/metronome/scales-db",ee)),i=Object(c.a)(a,2),o=i[0],s=i[1],f=h(!1),d=Object(c.a)(f,2),b=d[0],E=d[1],O=Z(o,V.Major),M=Z(o,V.Minor),w=[["Major scales (To Learn)",O.filter(function(e){return!e.learning})],["Minor scales (To Learn)",M.filter(function(e){return!e.learning})],["Major scales (Learning)",O.filter(function(e){return e.learning})],["Minor scales (Learning)",M.filter(function(e){return e.learning})]],S=function(e,n){return function(){s(u.a(l.a([e,n,"learning"]),v.a))}};return r.a.createElement("div",{className:"box"},r.a.createElement(j,{onClick:function(){b&&t(),E()}},b?"Stop":"Start Learning"),!b&&w.map(function(e){var n=Object(c.a)(e,2),t=n[0],a=n[1];return r.a.createElement(ne,{title:r.a.createElement("div",null,t)},a.map(function(e){return r.a.createElement(te,Object.assign({key:"".concat(t,"-").concat(e.pitch,"-").concat(e.mode)},e,{toggleLearning:S}))}))}),b&&r.a.createElement(ae,{startMetronome:n,stopMetronome:t,addBPM:function(e,n){var t=e.pitch,a=e.mode;return function(){s(u.a(l.a([t,a,"bpm"]),m.a(n)))}},filter:function(e){return e.learning},scalesDB:o}))},ie=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function oe(e){if("serviceWorker"in navigator){if(new URL("/metronome",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var n="".concat("/metronome","/service-worker.js");ie?(!function(e,n){fetch(e).then(function(t){var a=t.headers.get("content-type");404===t.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ce(e,n)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(n,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):ce(n,e)})}}function ce(e,n){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;null!=t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(e)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var ue=l.a(["schedulerState","bpm"]),se=l.a(["schedulerState","signature"]),le=function(){return{schedulerState:{scheduleAhead:.2,bpm:120,signature:{numerator:4,denominator:4},subDivisions:[{on:!1,pitch:10,divisions:2,label:"2",gain:1},{on:!1,pitch:20,divisions:3,label:"3",gain:1},{on:!1,pitch:30,divisions:4,label:"4",gain:1},{on:!1,pitch:40,divisions:5,label:"5",gain:1}]}}},fe=function(){var e=Object(a.useState)(!1),n=Object(c.a)(e,2),t=n[0],i=n[1],o=Object(a.useState)(function(){return new AudioContext}),f=Object(c.a)(o,2),m=f[0],b=f[1];Object(a.useEffect)(function(){t&&b(new AudioContext)},[t]);var p=g("@mjh/metronome/schedulerState",le),M=Object(c.a)(p,2),w=M[0],S=w.schedulerState,k=w.schedulerState,F=(k.bpm,k.subDivisions),C=k.signature,A=M[1],N=function(e){return A(Object(s.a)(ue,d.a(1,250,e)))},B=function(e,n,t){var r=Object(a.useState)(),i=Object(c.a)(r,2),o=i[0],u=i[1],s=Object(a.useState)(0),l=Object(c.a)(s,2),f=l[0],m=l[1],d=n.signature.numerator,v=Object(a.useCallback)(function(){return m(function(e){var n=e+1;return e>=d&&(n=1),n})},[d]);return y(e,n,u,t),x(e,t,o,u,v),[f,m]}(t,S,m),_=Object(c.a)(B,2),G=_[0],q=_[1],T=h(!0),W=Object(c.a)(T,2),R=W[0],P=W[1],I=h(!1),z=Object(c.a)(I,2),J=z[0],$=z[1],H=Object(a.useState)(!1),K=Object(c.a)(H,2),Q=K[0],V=K[1];return Object(a.useEffect)(function(){oe({onUpdate:function(){V(!0)}})}),r.a.createElement("div",{style:{maxWidth:"500px",margin:"0 auto",padding:"10px"}},Q&&r.a.createElement("section",{className:"box is-grouped field has-addons",style:{marginBottom:"10px"}},r.a.createElement("p",{style:{alignSelf:"center"},className:"control is-expanded"},"An Update is Available!"),r.a.createElement(j,{onClick:function(){return window.location.reload()}},"Refresh")),r.a.createElement(O,{setSignature:function(e){A(Object(s.a)(se,e))},signature:C,currentBeat:G}),!1,r.a.createElement("section",{className:"section"},r.a.createElement(E,null,r.a.createElement(L,{subDivisions:F,toggle:function(e){var n;A(Object(u.a)((n=e,l.a(["schedulerState","subDivisions",n,"on"])),v.a))}}),r.a.createElement(D,{setBPM:N}),r.a.createElement(j,{style:{flexGrow:1},classes:["is-outlined",t?"is-danger":"is-primary"],onClick:function(){t&&q(0),i(v.a)}},t?"Stop":"Start"))),R&&r.a.createElement(re,{startMetronome:function(e){N(e),i(!0)},stopMetronome:function(){i(!1)}}),J&&r.a.createElement(U,null),r.a.createElement("nav",{className:"navbar is-fixed-bottom buttons is-right",style:{padding:"10px",margin:"0 auto",maxWidth:"500px"}},r.a.createElement(j,{classes:[R?"is-primary":""],onClick:P},"Scales"),r.a.createElement(j,{classes:[J?"is-primary":""],onClick:$},"Tuner"),r.a.createElement("div",null,"v".concat("22.1.0"))))},me=function(){return r.a.createElement(fe,null)};t(41);o.a.render(r.a.createElement(me,null),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.b6d64a2a.chunk.js.map