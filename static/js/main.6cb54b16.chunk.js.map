{"version":3,"sources":["click.wav","components/TempoMarking.tsx","components/Common.tsx","types.ts","polyfill.ts","hooks.ts","components/TimeSignature.tsx","components/TapIn.tsx","components/Tuner.tsx","components/Dial.tsx","util.ts","redux.ts","metronome.ts","components/Metronome.tsx","components/Settings.tsx","components/Scales.tsx","scales.ts","serviceWorker.ts","components/Update.tsx","settings.ts","components/App.tsx","index.tsx"],"names":["module","exports","__webpack_require__","p","markings","immutable","name","low","high","fromBPM","R","a","bpm","filter","_ref","to","test","Marking","React","memo","_ref2","react_default","createElement","className","TempoMarking","_ref3","style","minHeight","map","_ref4","key","concat","_ref5","_ref6","old","newbpm","equals","LocalStorageKey","Mode","Pitch","offProps","onProps","ToggleButton","on","props","Object","objectWithoutProperties","renderProps","useMemo","toRemove","child","children","Array","length","Common_Button","Button","isPrimary","isDanger","isLink","isInfo","isSuccess","isOutlined","offIsPrimary","offIsDanger","offIsLink","offIsInfo","offIsSuccess","offIsOutlined","grow","propsClassName","classnames","is-primary","is-link","is-danger","is-info","is-success","is-outlined","is-grow","objectSpread","ButtonsWrapper","styled","div","_templateObject","Buttons","hasAddons","ref","has-addons","assign","AudioContext","window","webkitAudioContext","undefined","scaleKeys","A","Major","B","C","D","E","F","G","A_Flat","B_Flat","C_Flat","D_Flat","E_Flat","G_Flat","C_Sharp","F_Sharp","Minor","A_Sharp","D_Sharp","G_Sharp","useLocalStorage","initialValue","override","arguments","_useState5","useState","firstValue","fromLocal","localStorage","getItem","Function","transit","setItem","_useState6","slicedToArray","value","setValue","useCallback","valueAction","oldValue","newValue","usePersistantToggle","_useLocalStorage","_useLocalStorage2","storageValue","setStorageValue","useToggle","sideEffect","toggleState","_useState7","_useState8","useDetectChangedValue","_len","values","_key","oldValues","useRef","useEffect","lastValues","current","newValues","forEach","lastValue","index","diff","d","console","log","DivisionsWrapper","section","TimeSignature_templateObject","Divisions","uiEnabledDivisions","toggleDivisionOption","clearDivisions","Common_Buttons","marginRight","num","get","Common_ToggleButton","onClick","Signature","setCurrentNumerator","currentNumerator","Fragment","BeatRowItemWrapper","_templateObject2","BeatRowWrapper","_templateObject3","BeatWrapper","_templateObject4","BeatsWrapper","_templateObject5","BeatRowItem","beatRows","height","marginTop","BeatRow","bools","beatNumber","rowIndex","j","itemIndex","Beat","beat","things","entrySeq","_ref7","_ref8","divisions","size","Beats","activeBeats","reactRedux","TimeSignature","metronome","setSignature","numerator","state","signature","_useState","_useState2","hasChanged","setHasChanged","_hooks$useLocalStorag","hooks","t","EnabledDivisions","set","_hooks$useLocalStorag2","uIenabledDivisions","setUiEnabledDivisions","divisionOption","_React$useState","_React$useState2","calculateBPM","tapTimes","Math","trunc","TapIn","setBPM","taps","setTaps","now","performance","newTaps","tap","noteIdx","0","1","2","3","4","5","6","7","8","9","10","11","notes","i","base","pow","centsPerOctave","frequency","octave","note","push","Tuner","_useToggle","_useToggle2","toggleOn","analyser","setAnalyser","_useState3","_useState4","sampleRate","setSampleRate","freq","setFreq","audioContext","setAudioContext","polyfill","mediaStream","mediaDevices","navigator","getUserMedia","audio","then","ms","createAnalyser","fftSize","createMediaStreamSource","connect","getAudioTracks","track","stop","tick","bufferLength","frequencyBinCount","dataArray","Float32Array","getFloatFrequencyData","_dataArray$reduce","reduce","b","Infinity","maxIdx","resolution","interval","setInterval","clearInterval","_freqToPitch","lowPitch","highPitch","average","difference","cents","originalFrequency","freqToPitch","TunerWrapper","toFixed","Tuner_templateObject","Outer","Dial_templateObject","Inner","Dial_templateObject2","ChildContainer","Dial_templateObject3","InfiniKnob","_ref$size","addDiff","Radians","PI","stateRadians","setRadians","radiansRef","mouseDown","setMouseDown","mouseDownRef","totalDiff","setTotalDiff","totalDiffRef","knobContainer","onMouseDown","e","preventDefault","onMouseUp","_","addToBuffer","abs","oldDiff","moveKnob","clientX","clientY","box","getBoundingClientRect","boxCenter","left","width","y","top","x","newRadians","atan2","onMouseMove","addEventListener","removeEventListener","onTouchMove","t0","changedTouches","sin","cos","ActionType","setActiveBeats","store","dispatch","type","SetActiveBeats","redux","action","UpdateActiveBeats","getIn","currentBeat","divisionIndex","setIn","click","require","scheduleNote","time","gain","buffer","pitch","isOne","sound","createBufferSource","detune","volume","createGain","destination","start","intervalError","useScheduleAhead","playing","url","_useState9","_useState10","updateBuffer","fetch","response","arrayBuffer","decodeAudioData","useAudioBuffer","nextNoteTimeRef","delay","scheduleAhead","stateRef","beatToScheduleRef","nextBeat","updateUi","timeToRun","callback","setTimeout","currentTime","runAtTime","beatsQueue","Deque","firstClickTime","beatIdx","min","nextNoteTime","secondsPerBeat","beatsForNextMeasure","startOfBeatTime","beats","noteOffset","divisionLength","sort","beatsFor","apply","toConsumableArray","addBeatsToQueue","intervalLength","scheduleTil","peekFront","first","shift","playBeatsTill","id","resetActiveBeats","enabledDivisions","acc","clampBPM","defaultBeat","useMetronome","setPlaying","_useAdvice","advice","originalT","originalSetter","newSetter","oldT","useAdvice","BPM","_useAdvice2","denominator","pending","ready","bpmRef","addBPM","bpmToAdd","toggleStart","FullPage","Metronome_templateObject","Controls","showTuner","toggleTuner","components_TapIn","disabled","Metronome","appSettings","keepAwake","_usePersistantToggle","ShowTuner","_usePersistantToggle2","_useSleepLock","NoSleep","noSleep","lock","enable","release","disable","useSleepLock","components_Tuner","Dial","components_TempoMarking","components_TimeSignature","ScaleMode","SettingsWrapper","Settings_templateObject","Settings","toggleKeepAwake","checked","onChange","initScalesDB","scalesDB","scaleKey","add","mode","known","learning","addScale","getScales","useScales","ScalesDB","setScalesDB","addScalePublic","Error","getScalePublic","getScale","getScalesPublic","localeCompare","s","scale","remove","toggleLearning","toggleKnown","ScalesGroup","_ref$scaleKey","LearnScales","scales","reset","scaleMode","floor","random","util","LEARNING","KNOWN","valueSeq","toArray","setScales","currentKey","maybeScale","nextScaleText","alignSelf","fontWeight","display","marginBottom","justifyContent","nu","slice","Scales","stopMetronome","_React$useState3","NOT_STARTED","_React$useState4","setScaleMode","_hooks$usePersistantT","ShowKnown","_hooks$usePersistantT2","showKnown","toggleShowKnown","Scales_ScalesGroup","Scales_LearnScales","isLocalhost","Boolean","location","hostname","match","register","config","URL","process","href","origin","swUrl","contentType","headers","status","indexOf","serviceWorker","registration","unregister","reload","registerValidSW","catch","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","error","rotate","keyframes","Update_templateObject","UpdateStyle","Update_templateObject2","hasRegistered","Update","updateAvailable","setUpdateAvailable","close","initSettings","TopBarWrapper","App_templateObject","CenterIcon","span","App_templateObject2","TopNav","App_templateObject3","dropDown","App_templateObject4","NavDropDown","nav","App_templateObject5","NavItem","Link","_templateObject6","NavIcon","FontAwesomeIcon","_templateObject7","TopBar","showNav","toggleNav","react_router_dom","index_es","icon","faCoffee","faHome","faMusic","faGear","WrapperStyle","_templateObject8","FooterStyle","_templateObject9","Wrapper","App","AppSettings","setState","useAppSettings","audioContextRef","hasFixed","setHasFixed","fixAudioContext","resume","document","context","basename","react_router","exact","path","render","components_Metronome","components_Scales","components_Settings","ErrorBoundary","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","message","stack","JSON","stringify","Component","ReactDOM","es","src_ErrorBoundary","components_App","getElementById"],"mappings":"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","file":"static/js/main.6cb54b16.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/click.b48ed3e5.wav\";","import React from \"react\";\nimport * as immutable from \"immutable\";\nimport * as R from \"ramda\";\n\ninterface Marking {\n  high: number;\n  low: number;\n  name: string;\n}\n\nexport const markings: immutable.List<Marking> = immutable.List([\n  { name: \"Larghissimo\", low: 0, high: 24 },\n  { name: \"Grave\", low: 25, high: 45 },\n  { name: \"Largo\", low: 40, high: 60 },\n  { name: \"Lento\", low: 45, high: 60 },\n  { name: \"Larghetto\", low: 60, high: 66 },\n  { name: \"Adagio\", low: 66, high: 76 },\n  { name: \"Andante\", low: 76, high: 108 },\n  { name: \"Marcia moderato\", low: 83, high: 85 },\n  { name: \"Andante moderato\", low: 92, high: 112 },\n  { name: \"Moderato\", low: 108, high: 120 },\n  { name: \"Allegro\", low: 120, high: 156 },\n  { name: \"Vivace\", low: 156, high: 176 },\n  { name: \"Vivacissimo\", low: 172, high: 176 },\n  { name: \"Allegrissimo\", low: 172, high: 176 },\n  { name: \"Presto\", low: 168, high: 200 },\n  { name: \"Prestissimo\", low: 200, high: 250 }\n]);\n\nconst inRange = (to: number, from: number, test: number) => {\n  return test >= from && test <= to;\n};\n\nconst fromBPM = R.memoizeWith(\n  a => \"\" + a,\n  (bpm: number): immutable.List<Marking> =>\n    markings.filter(({ high, low }) => inRange(high, low, bpm))\n);\n\ninterface Props {\n  bpm: number;\n}\n\ninterface MarkingProps {\n  name: string;\n  low: number;\n  high: number;\n}\n\nconst Marking: React.FC<MarkingProps> = React.memo(({ name, low, high }) => {\n  return (\n    <div className=\"has-text-centered\">\n      {name} - {low} - {high}\n    </div>\n  );\n});\n\nconst TempoMarking = React.memo(\n  ({ bpm }: Props) => {\n    const markings = fromBPM(bpm);\n    return (\n      <div style={{ minHeight: \"6.5em\" }}>\n        {markings.map(({ name, high, low }) => (\n          <Marking key={`marking-${name}`} name={name} high={high} low={low} />\n        ))}\n      </div>\n    );\n  },\n  ({ bpm: old }, { bpm: newbpm }) => fromBPM(old).equals(fromBPM(newbpm))\n);\n\nexport default TempoMarking;\n","import React from \"react\";\nimport * as R from \"ramda\";\nimport styled from \"styled-components\";\nimport classnames from \"classnames\";\n\nexport const maxWidth = \"40em\";\n\ntype ReactButton = React.DetailedHTMLProps<\n  React.ButtonHTMLAttributes<HTMLButtonElement>,\n  HTMLButtonElement\n>;\ninterface ButtonProps extends ReactButton {\n  primary?: true;\n  isPrimary?: true;\n  isLink?: true;\n  isInfo?: true;\n  isSuccess?: true;\n  isDanger?: true;\n  isOutlined?: true;\n  offIsPrimary?: true;\n  offIsLink?: true;\n  offIsInfo?: true;\n  offIsSuccess?: true;\n  offIsDanger?: true;\n  offIsOutlined?: true;\n  grow?: true;\n}\n\ninterface ToggleButtonProps extends ButtonProps {\n  on: boolean;\n}\n\nconst offProps = [\n  \"offIsPrimary\",\n  \"offIsLink\",\n  \"offIsDanger\",\n  \"offIsInfo\",\n  \"offIsSuccess\",\n  \"offIsOutlined\"\n];\nconst onProps = [\n  \"isPrimary\",\n  \"isLink\",\n  \"isDanger\",\n  \"isInfo\",\n  \"isSuccess\",\n  \"isOutlined\"\n];\n\nexport const ToggleButton: React.FC<ToggleButtonProps> = ({ on, ...props }) => {\n  const renderProps = React.useMemo(() => {\n    const toRemove = on ? offProps : onProps;\n    return R.omit(toRemove, props);\n  }, [on, props]);\n\n  const child = React.useMemo(\n    () =>\n      props.children instanceof Array && props.children.length === 2\n        ? on\n          ? props.children[0]\n          : props.children[1]\n        : props.children,\n    [props, on]\n  );\n  return <Button {...renderProps}>{child}</Button>;\n};\n\nexport const Button: React.FC<ButtonProps> = ({\n  isPrimary,\n  isDanger,\n  isLink,\n  isInfo,\n  isSuccess,\n  isOutlined,\n  offIsPrimary,\n  offIsDanger,\n  offIsLink,\n  offIsInfo,\n  offIsSuccess,\n  offIsOutlined,\n  grow,\n  className: propsClassName,\n  ...props\n}) => {\n  const className = React.useMemo(\n    () =>\n      classnames(\"button\", propsClassName, {\n        \"is-primary\": isPrimary || offIsPrimary,\n        \"is-link\": isLink || offIsLink,\n        \"is-danger\": isDanger || offIsDanger,\n        \"is-info\": isInfo || offIsInfo,\n        \"is-success\": isSuccess || offIsSuccess,\n        \"is-outlined\": isOutlined || offIsOutlined,\n        \"is-grow\": grow\n      }),\n    [\n      propsClassName,\n      grow,\n      isPrimary,\n      offIsPrimary,\n      isLink,\n      offIsLink,\n      isDanger,\n      offIsDanger,\n      isInfo,\n      offIsInfo,\n      isOutlined,\n      offIsOutlined,\n      isSuccess,\n      offIsSuccess\n    ]\n  );\n  const renderProps = React.useMemo(() => {\n    return { ...props, className };\n  }, [props, className]);\n\n  return <button {...renderProps}>{props.children}</button>;\n};\n\ninterface ButtonsProps\n  extends React.DetailedHTMLProps<\n    React.HTMLAttributes<HTMLDivElement>,\n    HTMLDivElement\n  > {\n  hasAddons?: true;\n  grow?: true | undefined;\n}\n\nconst ButtonsWrapper = styled.div`\n  &:not(:last-child) {\n    margin-bottom: 0 !important;\n  }\n`;\n\nexport const Buttons: React.FC<ButtonsProps> = ({\n  children,\n  hasAddons,\n  ref,\n  className: propsClassName,\n  grow,\n  ...props\n}) => {\n  const className = React.useMemo(\n    () =>\n      classnames(propsClassName, \"buttons\", {\n        \"has-addons\": hasAddons,\n        \"is-grow\": grow\n      }),\n    [hasAddons, grow, propsClassName]\n  );\n  return (\n    <ButtonsWrapper ref={ref as any} {...props} className={className}>\n      {children}\n    </ButtonsWrapper>\n  );\n};\n","import React from \"react\";\nimport * as immutable from \"immutable\";\n\nexport interface Beat {\n  time: number;\n  pitch: number;\n  gain: number;\n  buffer: AudioBuffer;\n  divisions: Division;\n  divisionIndex: number;\n  divisionLength: number;\n  currentBeat: number;\n}\n\nexport type Division = 1 | 2 | 3 | 4 | 5 | 6;\n\nexport type ActiveDivision = immutable.List<boolean>;\nexport type ActiveBeat = immutable.Map<Division, ActiveDivision>;\nexport type ActiveBeats = immutable.List<ActiveBeat>;\n\nexport type EnabledDivisions = immutable.Map<Division, boolean>;\n\nexport type Numerator = immutable.List<EnabledDivisions>;\n\nexport interface TimeSignature {\n  denominator: number;\n  numerator: Numerator;\n}\n\nexport interface State {\n  ready: boolean;\n  pending: boolean;\n  bpm: number;\n  playing: boolean;\n  signature: TimeSignature;\n}\n\ninterface AppSettingsState {\n  keepAwake: boolean;\n}\n\nexport interface AppSettings {\n  state: AppSettingsState;\n  toggleKeepAwake: () => void;\n}\n\nexport interface Metronome {\n  toggleStart: () => void;\n  start: (bpm?: number) => void;\n  stop: () => void;\n  setBPM: React.Dispatch<React.SetStateAction<number>>;\n  setSignature: React.Dispatch<React.SetStateAction<TimeSignature>>;\n  addBPM: (bpmToAdd: number) => void;\n  state: State;\n}\n\nexport type MAudioContext =\n  | AudioContext\n  | \"pending\"\n  | \"not-supported\"\n  | undefined;\n\nexport enum LocalStorageKey {\n  EnabledDivisions = \"@mjh/k/enabled-divisions-0\",\n  AppSettings = \"@mjh/k/app-settings-0\",\n  SignatureDivisions = \"@mjh/k/signature-divisions-3\",\n  ShowKnown = \"@mjh/k/show-known-2\",\n  ScalesDB = \"@mjh/k/scales-db-2\",\n  ActiveBeats = \"@mjh/k/active-beats-2\",\n  TimeSignature = \"@mjh/k/signature-3\",\n  BPM = \"@mjh/k/bpm-0\",\n  KnownScales = \"@mjh/k/known-scales-0\",\n  ShowScales = \"@mjh/k/show-scales-0\",\n  ShowTuner = \"@mjh/k/show-tuner-0\",\n  ShowDial = \"@mjh/k/show-dial-0\",\n  Radians = \"@mjh/k/radians-0\",\n  WakeLock = \"@mjh/k/wake-lock-0\"\n}\n\nexport enum Mode {\n  Major = \"Major\",\n  Minor = \"Minor\"\n}\n\nexport enum Pitch {\n  A = \"A\",\n  B = \"B\",\n  C = \"C\",\n  D = \"D\",\n  E = \"E\",\n  F = \"F\",\n  G = \"G\",\n\n  A_Flat = \"Ab\",\n  B_Flat = \"Bb\",\n  C_Flat = \"Cb\",\n  D_Flat = \"Db\",\n  E_Flat = \"Eb\",\n  F_Flat = \"Fb\",\n  G_Flat = \"Gb\",\n\n  A_Sharp = \"A#\",\n  B_Sharp = \"B#\",\n  C_Sharp = \"C#\",\n  D_Sharp = \"D#\",\n  E_Sharp = \"E#\",\n  F_Sharp = \"F#\",\n  G_Sharp = \"G#\"\n}\n\n// TODO - this seems promising to be able to iterate through all options, just need to add them all in.\nexport type ScaleKey =\n  // First The naturals\n  | [Pitch.A, Mode.Major]\n  | [Pitch.B, Mode.Major]\n  | [Pitch.C, Mode.Major]\n  | [Pitch.D, Mode.Major]\n  | [Pitch.E, Mode.Major]\n  | [Pitch.F, Mode.Major]\n  | [Pitch.G, Mode.Major]\n  // Now The Flats\n  | [Pitch.A_Flat, Mode.Major]\n  | [Pitch.B_Flat, Mode.Major]\n  | [Pitch.C_Flat, Mode.Major]\n  | [Pitch.D_Flat, Mode.Major]\n  | [Pitch.E_Flat, Mode.Major]\n  | [Pitch.G_Flat, Mode.Major]\n  // The sharps\n  | [Pitch.C_Sharp, Mode.Major]\n  | [Pitch.D_Sharp, Mode.Major]\n  | [Pitch.E_Sharp, Mode.Major]\n  | [Pitch.F_Sharp, Mode.Major]\n  // Now The Minors\n  | [Pitch.A, Mode.Minor]\n  | [Pitch.B, Mode.Minor]\n  | [Pitch.C, Mode.Minor]\n  | [Pitch.D, Mode.Minor]\n  | [Pitch.E, Mode.Minor]\n  | [Pitch.F, Mode.Minor]\n  | [Pitch.G, Mode.Minor]\n  // Flat\n  | [Pitch.A_Flat, Mode.Minor]\n  | [Pitch.B_Flat, Mode.Minor]\n  | [Pitch.E_Flat, Mode.Minor]\n  // Sharp\n  | [Pitch.A_Sharp, Mode.Minor]\n  | [Pitch.C_Sharp, Mode.Minor]\n  | [Pitch.D_Sharp, Mode.Minor]\n  | [Pitch.F_Sharp, Mode.Minor]\n  | [Pitch.G_Sharp, Mode.Minor];\n\n// It's easy to forget one of these, so be careful, I guess. I couldn't figure\n// out a good way to do this, but this definitely works. I just copy the thing at the top and replace | with ,\nexport const scaleKeys: ScaleKey[] = [\n  // First The naturals\n  [Pitch.A, Mode.Major],\n  [Pitch.B, Mode.Major],\n  [Pitch.C, Mode.Major],\n  [Pitch.D, Mode.Major],\n  [Pitch.E, Mode.Major],\n  [Pitch.F, Mode.Major],\n  [Pitch.G, Mode.Major],\n  // Now The Flats\n  [Pitch.A_Flat, Mode.Major],\n  [Pitch.B_Flat, Mode.Major],\n  [Pitch.C_Flat, Mode.Major],\n  [Pitch.D_Flat, Mode.Major],\n  [Pitch.E_Flat, Mode.Major],\n  [Pitch.G_Flat, Mode.Major],\n  // The sharps\n  [Pitch.C_Sharp, Mode.Major],\n  [Pitch.F_Sharp, Mode.Major],\n  // Now The Minors\n  [Pitch.A, Mode.Minor],\n  [Pitch.B, Mode.Minor],\n  [Pitch.C, Mode.Minor],\n  [Pitch.D, Mode.Minor],\n  [Pitch.E, Mode.Minor],\n  [Pitch.F, Mode.Minor],\n  [Pitch.G, Mode.Minor],\n  // Flat\n  [Pitch.A_Flat, Mode.Minor],\n  [Pitch.B_Flat, Mode.Minor],\n  [Pitch.E_Flat, Mode.Minor],\n  // Sharp\n  [Pitch.A_Sharp, Mode.Minor],\n  [Pitch.C_Sharp, Mode.Minor],\n  [Pitch.D_Sharp, Mode.Minor],\n  [Pitch.F_Sharp, Mode.Minor],\n  [Pitch.G_Sharp, Mode.Minor]\n];\n\nexport interface Scale {\n  scaleKey: ScaleKey;\n  mode: Mode;\n  pitch: Pitch;\n  known: boolean;\n  learning: boolean;\n  bpm: number;\n}\n\nexport type ScalesDB = immutable.Set<Scale>;\n\nexport interface Scales {\n  getScale: (filter: (s: Scale) => boolean) => Scale | undefined;\n  getScales: (filter: (s: Scale) => boolean) => ScalesDB;\n  addScale: (s: Scale) => void;\n  toggleLearning: (s: Scale) => void;\n  toggleKnown: (s: Scale) => void;\n  addBPM: (s: Scale, bpm: number) => void;\n}\n","interface Constructable<T> {\n  new (): T;\n}\n\nexport const AudioContext: Constructable<AudioContext> | undefined =\n  (window as any).AudioContext || // Default\n  (window as any).webkitAudioContext || // Safari and old versions of Chrome\n  undefined;\n","import React, {\n  useState,\n  Dispatch,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useRef\n} from \"react\";\nimport * as R from \"ramda\";\nimport * as d from \"deep-object-diff\";\nimport * as polyfill from \"./polyfill\";\nimport * as t from \"./types\";\nimport * as transit from \"transit-immutable-js\";\nimport NoSleep from \"nosleep.js\";\n\nexport const useSingleton = <T>(initialValue?: T) => {\n  const [value, setValue] = useState<T | undefined>(initialValue);\n\n  const setValueOnce = useCallback(\n    (t: T) => {\n      if (!value) {\n        setValue(t);\n      }\n    },\n    [value]\n  );\n\n  return {\n    value: value,\n    init: setValueOnce\n  };\n};\n\nexport const useSleepLock = () => {\n  const [noSleep] = useState(new NoSleep());\n\n  const lock = useCallback(() => {\n    noSleep.enable();\n  }, [noSleep]);\n\n  const release = useCallback(() => {\n    noSleep.disable();\n  }, [noSleep]);\n\n  return {\n    lock,\n    release\n  };\n};\n\n// TODO - add in some logic to do simple migrations. Otherwise, we get stuck\n// with this state forever and have to blow it away.\nexport const useLocalStorage = <T>(\n  key: t.LocalStorageKey,\n  initialValue: T | (() => T),\n  override: boolean = false\n): [T, Dispatch<SetStateAction<T>>] => {\n  const [value, setValue] = useState(() => {\n    let firstValue: T;\n    const fromLocal = localStorage.getItem(key);\n    if (fromLocal !== null && fromLocal !== undefined && !override) {\n      firstValue = transit.fromJSON(fromLocal);\n    } else {\n      firstValue =\n        initialValue instanceof Function ? initialValue() : initialValue;\n    }\n    window.localStorage.setItem(key, transit.toJSON(firstValue));\n    return firstValue;\n  });\n\n  const setNewValue: Dispatch<SetStateAction<T>> = useCallback(\n    (valueAction: SetStateAction<T>) => {\n      setValue((oldValue: T) => {\n        const newValue =\n          valueAction instanceof Function ? valueAction(oldValue) : valueAction;\n        window.localStorage.setItem(key, transit.toJSON(newValue));\n        return newValue;\n      });\n    },\n    [key]\n  );\n  return [value, setNewValue];\n};\n\nexport const usePersistantToggle = (\n  key: t.LocalStorageKey,\n  initialValue: boolean\n): [boolean, () => void] => {\n  const [storageValue, setStorageValue] = useLocalStorage(key, initialValue);\n  const toggle = useCallback(() => {\n    setStorageValue(R.not);\n  }, [setStorageValue]);\n  return [storageValue, toggle];\n};\n\nexport const useToggle = (\n  initialValue: boolean,\n  sideEffect = (toggleState: boolean) => {}\n): [boolean, () => void] => {\n  const [value, setValue] = useState(initialValue);\n  const toggle = useCallback(\n    () =>\n      setValue((old: boolean) => {\n        const newValue = !old;\n        sideEffect(newValue);\n        return newValue;\n      }),\n    [sideEffect]\n  );\n  return [value, toggle];\n};\n\nexport const useAdvice = <T>(\n  [originalT, originalSetter]: [T, React.Dispatch<React.SetStateAction<T>>],\n  advice: (t: T) => T\n): [T, React.Dispatch<React.SetStateAction<T>>] => {\n  const newSetter = useCallback(\n    (action: React.SetStateAction<T>) => {\n      originalSetter(oldT =>\n        advice(action instanceof Function ? action(oldT) : action)\n      );\n    },\n    [advice, originalSetter]\n  );\n  useDetectChangedValue(advice, originalSetter);\n  return [originalT, newSetter];\n};\n\nexport const useDetectChangedValue = (...values: any[]) => {\n  const oldValues = useRef<any[]>(values);\n\n  useEffect(() => {\n    const lastValues = oldValues.current;\n    const newValues = values;\n    lastValues.forEach((lastValue: any, index: number) => {\n      const newValue = newValues[index];\n      if (newValue !== lastValue) {\n        const diff = d.detailedDiff(lastValue, newValue);\n        console.log(`Change at argument index: ${index}`, diff);\n      }\n    });\n    oldValues.current = values;\n  }, [values]);\n};\n\nexport const useAudioBuffer = (\n  audioContext: t.MAudioContext,\n  url: string\n): AudioBuffer | undefined => {\n  const [buffer, updateBuffer] = useState<AudioBuffer>();\n  useEffect(() => {\n    if (\n      // TODO - refactor this out into a helper method if possible.\n      audioContext !== undefined &&\n      audioContext !== \"not-supported\" &&\n      audioContext !== \"pending\"\n    ) {\n      fetch(url)\n        .then(response => response.arrayBuffer())\n        .then(buffer => audioContext.decodeAudioData(buffer))\n        .then(updateBuffer);\n    }\n  }, [url, audioContext]);\n  return buffer;\n};\n\nexport const useAudioContext = ():\n  | AudioContext\n  | undefined\n  | \"pending\"\n  | \"not-supported\" => {\n  const [audioContext, setAudioContext] = React.useState<\n    AudioContext | \"not-supported\" | \"pending\" | undefined\n  >();\n  const audioContextRef = React.useRef<AudioContext>();\n  const [hasFixed, setHasFixed] = React.useState(false);\n\n  const fixAudioContext = useCallback(() => {\n    if (!hasFixed) {\n      if (audioContextRef.current !== undefined) {\n        setAudioContext(\"pending\");\n        audioContextRef.current.resume().then(() => {\n          setHasFixed(true);\n          setAudioContext(audioContextRef.current);\n          document.removeEventListener(\"touchstart\", fixAudioContext);\n          document.removeEventListener(\"click\", fixAudioContext);\n          document.removeEventListener(\"touchend\", fixAudioContext);\n        });\n      }\n    }\n  }, [hasFixed, setHasFixed]);\n\n  React.useEffect(() => {\n    if (polyfill.AudioContext === undefined) {\n      setAudioContext(\"not-supported\");\n    } else {\n      const context = new polyfill.AudioContext();\n      audioContextRef.current = context;\n      if (context.state === \"suspended\") {\n        document.addEventListener(\"touchstart\", fixAudioContext);\n        document.addEventListener(\"click\", fixAudioContext);\n        document.addEventListener(\"touchend\", fixAudioContext);\n      } else {\n        setAudioContext(context);\n      }\n    }\n  }, [fixAudioContext]);\n\n  return audioContext;\n};\n","import React, { useState, useCallback, useEffect } from \"react\";\nimport * as R from \"ramda\";\nimport styled from \"styled-components\";\nimport { Button, Buttons, ToggleButton } from \"./Common\";\nimport * as hooks from \"../hooks\";\nimport * as t from \"../types\";\nimport * as immutable from \"immutable\";\nimport * as reactRedux from \"react-redux\";\nimport * as redux from \"../redux\";\n\ninterface Props {\n  metronome: t.Metronome;\n}\n\ninterface DivisionsProps {\n  uiEnabledDivisions: t.EnabledDivisions;\n  toggleDivisionOption: (option: t.Division) => void;\n  clearDivisions: () => void;\n}\n\nconst DivisionsWrapper = React.memo(styled.section`\n  display: flex;\n  align-items: baseline;\n  > div {\n    margin-right: 10px;\n  }\n`);\n\nconst Divisions: React.FC<DivisionsProps> = React.memo(\n  ({ uiEnabledDivisions, toggleDivisionOption, clearDivisions }) => {\n    return (\n      <DivisionsWrapper>\n        <div className=\"is-size-5\">Division</div>\n        <Buttons hasAddons grow style={{ marginRight: \"5px\" }}>\n          {([2, 3, 4, 5, 6] as t.Division[]).map((num: t.Division) => {\n            const on = uiEnabledDivisions.get(num)!;\n            return (\n              <ToggleButton\n                grow\n                on={on}\n                isPrimary\n                key={`division-options-${num}`}\n                onClick={() => toggleDivisionOption(num)}\n              >\n                {num}\n              </ToggleButton>\n            );\n          })}\n        </Buttons>\n        <Button grow isDanger isOutlined onClick={clearDivisions}>\n          Clear\n        </Button>\n      </DivisionsWrapper>\n    );\n  }\n);\n\nconst TimeSignature = ({ metronome }: Props) => {\n  const setSignature = React.useMemo(() => metronome.setSignature, [\n    metronome.setSignature\n  ]);\n  const numerator = React.useMemo(() => metronome.state.signature.numerator, [\n    metronome.state.signature.numerator\n  ]);\n\n  const [hasChanged, setHasChanged] = useState(false);\n  const [uIenabledDivisions, setUiEnabledDivisions] = hooks.useLocalStorage<\n    t.EnabledDivisions\n  >(\n    t.LocalStorageKey.EnabledDivisions,\n    immutable.Map<t.Division, boolean>().set(1, true)\n  );\n\n  useEffect(() => {\n    if (hasChanged) {\n      setSignature(old => ({\n        ...old,\n        numerator: immutable.List(\n          R.range(0, old.numerator.size).map(() => uIenabledDivisions)\n        )\n      }));\n    }\n  }, [uIenabledDivisions, hasChanged, setSignature]);\n\n  const toggleDivisionOption = useCallback(\n    (divisionOption: t.Division) => {\n      setHasChanged(true);\n      setUiEnabledDivisions(old => {\n        const oldValue = old.get(divisionOption);\n        const newValue = oldValue === undefined ? true : !oldValue;\n        return old.set(divisionOption, newValue);\n      });\n    },\n    [setUiEnabledDivisions]\n  );\n\n  const clearDivisions = useCallback(() => {\n    setUiEnabledDivisions(immutable.Map<t.Division, boolean>().set(1, true));\n  }, [setUiEnabledDivisions]);\n\n  // TODO - make it where clicking on a division group lets you set the volume & accents for that group.\n  // TODO - add an option to turn on or off the accent at the start of every measure.\n  // TODO - clean up these buttons to not use className.\n\n  const [currentNumerator, setCurrentNumerator] = React.useState(\n    numerator.size\n  );\n\n  React.useEffect(() => {\n    setSignature(old => ({\n      ...old,\n      numerator: immutable.List(\n        R.range(0, currentNumerator).map(() => uIenabledDivisions)\n      )\n    }));\n  }, [currentNumerator, setSignature, uIenabledDivisions]);\n\n  return (\n    <>\n      <Beats />\n      <Divisions\n        uiEnabledDivisions={uIenabledDivisions}\n        toggleDivisionOption={toggleDivisionOption}\n        clearDivisions={clearDivisions}\n      />\n      <Signature\n        currentNumerator={numerator.size}\n        setCurrentNumerator={setCurrentNumerator}\n      />\n    </>\n  );\n};\n\ninterface SignatureProps {\n  setCurrentNumerator: (numerator: number) => void;\n  currentNumerator: number;\n}\n\nconst Signature: React.FC<SignatureProps> = React.memo(\n  ({ setCurrentNumerator, currentNumerator }) => {\n    return (\n      <section className=\"section buttons is-centered\">\n        {[1, 2, 3, 4, 5].map(num => {\n          const on = currentNumerator === num;\n          return (\n            <ToggleButton\n              key={`numerator-button-${num}`}\n              on={on}\n              isPrimary\n              isOutlined\n              grow\n              onClick={on ? () => {} : () => setCurrentNumerator(num)}\n            >\n              <>{num}/4</>\n            </ToggleButton>\n          );\n        })}\n      </section>\n    );\n  }\n);\n\n// TODO - margin should be calculated based on number of divisions.\nconst BeatRowItemWrapper = React.memo(styled.div`\n  width: 1px;\n  margin-left: 1px;\n  margin-right: 1px;\n  flex-grow: 1;\n`);\n\n// TODO - margin should be calculated based on number of beats.\nconst BeatRowWrapper = React.memo(styled.div`\n  display: flex;\n  flex-grow: 1;\n`);\n\n// TODO - margin should be calculated based on number of beats.\nconst BeatWrapper = React.memo(styled.div`\n  display: flex;\n  flex-grow: 1;\n  flex-direction: column;\n`);\n\nconst BeatsWrapper = React.memo(styled.div`\n  display: flex;\n  flex-grow: 1;\n  margin-bottom: 10px;\n`);\n\n// TODO - the selected division values should reset when you stop the metronome.\n// TODO - If not playing, this should show the boring gray background.\nconst BeatRowItem: React.FC<{\n  on: boolean;\n  beatRows: number;\n}> = React.memo(({ on, beatRows }) => {\n  const className = React.useMemo(() => {\n    return on ? \"has-background-primary\" : \"has-background-link\";\n  }, [on]);\n  const height = React.useMemo(() => {\n    return 70 / beatRows;\n  }, [beatRows]);\n  return (\n    <BeatRowItemWrapper\n      className={className}\n      style={{\n        height,\n        marginTop: 1\n      }}\n    />\n  );\n});\n\nconst BeatRow: React.FC<{\n  bools: immutable.List<boolean>;\n  divisions: t.Division;\n  beatNumber: number;\n  beatRows: number;\n  rowIndex: number;\n}> = React.memo(({ bools, beatNumber, rowIndex, beatRows }) => {\n  const j = rowIndex;\n  const index = beatNumber;\n  return (\n    <BeatRowWrapper key={`${index}-${j}`}>\n      {bools.map((on, itemIndex) => (\n        <BeatRowItem\n          beatRows={beatRows}\n          key={`${index}-${rowIndex}-${itemIndex}`}\n          on={on}\n        />\n      ))}\n    </BeatRowWrapper>\n  );\n});\n\nconst Beat: React.FC<{\n  beat: immutable.Map<t.Division, immutable.List<boolean>>;\n  index: number;\n}> = React.memo(({ beat, index }) => {\n  const things = beat.entrySeq();\n  return (\n    <BeatWrapper key={`${index}`}>\n      {things.map(([divisions, bools], rowIndex) => (\n        <BeatRow\n          beatRows={things.size || 0}\n          key={`${index}-${rowIndex}`}\n          divisions={divisions}\n          bools={bools}\n          beatNumber={index}\n          rowIndex={rowIndex}\n        />\n      ))}\n    </BeatWrapper>\n  );\n});\n\nconst Beats: React.FC = React.memo(() => {\n  // TODO - once this hook is standardized, remove the weird casts.\n  const activeBeats: t.ActiveBeats = (reactRedux as any).useSelector(\n    (a: redux.ReduxState) => a.activeBeats\n  );\n  return (\n    <BeatsWrapper>\n      {activeBeats.map((beat, beatNumber) => (\n        <Beat key={beatNumber} beat={beat} index={beatNumber} />\n      ))}\n    </BeatsWrapper>\n  );\n});\n\nexport default TimeSignature;\n","import React, { useState } from \"react\";\nimport * as R from \"ramda\";\nimport { Button } from \"./Common\";\n\ninterface Props {\n  setBPM: (bpm: number) => void;\n}\n\nconst calculateBPM = R.pipe(\n  (tapTimes: number[]) => R.aperture(2, tapTimes),\n  R.map(([a, b]) => b - a),\n  R.mean,\n  R.divide(60000),\n  Math.trunc\n);\n\nconst TapIn = ({ setBPM }: Props) => {\n  const [taps, setTaps] = useState<number[]>([]);\n\n  const onTap = () => {\n    const now = performance.now();\n    const newTaps = R.append(now, taps).filter(tap => now - tap < 3000);\n    if (newTaps.length > 1) {\n      const bpm = calculateBPM(newTaps);\n      setBPM(bpm);\n    }\n    setTaps(newTaps);\n  };\n\n  return (\n    <Button isLink isOutlined onClick={onTap}>\n      Tap In\n    </Button>\n  );\n};\n\nexport default TapIn;\n","import React, { useEffect, useState } from \"react\";\nimport { useToggle } from \"../hooks\";\nimport { ToggleButton, Buttons } from \"./Common\";\nimport styled from \"styled-components\";\nimport * as polyfill from \"../polyfill\";\n\nconst noteIdx: { [note: number]: string } = {\n  0: \"A\",\n  1: \"Bb\",\n  2: \"B\",\n  3: \"C\",\n  4: \"Db\",\n  5: \"D\",\n  6: \"Eb\",\n  7: \"E\",\n  8: \"F\",\n  9: \"Gb\",\n  10: \"G\",\n  11: \"Ab\"\n};\n\nconst A4 = 440;\nconst notes: Array<{\n  octave: number;\n  note: string;\n  frequency: number;\n  centsPerOctave: number;\n}> = [];\nfor (let i = -4; i < 4; i++) {\n  for (let j = 0; j < 12; j++) {\n    const base = A4 * Math.pow(2, i);\n    const centsPerOctave = base / 1200;\n    const frequency = base * Math.pow(2, j / 12);\n    const octave = i + 4;\n    const note = noteIdx[j];\n    notes.push({ octave, note, frequency, centsPerOctave });\n  }\n}\n\nconst freqToPitch = (freq: number) => {\n  let low = 0;\n  for (let i = 0; i < notes.length; i++) {\n    let note = notes[i];\n    if (note.frequency >= freq) {\n      low = i;\n      break;\n    }\n  }\n  const high = low + 1;\n  const lowPitch = notes[low];\n  const highPitch = notes[high];\n  const average = (lowPitch.frequency + highPitch.frequency) / 2;\n  let note = notes[high];\n  let difference = note.frequency - freq;\n  if (freq < average) {\n    note = notes[low];\n  }\n  const cents = note.centsPerOctave * difference;\n  return Object.assign(note, { originalFrequency: freq, difference, cents });\n};\n\nconst Tuner = React.memo(() => {\n  const [on, toggleOn] = useToggle(false);\n  const [analyser, setAnalyser] = useState<AnalyserNode>();\n  const [sampleRate, setSampleRate] = useState<number>();\n  const [freq, setFreq] = useState<number>(440);\n  const [audioContext, setAudioContext] = useState<AudioContext>();\n\n  // Initailize the AudioContext when user turns on the tuner.\n  useEffect(() => {\n    if (on && !audioContext && polyfill.AudioContext !== undefined) {\n      setAudioContext(new polyfill.AudioContext());\n    }\n  }, [on, audioContext]);\n\n  // Prompt for microphone when user turns on the tuner.\n  useEffect(() => {\n    if (on && audioContext) {\n      setSampleRate(audioContext.sampleRate);\n      const mediaDevices = navigator.mediaDevices;\n      if (mediaDevices) {\n        let mediaStream: MediaStream;\n        mediaDevices.getUserMedia({ audio: true }).then((ms: MediaStream) => {\n          mediaStream = ms;\n          const analyser = audioContext.createAnalyser();\n          // If this isn't big, I don't have very good frequency accuracy, and I\n          // can't change the sample rate because web audio sucks.\n          analyser.fftSize = 8192;\n          const mic = audioContext.createMediaStreamSource(ms);\n          mic.connect(analyser);\n          setAnalyser(analyser);\n        });\n        return () => {\n          mediaStream.getAudioTracks().forEach(track => track.stop());\n        };\n      }\n    }\n  }, [on, audioContext]);\n\n  useEffect(() => {\n    if (on && analyser && sampleRate) {\n      const tick = () => {\n        const bufferLength = analyser.frequencyBinCount;\n        const dataArray = new Float32Array(bufferLength);\n        analyser.getFloatFrequencyData(dataArray);\n        const [, maxIdx] = dataArray.reduce(\n          (a, b, i) => (a[0] < b ? [b, i] : a),\n          [-Infinity, -1]\n        );\n        const resolution = sampleRate / analyser.fftSize;\n        const freq = resolution * maxIdx;\n        setFreq(freq);\n      };\n      tick();\n      let interval = setInterval(tick, 50);\n\n      return () => {\n        clearInterval(interval);\n      };\n    }\n  }, [on, analyser, sampleRate]);\n\n  const { octave, note, cents } = freqToPitch(freq || 0);\n  // TODO - add in a graph of the FFT that's label with pitches and neato log bars.\n  return (\n    <TunerWrapper className=\"box has-text-centered\">\n      <div className=\"is-size-1\">{on ? note + octave : \"Stopped\"}</div>\n\n      <div>\n        {on ? (\n          <>\n            {cents.toFixed(2)} Cents {cents < 0 ? \"flat\" : \"sharp\"}\n          </>\n        ) : (\n          \"press start to tune\"\n        )}\n      </div>\n      <Buttons className=\"is-right\">\n        <ToggleButton on={on} isDanger offIsPrimary onClick={toggleOn}>\n          <>Stop</>\n          <>Start</>\n        </ToggleButton>\n      </Buttons>\n    </TunerWrapper>\n  );\n});\n\nconst TunerWrapper = styled.section`\n  margin-top: 10px;\n`;\n\nexport default Tuner;\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport * as hooks from \"../hooks\";\nimport styled from \"styled-components\";\nimport * as t from \"../types\";\n\nconst Outer = styled.div`\n  margin: auto;\n  position: relative;\n  height: 300px;\n  width: 300px;\n  border-radius: 300px;\n  display: flex;\n  margin-bottom: 10px;\n`;\n\nconst Inner = styled.div`\n  width: 100px;\n  height: 100px;\n  border-radius: 100px;\n  position: absolute;\n  touch-action: none;\n`;\n\ninterface Props {\n  initialValue: number;\n  addDiff: (diff: number) => void;\n  size?: number;\n}\n\nconst InfiniKnob = ({\n  size = 300,\n  initialValue,\n  addDiff,\n  children\n}: React.PropsWithChildren<Props>) => {\n  const [stateRadians, setRadians] = hooks.useLocalStorage(\n    t.LocalStorageKey.Radians,\n    (initialValue * (Math.PI * 3)) / 2\n  );\n  const radiansRef = useRef(Math.PI);\n  useEffect(() => {\n    radiansRef.current = stateRadians;\n  }, [stateRadians]);\n\n  const [mouseDown, setMouseDown] = useState(false);\n  const mouseDownRef = useRef(false);\n  useEffect(() => {\n    mouseDownRef.current = mouseDown;\n  }, [mouseDown]);\n\n  const [totalDiff, setTotalDiff] = useState(0);\n  const totalDiffRef = useRef(0);\n  useEffect(() => {\n    totalDiffRef.current = totalDiff;\n  }, [totalDiff]);\n\n  const knobContainer = useRef<HTMLDivElement>(null);\n\n  const onMouseDown = useCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    setMouseDown(true);\n    e.preventDefault();\n  }, []);\n\n  const onMouseUp = useCallback((_: MouseEvent) => {\n    setMouseDown(false);\n  }, []);\n\n  const addToBuffer = useCallback(\n    (diff: number) => {\n      const threshold = 0.2;\n      if (Math.abs(totalDiffRef.current) < threshold) {\n        setTotalDiff(oldDiff => oldDiff + diff);\n      } else {\n        addDiff(totalDiffRef.current > 0 ? -1 : 1);\n        setTotalDiff(0);\n      }\n    },\n    [addDiff]\n  );\n\n  const moveKnob = useCallback(\n    (e: React.Touch | React.MouseEvent | MouseEvent) => {\n      const { clientX, clientY } = e;\n      const box = knobContainer.current!.getBoundingClientRect();\n\n      const boxCenter = {\n        x: box.left + box.width / 2,\n        y: box.top + box.height / 2\n      };\n      const y = -(boxCenter.y - clientY);\n      const x = -(boxCenter.x - clientX);\n      const newRadians = Math.atan2(y, x);\n      let diff = radiansRef.current - newRadians;\n      if (diff < -Math.PI) {\n        diff = -radiansRef.current - newRadians;\n      } else if (diff > Math.PI) {\n        diff = radiansRef.current - -newRadians;\n      }\n      if (diff !== 0) {\n        addToBuffer(diff);\n      }\n      const same = newRadians === radiansRef.current;\n      if (!same) {\n        setRadians(newRadians);\n      }\n    },\n    [addToBuffer, setRadians]\n  );\n\n  const onMouseMove = useCallback(\n    (e: React.MouseEvent<HTMLDivElement> | MouseEvent) => {\n      if (mouseDownRef.current) {\n        moveKnob(e);\n      }\n    },\n    [moveKnob]\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"mouseup\", onMouseUp);\n    window.addEventListener(\"mousemove\", onMouseMove);\n    return () => {\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n    };\n  }, [onMouseMove, onMouseUp]);\n\n  const onTouchMove = useCallback(\n    (e: React.TouchEvent<HTMLDivElement>) => {\n      const t = e.changedTouches;\n      const t0 = t[0];\n      moveKnob(t0);\n    },\n    [moveKnob]\n  );\n\n  const top = React.useMemo(\n    () =>\n      size / 2 +\n      Math.sin(stateRadians) * (size / 4) +\n      (Math.sin(stateRadians) * size) / 16 -\n      size / 6,\n    [stateRadians, size]\n  );\n  const left = React.useMemo(\n    () =>\n      size / 2 +\n      Math.cos(stateRadians) * (size / 4) +\n      (Math.cos(stateRadians) * size) / 16 -\n      size / 6,\n    [stateRadians, size]\n  );\n\n  return (\n    <Outer ref={knobContainer} className=\"has-background-primary\">\n      <Inner\n        className=\"has-background-info\"\n        onMouseDown={onMouseDown}\n        onTouchMove={onTouchMove}\n        style={{\n          top,\n          left\n        }}\n      />\n      <ChildContainer>{children}</ChildContainer>\n    </Outer>\n  );\n};\n\nconst ChildContainer = React.memo(styled.div`\n  align-self: center;\n  margin: auto;\n  z-index: 1;\n  pointer-events: none;\n`);\n\nexport default InfiniKnob;\n","export function assertNever(value: never): never {\n  throw new Error(\n    `Unhandled discriminated union member: ${JSON.stringify(value)}`\n  );\n}\n\nexport const shuffle = <T>(a: Array<T>) => {\n  var j, x, i;\n  for (i = a.length - 1; i > 0; i--) {\n    j = Math.floor(Math.random() * (i + 1));\n    x = a[i];\n    a[i] = a[j];\n    a[j] = x;\n  }\n  return a;\n};\n\nexport const runAtTime = (\n  audioContext: AudioContext,\n  timeToRun: number,\n  callback: () => void\n) => {\n  // const now = audioContext.currentTime;\n  // if (timeToRun <= now) {\n  //   callback();\n  // } else {\n  //   const sleepTime = ((timeToRun - now) / 2) * 1000;\n  //   setTimeout(() => runAtTime(audioContext, timeToRun, callback), sleepTime);\n  // }\n  setTimeout(callback, (timeToRun - audioContext.currentTime) * 1000);\n};\n","import * as redux from \"redux\";\nimport * as t from \"./types\";\nimport * as immutable from \"immutable\";\n\nexport enum ActionType {\n  UpdateActiveBeats,\n  SetActiveBeats\n}\n\nexport type Action =\n  | { type: ActionType.UpdateActiveBeats; value: t.Beat }\n  | { type: ActionType.SetActiveBeats; value: t.ActiveBeats };\n\nexport interface ReduxState {\n  activeBeats: t.ActiveBeats;\n}\n\nexport const setActiveBeats = (activeBeats: t.ActiveBeats) => {\n  store.dispatch({\n    type: ActionType.SetActiveBeats,\n    value: activeBeats\n  });\n};\n\nexport const updateActiveBeat = (beat: t.Beat) => {\n  store.dispatch({\n    type: ActionType.UpdateActiveBeats,\n    value: beat\n  });\n};\n\nconst rootReducer = (\n  store: ReduxState = { activeBeats: immutable.List() },\n  action: Action\n): ReduxState => {\n  switch (action.type) {\n    case ActionType.SetActiveBeats:\n      return { ...store, activeBeats: action.value };\n    case ActionType.UpdateActiveBeats:\n      const beat = action.value;\n      const old = store.activeBeats.getIn([\n        beat.currentBeat,\n        beat.divisions,\n        beat.divisionIndex\n      ]);\n      if (old === undefined) {\n        return store;\n      }\n      return {\n        activeBeats: store.activeBeats.setIn(\n          [beat.currentBeat, beat.divisions, beat.divisionIndex],\n          !old\n        )\n      };\n    default:\n      return store;\n  }\n};\n\nexport const store = redux.createStore(rootReducer);\n","import React, { useEffect, useState, useCallback, useRef } from \"react\";\nimport * as R from \"ramda\";\nimport * as t from \"./types\";\nimport { useLocalStorage, useAdvice, useAudioBuffer } from \"./hooks\";\nimport Deque from \"double-ended-queue\";\nimport { runAtTime } from \"./util\";\nimport * as hooks from \"./hooks\";\nimport * as immutable from \"immutable\";\nimport * as redux from \"./redux\";\n\nconst click = require(\"./click.wav\");\n\nconst scheduleNote = (\n  audioContext: AudioContext,\n  { time, gain, buffer, pitch, currentBeat, divisionIndex }: t.Beat\n) => {\n  const isOne = currentBeat === 0 && divisionIndex === 0;\n  const sound = audioContext.createBufferSource();\n  sound.buffer = buffer;\n  sound.detune.value = isOne ? 0 : -pitch;\n\n  const volume = audioContext.createGain();\n  volume.gain.value = isOne ? 1.0 : gain;\n\n  sound.connect(volume);\n  volume.connect(audioContext.destination);\n  sound.start(time);\n};\n\nconst beatsFor = (\n  startOfBeatTime: number,\n  secondsPerBeat: number,\n  divisions: t.EnabledDivisions,\n  buffer: AudioBuffer,\n  currentBeat: number\n): Array<t.Beat> => {\n  const beats: Array<t.Beat> = [];\n  divisions\n    .filter(a => a)\n    .forEach((_, divisionOption) => {\n      const noteOffset = secondsPerBeat / divisionOption;\n      for (\n        let divisionIndex = 0;\n        divisionIndex < divisionOption;\n        divisionIndex++\n      ) {\n        const time = startOfBeatTime + divisionIndex * noteOffset;\n        const divisionLength = noteOffset;\n        const beat: t.Beat = {\n          time,\n          divisionLength,\n          pitch: 220,\n          gain: 1.0 * 0.5,\n          buffer,\n          divisions: divisionOption,\n          divisionIndex,\n          currentBeat\n        };\n        beats.push(beat);\n      }\n    });\n  beats.sort((a, b) => a.time - b.time);\n  return beats;\n};\n\nconst playBeatsTill = (\n  beatsQueue: Deque<t.Beat>,\n  intervalLength: number,\n  audioContext: AudioContext,\n  updateUi: (audioContext: AudioContext, beat: t.Beat) => void\n) => {\n  const now = audioContext.currentTime;\n  const scheduleTil = now + intervalLength + intervalError;\n  while (beatsQueue.peekFront() && beatsQueue.peekFront()!.time < scheduleTil) {\n    const first = beatsQueue.shift()!;\n    if (first.divisionIndex !== 0 || first.divisions === 1) {\n      scheduleNote(audioContext, first);\n    }\n    updateUi(audioContext, first);\n  }\n};\n\n// TODO - I should clean this up if possible. It takes way too many arguments.\nconst addBeatsToQueue = (\n  state: t.State,\n  nextNoteTime: React.MutableRefObject<number>,\n  currentBeat: t.EnabledDivisions,\n  beatIdx: number,\n  currentTime: number,\n  scheduleAhead: number,\n  buffer: AudioBuffer,\n  beatsQueue: Deque<t.Beat>,\n  nextBeat: () => void\n) => {\n  const { bpm } = state;\n  const secondsPerBeat = 60.0 / bpm;\n  const divisions = currentBeat;\n  if (nextNoteTime.current < currentTime + scheduleAhead) {\n    const beatsForNextMeasure = beatsFor(\n      nextNoteTime.current,\n      secondsPerBeat,\n      divisions,\n      buffer,\n      beatIdx\n    );\n    beatsQueue.push(...beatsForNextMeasure);\n    nextNoteTime.current += secondsPerBeat;\n    nextBeat();\n  }\n};\n\nconst intervalError = 0.1;\n\nconst useScheduleAhead = (audioContext: t.MAudioContext, state: t.State) => {\n  const scheduleAhead = 0.3;\n  const { playing } = state;\n  const buffer = useAudioBuffer(audioContext, click);\n  const nextNoteTimeRef = useRef<number>(0);\n  const delay = playing ? (scheduleAhead * 1000) / 2 : undefined;\n\n  const stateRef = useRef<t.State>(state);\n  useEffect(() => {\n    stateRef.current = state;\n  }, [state]);\n\n  const beatToScheduleRef = useRef(0);\n  useEffect(() => {\n    if (!state.playing) {\n      beatToScheduleRef.current = 0;\n    }\n  }, [state.playing]);\n\n  const nextBeat = () => {\n    let old = beatToScheduleRef.current;\n    beatToScheduleRef.current =\n      (old + 1) % stateRef.current.signature.numerator.size;\n  };\n\n  // TODO - because the ui callbacks run in the future, I can get in a weird\n  // spot state-wise. I should figure out a way to either cancel them running\n  // when the number of divisions changes.\n  const updateUi = useCallback((audioContext: AudioContext, beat: t.Beat) => {\n    // We ovewrite activeBeats here because it's definitely changing.\n    runAtTime(audioContext, beat.time, () => {\n      if (stateRef.current.playing) {\n        // setActiveBeat(beat);\n\n        // TODO - this is super janky.\n        // TODO - this would be much nicer with an animation.\n        // TODO - switch this to runAtTime to clear the beat it just set.\n        // TODO - If the division changes, we should reset all active beats to false.\n        redux.updateActiveBeat(beat);\n      }\n    });\n  }, []);\n\n  useEffect(() => {\n    if (\n      delay !== undefined &&\n      audioContext !== undefined &&\n      audioContext !== \"not-supported\" &&\n      audioContext !== \"pending\" &&\n      buffer !== undefined\n    ) {\n      const beatsQueue = new Deque<t.Beat>();\n      const firstClickTime = audioContext.currentTime + 0.3;\n      nextNoteTimeRef.current = firstClickTime;\n      const tick = () => {\n        const {\n          signature: { numerator }\n        } = stateRef.current;\n        const beatIdx = Math.min(beatToScheduleRef.current, numerator.size - 1);\n        const currentBeat = numerator.get(beatIdx)!;\n\n        addBeatsToQueue(\n          stateRef.current,\n          nextNoteTimeRef,\n          currentBeat,\n          beatToScheduleRef.current,\n          audioContext.currentTime,\n          scheduleAhead,\n          buffer,\n          beatsQueue,\n          nextBeat\n        );\n        playBeatsTill(beatsQueue, delay / 1000, audioContext, updateUi);\n      };\n      tick();\n      const id = setInterval(tick, delay);\n      return () => {\n        clearInterval(id);\n      };\n    }\n  }, [delay, buffer, audioContext, updateUi]);\n};\n\nconst resetActiveBeats = (\n  beats: immutable.List<t.EnabledDivisions>\n): immutable.List<t.ActiveBeat> =>\n  immutable.List(\n    beats.map((enabledDivisions: t.EnabledDivisions) =>\n      enabledDivisions.reduce((acc, b, d) => {\n        return b\n          ? acc.set(d, immutable.List(R.range(0, d).map(() => true)))\n          : acc;\n      }, immutable.Map<t.Division, immutable.List<boolean>>())\n    )\n  );\n\nconst clampBPM = (bpm: number) => R.clamp(10, 250, bpm);\n\nconst defaultBeat = immutable.Map<t.Division, boolean>().set(1, true);\n\nconst useMetronome = (audioContext: t.MAudioContext): t.Metronome => {\n  const [playing, setPlaying] = useState(false);\n  const [bpm, setBPM] = useAdvice(\n    useLocalStorage(t.LocalStorageKey.BPM, 90),\n    clampBPM\n  );\n  const [signature, setSignature] = hooks.useLocalStorage<t.TimeSignature>(\n    t.LocalStorageKey.TimeSignature,\n    {\n      denominator: 4,\n      numerator: immutable.List([\n        defaultBeat,\n        defaultBeat,\n        defaultBeat,\n        defaultBeat\n      ])\n    }\n  );\n\n  const state: t.State = {\n    bpm,\n    playing,\n    pending: audioContext === \"pending\",\n    ready:\n      audioContext !== undefined &&\n      audioContext !== \"pending\" &&\n      audioContext !== \"not-supported\",\n    signature\n  };\n  const { numerator } = signature;\n\n  const bpmRef = useRef(bpm);\n  useEffect(() => {\n    bpmRef.current = bpm;\n  }, [bpm]);\n\n  // Effects for updating state.\n\n  // If the time signature changes, we need to reset the active subdivisions.\n  useEffect(() => {\n    // TODO - This would be fancier if when the next beat can still happen, it\n    // didn't clear the active beat in the UI.\n    redux.setActiveBeats(resetActiveBeats(numerator));\n  }, [numerator, signature]);\n\n  useEffect(() => {\n    if (!playing) {\n      redux.setActiveBeats(resetActiveBeats(numerator));\n      setTimeout(() => {\n        redux.setActiveBeats(resetActiveBeats(numerator));\n      }, 300);\n    }\n  }, [playing, numerator]);\n\n  useScheduleAhead(audioContext, state);\n\n  // External API Things.\n  const addBPM = React.useCallback(\n    (bpmToAdd: number) => {\n      setBPM(R.add(bpmToAdd));\n    },\n\n    [setBPM]\n  );\n\n  const toggleStart = React.useCallback(() => setPlaying(R.not), [setPlaying]);\n\n  const start = useCallback(\n    (bpm?: number) => {\n      if (bpm !== undefined) {\n        setBPM(bpm);\n      }\n      setPlaying(true);\n    },\n    [setPlaying, setBPM]\n  );\n\n  const stop = useCallback(() => {\n    setPlaying(false);\n  }, [setPlaying]);\n\n  return {\n    toggleStart,\n    setSignature,\n    start,\n    stop,\n    setBPM,\n    addBPM,\n    state\n  };\n};\nexport default useMetronome;\n","import React, { useEffect } from \"react\";\nimport TempoMarking from \"./TempoMarking\";\nimport TimeSignature from \"./TimeSignature\";\nimport TapIn from \"./TapIn\";\nimport Tuner from \"./Tuner\";\nimport Dial from \"./Dial\";\nimport { usePersistantToggle, useSleepLock } from \"../hooks\";\nimport { Buttons, ToggleButton } from \"./Common\";\nimport useMetronome from \"../metronome\";\nimport * as t from \"../types\";\nimport styled from \"styled-components\";\n\nconst FullPage = styled.div`\n  margin: 0 !important;\n  height: 100%;\n  width: 100%;\n  position: fixed;\n  z-index: 1;\n  left: 0;\n  top: 0;\n  background-color: rgba(0, 0, 0, 0.8);\n  color: white;\n  text-align: center;\n`;\n\ninterface MetronomeProps {\n  audioContext: t.MAudioContext;\n  appSettings: t.AppSettings;\n}\nconst Metronome: React.FC<MetronomeProps> = ({ appSettings, audioContext }) => {\n  const metronome = useMetronome(audioContext);\n  const {\n    state: { keepAwake }\n  } = appSettings;\n  const [showTuner, toggleTuner] = usePersistantToggle(\n    t.LocalStorageKey.ShowTuner,\n    false\n  );\n  const { lock, release } = useSleepLock();\n  const playing = React.useMemo(() => metronome.state.playing, [\n    metronome.state.playing\n  ]);\n  // TODO - I don't know if this is actually necessary or not.\n  const bpm = React.useMemo(() => metronome.state.bpm, [metronome.state.bpm]);\n  const pending = React.useMemo(() => metronome.state.pending, [\n    metronome.state.pending\n  ]);\n  const addBPM = React.useMemo(() => {\n    return metronome.addBPM;\n  }, [metronome.addBPM]);\n  const setBPM = React.useMemo(() => metronome.setBPM, [metronome.setBPM]);\n  const toggleStart = React.useMemo(() => metronome.toggleStart, [\n    metronome.toggleStart\n  ]);\n\n  useEffect(() => {\n    if (keepAwake && playing) {\n      lock();\n    } else {\n      release();\n    }\n  }, [playing, keepAwake, lock, release]);\n\n  return (\n    <>\n      {pending && <FullPage>Tap to enable audio.</FullPage>}\n      {showTuner && <Tuner />}\n      <section className=\"section\">\n        <Dial initialValue={bpm} addDiff={addBPM}>\n          <div className=\"has-text-centered is-size-1\">{bpm}</div>\n          <TempoMarking bpm={bpm} />\n        </Dial>\n      </section>\n      <TimeSignature metronome={metronome} />\n      <Controls\n        showTuner={showTuner}\n        toggleTuner={toggleTuner}\n        toggleStart={toggleStart}\n        playing={playing}\n        setBPM={setBPM}\n        pending={pending}\n      />\n    </>\n  );\n};\n\ninterface ControlsProps {\n  showTuner: boolean;\n  toggleTuner: () => void;\n  playing: boolean;\n  toggleStart: () => void;\n  setBPM: (bpm: number) => void;\n  pending: boolean;\n}\n\nconst Controls: React.FC<ControlsProps> = React.memo(\n  ({ showTuner, toggleTuner, playing, toggleStart, setBPM, pending }) => {\n    return (\n      <section className=\"section\">\n        <Buttons hasAddons>\n          <ToggleButton\n            isLink\n            offIsOutlined\n            offIsLink\n            on={showTuner}\n            onClick={toggleTuner}\n          >\n            Tuner\n          </ToggleButton>\n          <TapIn setBPM={setBPM} />\n          <ToggleButton\n            on={playing}\n            offIsPrimary\n            grow\n            isOutlined\n            isDanger\n            disabled={pending}\n            onClick={toggleStart}\n          >\n            <>Stop</>\n            <>Start</>\n          </ToggleButton>\n        </Buttons>\n      </section>\n    );\n  }\n);\nexport default Metronome;\n","import React from \"react\";\nimport * as t from \"../types\";\nimport styled from \"styled-components\";\n\ninterface SettingsProps {\n  appSettings: t.AppSettings;\n}\n\nconst SettingsWrapper = styled.section``;\n\nconst Settings: React.FC<SettingsProps> = ({ appSettings }) => {\n  const {\n    state: { keepAwake },\n    toggleKeepAwake\n  } = appSettings;\n  return (\n    <SettingsWrapper>\n      <h2 className=\"is-size-4\">Settings</h2>\n      <div className=\"field\">\n        <div className=\"control\">\n          <label className=\"checkbox\">\n            <input\n              style={{ marginRight: \"5px\" }}\n              type=\"checkbox\"\n              checked={keepAwake}\n              onChange={toggleKeepAwake}\n            />\n            Keep screen on while metronome is running.\n          </label>\n        </div>\n      </div>\n    </SettingsWrapper>\n  );\n};\n\nexport default Settings;\n","import React from \"react\";\nimport TimeSignature from \"./TimeSignature\";\nimport * as hooks from \"../hooks\";\nimport * as util from \"../util\";\nimport * as t from \"../types\";\nimport { Button, Buttons, ToggleButton } from \"./Common\";\nimport useScales from \"../scales\";\nimport useMetronome from \"../metronome\";\n\nenum ScaleMode {\n  NOT_STARTED = \"not-started\",\n  KNOWN = \"known\",\n  LEARNING = \"learning\"\n}\n\nconst ScalesGroup = ({\n  scaleKey: [pitch, mode],\n  learning,\n  known,\n  toggleLearning,\n  toggleKnown\n}: t.Scale & { toggleLearning: () => void; toggleKnown: () => void }) => {\n  return (\n    <div className=\"is-grouped field has-addons\">\n      <div className=\"is-size-5 control is-expanded\">\n        {pitch} {mode}\n      </div>\n      <Buttons>\n        <ToggleButton on={known} isInfo onClick={toggleKnown}>\n          Known\n        </ToggleButton>\n        <ToggleButton on={learning} isLink onClick={toggleLearning}>\n          Learning\n        </ToggleButton>\n      </Buttons>\n    </div>\n  );\n};\n\ninterface LearnScalesProps {\n  scales: t.Scales;\n  metronome: t.Metronome;\n  reset: () => void;\n  scaleMode: ScaleMode;\n}\n\nconst LearnScales: React.FC<LearnScalesProps> = ({\n  scales,\n  reset,\n  scaleMode,\n  metronome\n}) => {\n  const { getScales, getScale, addBPM } = scales;\n  const [scaleKeys, setScales] = React.useState<Array<t.ScaleKey>>(() =>\n    util.shuffle(\n      getScales(s => {\n        if (scaleMode === ScaleMode.LEARNING) {\n          return s.learning;\n        } else if (scaleMode === ScaleMode.KNOWN) {\n          return s.known;\n        }\n        return false;\n      })\n        .valueSeq()\n        .map(({ scaleKey }) => scaleKey)\n        .toArray()\n    )\n  );\n\n  const start = React.useCallback(metronome.start, [metronome.start]);\n\n  const nextScale = () => {\n    setScales(old => {\n      const nu = old.slice(1);\n      if (nu.length === 0) {\n        reset();\n      }\n      return nu;\n    });\n  };\n\n  const currentKey = scaleKeys[0] || [];\n  const maybeScale = getScale(\n    (s: t.Scale) => s.mode === currentKey[1] && s.pitch === currentKey[0]\n  );\n  React.useEffect(() => {\n    if (maybeScale !== undefined) {\n      start(maybeScale.bpm);\n    }\n  }, [maybeScale, start]);\n  const nextScaleText = scaleKeys.length > 1 ? \"Next Scale\" : \"Finish\";\n\n  // TODO - this error handling makes me sad, I should really do better.\n  if (scaleKeys.length === 0) {\n    return <div>No more scales</div>;\n  }\n  const scale = maybeScale!;\n  const { mode, pitch, bpm } = scale!;\n\n  return (\n    <>\n      <div className=\"box\">\n        <div\n          style={{ alignSelf: \"center\", fontWeight: \"bold\" }}\n          className=\"control is-expanded is-size-5\"\n        >\n          {scaleMode}\n        </div>\n        <div style={{ display: \"flex\", marginBottom: \"5px\" }}>\n          <div style={{ alignSelf: \"center\", marginRight: \"10px\" }}>\n            {pitch} {mode} @ {bpm}bpm\n          </div>\n          <Buttons grow hasAddons>\n            <Button isDanger isOutlined grow onClick={() => addBPM(scale, -10)}>\n              -10\n            </Button>\n            <Button isDanger isOutlined grow onClick={() => addBPM(scale, -1)}>\n              -\n            </Button>\n            <Button isPrimary isOutlined grow onClick={() => addBPM(scale, 1)}>\n              +\n            </Button>\n            <Button isPrimary isOutlined grow onClick={() => addBPM(scale, 10)}>\n              +10\n            </Button>\n          </Buttons>\n        </div>\n        <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n          <Button isDanger isOutlined onClick={reset}>\n            Stop\n          </Button>\n          <Button isPrimary onClick={nextScale}>\n            {nextScaleText}\n          </Button>\n        </div>\n      </div>\n      <TimeSignature metronome={metronome} />\n    </>\n  );\n};\n\ninterface ScalesProps {\n  audioContext: t.MAudioContext;\n}\n\n// TODO - Add a button to start learning a new scale. This will be a scale\n// that is know known and is not learning.\nconst Scales: React.FC<ScalesProps> = ({ audioContext }) => {\n  // TODO wrap this in a useCallback.\n  const metronome = useMetronome(audioContext);\n  const { stop: stopMetronome } = metronome;\n\n  const [scaleMode, setScaleMode] = React.useState(ScaleMode.NOT_STARTED);\n  const [showKnown, toggleShowKnown] = hooks.usePersistantToggle(\n    t.LocalStorageKey.ShowKnown,\n    false\n  );\n\n  React.useEffect(() => {\n    if (scaleMode === ScaleMode.NOT_STARTED) {\n      stopMetronome();\n    }\n  }, [scaleMode, stopMetronome]);\n\n  const scales = useScales();\n  const { getScale, getScales, toggleLearning, toggleKnown } = scales;\n\n  return (\n    <div style={{ marginTop: \"10px\" }}>\n      {scaleMode === ScaleMode.NOT_STARTED ? (\n        <div style={{ marginBottom: \"5px\" }}>\n          <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n            <div\n              style={{ alignSelf: \"center\", fontWeight: \"bold\" }}\n              className=\"control is-expanded is-size-5\"\n            >\n              Scales\n            </div>\n            <Buttons>\n              <Button\n                onClick={() => setScaleMode(ScaleMode.KNOWN)}\n                disabled={getScale(s => s.known) === undefined}\n                className=\"is-info is-outlined\"\n              >\n                Start Known\n              </Button>\n              <Button\n                onClick={() => setScaleMode(ScaleMode.LEARNING)}\n                disabled={getScale(s => s.learning) === undefined}\n                className=\"is-link is-outlined\"\n              >\n                Start Learning\n              </Button>\n            </Buttons>\n          </div>\n          <hr />\n\n          <Buttons>\n            <Button\n              onClick={toggleShowKnown}\n              className={`${\n                showKnown ? \"is-primary is-outlined\" : \"is-danger\"\n              }`}\n            >\n              {showKnown ? \"Hide Known\" : \"Show Known\"}\n            </Button>\n          </Buttons>\n          {getScales(\n            s =>\n              s.mode === t.Mode.Major && (showKnown ? true : s.known === false)\n          ).map((scale: t.Scale) => (\n            <ScalesGroup\n              key={`${scale.pitch}-${scale.mode}`}\n              {...scale}\n              toggleLearning={() => toggleLearning(scale)}\n              toggleKnown={() => toggleKnown(scale)}\n            />\n          ))}\n          <hr />\n          {getScales(\n            s =>\n              s.mode === t.Mode.Minor && (showKnown ? true : s.known === false)\n          ).map((scale: t.Scale) => (\n            <ScalesGroup\n              key={`${scale.pitch}-${scale.mode}`}\n              {...scale}\n              toggleLearning={() => toggleLearning(scale)}\n              toggleKnown={() => toggleKnown(scale)}\n            />\n          ))}\n        </div>\n      ) : (\n        <LearnScales\n          scaleMode={scaleMode}\n          scales={scales}\n          reset={() => setScaleMode(ScaleMode.NOT_STARTED)}\n          metronome={metronome}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Scales;\n","import React from \"react\";\nimport * as t from \"./types\";\nimport * as hooks from \"./hooks\";\nimport * as immutable from \"immutable\";\n\nconst initScale = (scaleKey: t.ScaleKey): t.Scale => ({\n  scaleKey,\n  pitch: scaleKey[0],\n  mode: scaleKey[1],\n  known: false,\n  learning: false,\n  bpm: 60\n});\n\nconst addScale = (scalesDB: t.ScalesDB, key: t.ScaleKey): t.ScalesDB => {\n  return scalesDB.add(initScale(key));\n};\n\nconst initScalesDB = (): t.ScalesDB => {\n  return t.scaleKeys.reduce(\n    (scalesDB: t.ScalesDB, scaleKey) => addScale(scalesDB, scaleKey),\n    immutable.Set() as t.ScalesDB\n  );\n};\n\nexport const getScale = (\n  scalesDB: t.ScalesDB,\n  filter: (s: t.Scale) => boolean\n): t.Scale | undefined => {\n  return getScales(scalesDB, filter).first();\n};\n\nconst getScales = (scalesDB: t.ScalesDB, filter: (s: t.Scale) => boolean) => {\n  return scalesDB.filter(filter);\n};\n\nconst useScales = (): t.Scales => {\n  const [scalesDB, setScalesDB] = hooks.useLocalStorage<t.ScalesDB>(\n    t.LocalStorageKey.ScalesDB,\n    initScalesDB\n  );\n\n  const addScalePublic = React.useCallback(() => {\n    throw new Error(\"not implemented\");\n  }, []);\n\n  const getScalePublic = React.useCallback(\n    (filter: (s: t.Scale) => boolean) => getScale(scalesDB, filter),\n    [scalesDB]\n  );\n\n  const getScalesPublic = React.useCallback(\n    (filter: (s: t.Scale) => boolean) =>\n      getScales(scalesDB, filter).sort((a, b) =>\n        a.scaleKey[0].localeCompare(b.scaleKey[0])\n      ),\n    [scalesDB]\n  );\n\n  const addBPMPublic = React.useCallback(\n    (s: t.Scale, bpm: number) => {\n      const scale = scalesDB.get(s);\n      if (scale) {\n        setScalesDB(\n          scalesDB.remove(scale).add({ ...scale, bpm: scale.bpm + bpm })\n        );\n      }\n    },\n    [scalesDB, setScalesDB]\n  );\n  const toggleLearningPublic = React.useCallback(\n    (s: t.Scale) => {\n      const scale = scalesDB.get(s);\n      if (scale) {\n        setScalesDB(\n          scalesDB.remove(scale).add({ ...scale, learning: !scale.learning })\n        );\n      }\n    },\n    [scalesDB, setScalesDB]\n  );\n  const toggleKnownPublic = React.useCallback(\n    (s: t.Scale) => {\n      const scale = scalesDB.get(s);\n      if (scale) {\n        setScalesDB(\n          scalesDB.remove(scale).add({ ...scale, known: !scale.known })\n        );\n      }\n    },\n    [scalesDB, setScalesDB]\n  );\n\n  // TODO - these should probably use a ref so they don't change as often.\n  return {\n    addBPM: addBPMPublic,\n    toggleLearning: toggleLearningPublic,\n    toggleKnown: toggleKnownPublic,\n    addScale: addScalePublic,\n    getScale: getScalePublic,\n    getScales: getScalesPublic\n  };\n};\nexport default useScales;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React, { useState, useEffect } from \"react\";\nimport * as serviceWorker from \"../serviceWorker\";\nimport { Buttons, Button, maxWidth } from \"./Common\";\nimport styled, { keyframes } from \"styled-components\";\n\nconst rotate = keyframes`\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n`;\n\nconst UpdateStyle = styled.section`\n  position: absolute;\n  max-width: ${maxWidth};\n  width: 95%;\n  margin-top: 10px;\n  left: 0;\n  right: 0;\n  margin-left: auto !important;\n  margin-right: auto !important;\n  z-index: 10;\n  display: flex !important;\n  justify-content: space-between;\n  animation: ease-in 1s ${rotate};\n`;\n\nlet hasRegistered = false;\nexport default () => {\n  const [updateAvailable, setUpdateAvailable] = useState(false);\n\n  const reload = React.useCallback(() => {\n    window.location.reload();\n  }, []);\n\n  const close = React.useCallback(() => {\n    setUpdateAvailable(false);\n  }, []);\n\n  useEffect(() => {\n    if (!hasRegistered) {\n      serviceWorker.register({\n        onUpdate: () => {\n          setUpdateAvailable(true);\n        }\n      });\n    }\n    hasRegistered = true;\n  }, []);\n  return (\n    <>\n      {updateAvailable && (\n        <UpdateStyle className=\"box\">\n          <span>An Update is Available!</span>\n          <Buttons>\n            <Button isPrimary isOutlined onClick={reload}>\n              Refresh\n            </Button>\n            <Button isDanger isOutlined onClick={close}>\n              x\n            </Button>\n          </Buttons>\n        </UpdateStyle>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport * as t from \"./types\";\nimport * as hooks from \"./hooks\";\n\nconst initSettings = (): t.AppSettings[\"state\"] => ({\n  keepAwake: false\n});\n\nexport const useAppSettings = (): t.AppSettings => {\n  const [state, setState] = hooks.useLocalStorage<t.AppSettings[\"state\"]>(\n    t.LocalStorageKey.AppSettings,\n    initSettings\n  );\n\n  const toggleKeepAwake = React.useCallback(() => {\n    setState(old => ({ ...old, keepAwake: !old.keepAwake }));\n  }, [setState]);\n\n  return {\n    state,\n    toggleKeepAwake\n  };\n};\n","import React from \"react\";\nimport Metronome from \"./Metronome\";\nimport Settings from \"./Settings\";\nimport Scales from \"./Scales\";\nimport { BrowserRouter as Router, Route, Link } from \"react-router-dom\";\nimport Update from \"./Update\";\nimport { useAppSettings } from \"../settings\";\nimport styled, { keyframes } from \"styled-components\";\nimport { maxWidth } from \"./Common\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faBars as faCoffee,\n  faHome,\n  faCog as faGear,\n  faMusic\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { useToggle } from \"../hooks\";\nimport * as hooks from \"../hooks\";\n\nconst TopBarWrapper = React.memo(styled.section`\n  margin-bottom: 10px;\n  margin-left: 0px !important;\n  margin-right: 0px !important;\n  display: flex;\n  flex-direction: column;\n`);\n\nconst CenterIcon = React.memo(styled.span`\n  align-self: center;\n`);\n\nconst TopNav = React.memo(styled.section`\n  display: flex;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  padding-left: 10px;\n  padding-right: 10px;\n  justify-content: space-between;\n  > h2 {\n    margin: 0 !important;\n  }\n`);\n\nconst dropDown = keyframes`\n  from {\nfont-size: 0px;\n  }\n`;\n\nconst NavDropDown = React.memo(styled.nav`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  padding-right: 10px;\n  align-self: flex-end;\n  > a {\n    animation: ease-in 0.3s ${dropDown};\n    font-size: 1.5rem;\n  }\n`);\n\nconst NavItem = React.memo(styled(Link)``);\n\nconst NavIcon = React.memo(styled(FontAwesomeIcon)`\n  margin-left: 5px;\n`);\n\nconst TopBar = React.memo(() => {\n  const [showNav, toggleNav] = useToggle(false);\n  // TODO - figure out how to animate the nav being hidden.\n  // TODO - make it where clicking outside of this element hides it.\n  // TODO - make it where you can swipe from the right of the screen to show the nav.\n  return (\n    <TopBarWrapper>\n      <TopNav className=\"has-background-primary has-text-light\">\n        <Link to=\"/\" className=\"has-text-white\">\n          <h2 className=\"is-size-4 is-bold\">(mjh)tronome</h2>\n        </Link>\n        <CenterIcon onClick={toggleNav}>\n          <FontAwesomeIcon icon={faCoffee} size=\"2x\" />\n        </CenterIcon>\n      </TopNav>\n      {showNav && (\n        <NavDropDown onClick={toggleNav}>\n          <NavItem to=\"/\">\n            Home\n            <NavIcon icon={faHome} />\n          </NavItem>\n          <NavItem to=\"/scales\">\n            Scales\n            <NavIcon icon={faMusic} />\n          </NavItem>\n          <NavItem to=\"/settings\">\n            Settings\n            <NavIcon icon={faGear} />\n          </NavItem>\n        </NavDropDown>\n      )}\n    </TopBarWrapper>\n  );\n});\n\nconst WrapperStyle = React.memo(styled.div`\n  max-width: ${maxWidth};\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  > * {\n    margin-left: 10px;\n    margin-right: 10px;\n  }\n`);\n\nconst FooterStyle = React.memo(styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  justify-content: flex-end;\n  margin-top: 5px;\n`);\n\nconst Wrapper: React.FC = React.memo(({ children }) => {\n  return (\n    <WrapperStyle>\n      <Update />\n      <TopBar />\n      {children}\n      <FooterStyle>{`v${process.env.REACT_APP_VERSION}`}</FooterStyle>\n    </WrapperStyle>\n  );\n});\n\n// TODO - add a button to the overall exception handler that lets you clear local storage.\n// TODO - add an option to the settings to clear local storage.\n// TODO - update components to use the React.FC type.\nconst App: React.FC = () => {\n  const appSettings = useAppSettings();\n  const audioContext = hooks.useAudioContext();\n  return (\n    <Router basename={process.env.PUBLIC_URL}>\n      <Wrapper>\n        {audioContext === \"not-supported\" && (\n          <div>\n            Your browser doesn't support the audioContext api, so this will not\n            work. Sorry :(\n          </div>\n        )}\n        <Route\n          exact\n          path=\"/\"\n          render={() => (\n            <Metronome audioContext={audioContext} appSettings={appSettings} />\n          )}\n        />\n        <Route\n          exact\n          path=\"/scales\"\n          render={() => <Scales audioContext={audioContext} />}\n        />\n        <Route\n          exact\n          path=\"/settings\"\n          render={() => <Settings appSettings={appSettings} />}\n        />\n      </Wrapper>\n    </Router>\n  );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./components/App\";\nimport \"./bulma-overrides.sass\";\nimport { Provider } from \"react-redux\";\nimport { store } from \"./redux\";\n\nclass ErrorBoundary extends React.Component<{}, { error: any }> {\n  constructor(props: { error: any }) {\n    super(props);\n    this.state = { error: undefined };\n  }\n\n  static getDerivedStateFromError(error: any) {\n    return { error };\n  }\n\n  render() {\n    if (this.state.error) {\n      return (\n        <div>\n          <h1>Something went wrong</h1>\n          <hr />\n          <code>\n            {this.state.error instanceof Error && this.state.error.name}\n          </code>\n          <hr />\n          <code>\n            {this.state.error instanceof Error && this.state.error.message}\n          </code>\n          <hr />\n          <code>\n            {this.state.error instanceof Error && this.state.error.stack}\n          </code>\n          <hr />\n          <code>{JSON.stringify(this.state.error, undefined, \"  \")}</code>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n\nReactDOM.render(\n  <Provider store={store}>\n    <ErrorBoundary>\n      <App />\n    </ErrorBoundary>\n  </Provider>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}