(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{66:function(e,n,t){e.exports=t(90)},81:function(e,n,t){e.exports=t.p+"static/media/click.b48ed3e5.wav"},89:function(e,n,t){},90:function(e,n,t){"use strict";t.r(n);var a,r,o,i=t(51),c=t(52),u=t(63),s=t(53),l=t(64),m=t(0),f=t.n(m),d=t(23),g=t.n(d),v=t(1),b=t(4),p=t(10),h=t(93),E=t(9),j=t(30);!function(e){e.EnabledDivisions="@mjh/k/enabled-divisions-0",e.AppSettings="@mjh/k/app-settings-0",e.SignatureDivisions="@mjh/k/signature-divisions-3",e.ShowKnown="@mjh/k/show-known-2",e.ScalesDB="@mjh/k/scales-db-2",e.ActiveBeats="@mjh/k/active-beats-2",e.TimeSignature="@mjh/k/signature-3",e.BPM="@mjh/k/bpm-0",e.KnownScales="@mjh/k/known-scales-0",e.ShowScales="@mjh/k/show-scales-0",e.ShowTuner="@mjh/k/show-tuner-0",e.ShowDial="@mjh/k/show-dial-0",e.Radians="@mjh/k/radians-0",e.WakeLock="@mjh/k/wake-lock-0"}(a||(a={})),function(e){e.Major="Major",e.Minor="Minor"}(r||(r={})),function(e){e.A="A",e.B="B",e.C="C",e.D="D",e.E="E",e.F="F",e.G="G",e.A_Flat="Ab",e.B_Flat="Bb",e.C_Flat="Cb",e.D_Flat="Db",e.E_Flat="Eb",e.F_Flat="Fb",e.G_Flat="Gb",e.A_Sharp="A#",e.B_Sharp="B#",e.C_Sharp="C#",e.D_Sharp="D#",e.E_Sharp="E#",e.F_Sharp="F#",e.G_Sharp="G#"}(o||(o={}));var O=[[o.A,r.Major],[o.B,r.Major],[o.C,r.Major],[o.D,r.Major],[o.E,r.Major],[o.F,r.Major],[o.G,r.Major],[o.A_Flat,r.Major],[o.B_Flat,r.Major],[o.C_Flat,r.Major],[o.D_Flat,r.Major],[o.E_Flat,r.Major],[o.G_Flat,r.Major],[o.C_Sharp,r.Major],[o.F_Sharp,r.Major],[o.A,r.Minor],[o.B,r.Minor],[o.C,r.Minor],[o.D,r.Minor],[o.E,r.Minor],[o.F,r.Minor],[o.G,r.Minor],[o.A_Flat,r.Minor],[o.B_Flat,r.Minor],[o.E_Flat,r.Minor],[o.A_Sharp,r.Minor],[o.C_Sharp,r.Minor],[o.D_Sharp,r.Minor],[o.F_Sharp,r.Minor],[o.G_Sharp,r.Minor]],S=t(33),w=t(92),k=t(62),y=t(101),x=t(58),M=t(91),C=(t(55),window.AudioContext||window.webkitAudioContext||void 0),N=t(21),A=t(56),B=t.n(A),I=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=Object(m.useState)(function(){var a,r=localStorage.getItem(e);return a=null===r||void 0===r||t?n instanceof Function?n():n:N.fromJSON(r),window.localStorage.setItem(e,N.toJSON(a)),a}),r=Object(v.a)(a,2),o=r[0],i=r[1];return[o,Object(m.useCallback)(function(n){i(function(t){var a=n instanceof Function?n(t):n;return window.localStorage.setItem(e,N.toJSON(a)),a})},[e])]},F=function(e,n){var t=I(e,n),a=Object(v.a)(t,2),r=a[0],o=a[1];return[r,Object(m.useCallback)(function(){o(M.a)},[o])]},D=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){},t=Object(m.useState)(e),a=Object(v.a)(t,2),r=a[0],o=a[1];return[r,Object(m.useCallback)(function(){return o(function(e){var t=!e;return n(t),t})},[n])]},P=t(57),L=t.n(P);var T,_=function(e,n){var t=localStorage.getItem(e);return null===t?n:N.fromJSON(t)},R=function(e,n){localStorage.setItem(e,N.toJSON(n))},K=t(81),z=function(e,n){var t=n.time,a=n.gain,r=n.buffer,o=n.pitch,i=n.currentBeat,c=n.divisionIndex,u=0===i&&0===c,s=e.createBufferSource();s.buffer=r,s.detune.value=u?0:-o;var l=e.createGain();l.gain.value=u?1:a,s.connect(l),l.connect(e.destination),s.start(t)},G=.1,W=function(e){var n=ne(e),t=f.a.useRef(n);return f.a.useEffect(function(){t.current=n},[n]),t},q=function(e){var n=ne(function(e){return e.metronomeState.playing}),t=W(function(e){return e.metronomeState.playing}),a=W(function(e){return e.metronomeState.bpm}),r=W(function(e){return e.metronomeState.signature.numerator}),o=W(function(e){return e.metronomeState.signature.numerator.size}),i=function(e,n){var t=Object(m.useState)(),a=Object(v.a)(t,2),r=a[0],o=a[1];return Object(m.useEffect)(function(){void 0!==e&&"not-supported"!==e&&"pending"!==e&&fetch(n).then(function(e){return e.arrayBuffer()}).then(function(n){return e.decodeAudioData(n)}).then(o)},[n,e]),r}(e,K),c=Object(m.useRef)(0),u=n?150:void 0,s=Object(m.useRef)(0);Object(m.useEffect)(function(){n||(s.current=0)},[n]);var l=f.a.useCallback(function(){var e=s.current;s.current=(e+1)%o.current},[o]),d=Object(m.useCallback)(function(e,n){!function(e,n,t){setTimeout(t,1e3*(n-e.currentTime))}(e,n.time,function(){t.current&&X(n)})},[t]);Object(m.useEffect)(function(){if(void 0!==u&&void 0!==e&&"not-supported"!==e&&"pending"!==e&&void 0!==i){var n=new L.a,t=e.currentTime+.3;c.current=t;var m=function(){var t=Math.min(s.current,o.current-1),m=r.current.get(t);void 0!==m&&function(e,n,t,a,r,o,i,c,u){var s=60/e,l=t;if(n.current<r+o){var m=function(e,n,t,a,r){var o=[];return t.filter(function(e){return e}).forEach(function(t,i){for(var c=n/i,u=0;u<i;u++){var s={time:e+u*c,divisionLength:c,pitch:220,gain:.5,buffer:a,divisions:i,divisionIndex:u,currentBeat:r};o.push(s)}}),o.sort(function(e,n){return e.time-n.time}),o}(n.current,s,l,i,a);c.push.apply(c,Object(k.a)(m)),n.current+=s,u()}}(a.current,c,m,s.current,e.currentTime,.3,i,n,l),function(e,n,t,a){for(var r=t.currentTime+n+G;e.peekFront()&&e.peekFront().time<r;){var o=e.shift();0===o.divisionIndex&&1!==o.divisions||z(t,o),a(t,o)}}(n,u/1e3,e,d)};m();var f=setInterval(m,u);return function(){clearInterval(f)}}},[u,i,e,d,a,o,r,l])},U=function(e){var n=ne(function(e){return e.metronomeState.signature.numerator}),t=ne(function(e){return e.metronomeState.playing});Object(m.useEffect)(function(){Y()},[n]),Object(m.useEffect)(function(){t||(Y(),setTimeout(function(){Y()},300))},[t]),q(e);var a=f.a.useCallback(function(e){V(x.a(e))},[]),r=f.a.useCallback(function(){return H(M.a)},[]),o=Object(m.useCallback)(function(e){void 0!==e&&V(e),H(!0)},[]),i=f.a.useCallback(function(){H(!1)},[]);return{toggleStart:r,setSignature:f.a.useCallback(J,[]),start:o,stop:i,setBPM:f.a.useCallback(V,[]),addBPM:a}};!function(e){e[e.UpdateActiveBeats=0]="UpdateActiveBeats",e[e.SetActiveBeats=1]="SetActiveBeats",e[e.SetSignature=2]="SetSignature",e[e.SetPending=3]="SetPending",e[e.SetPlaying=4]="SetPlaying",e[e.SetBpm=5]="SetBpm"}(T||(T={}));var J=function(e){var n=e instanceof Function?e(ee.getState().metronomeState.signature):e;R(a.TimeSignature,n),ee.dispatch({type:T.SetSignature,action:n})},H=function(e){ee.dispatch({type:T.SetPlaying,action:e})},V=function(e){var n=e instanceof Function?e(ee.getState().metronomeState.bpm):e;R(a.BPM,n),ee.dispatch({type:T.SetBpm,action:n})},Y=function(){var e,n;n=ee.getState().metronomeState.signature.numerator,e=p.List(n.map(function(e){return e.reduce(function(e,n,t){return n?e.set(t,p.List(y.a(0,t).map(function(){return!0}))):e},p.Map())})),ee.dispatch({type:T.SetActiveBeats,value:e})},X=function(e){ee.dispatch({type:T.UpdateActiveBeats,value:e})},$=p.Map().set(1,!0),Q={denominator:4,numerator:p.List([$,$,$,$])},Z={activeBeats:p.List(),metronomeState:{ready:!1,pending:!0,bpm:_(a.BPM,60),playing:!1,signature:_(a.TimeSignature,Q)}},ee=j.b(function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T.SetActiveBeats:return Object(E.a)({},n,{activeBeats:t.value});case T.UpdateActiveBeats:var a=t.value,r=n.activeBeats.getIn([a.currentBeat,a.divisions,a.divisionIndex]);return void 0===r?n:Object(E.a)({},n,{activeBeats:n.activeBeats.setIn([a.currentBeat,a.divisions,a.divisionIndex],!r)});case T.SetSignature:return Object(E.a)({},n,{metronomeState:Object(E.a)({},n.metronomeState,{signature:t.action instanceof Function?t.action(n.metronomeState.signature):t.action})});case T.SetPending:return Object(E.a)({},n,{metronomeState:Object(E.a)({},n.metronomeState,{pending:t.action instanceof Function?t.action(n.metronomeState.pending):t.action})});case T.SetPlaying:return Object(E.a)({},n,{metronomeState:Object(E.a)({},n.metronomeState,{playing:t.action instanceof Function?t.action(n.metronomeState.playing):t.action})});case T.SetBpm:return Object(E.a)({},n,{metronomeState:Object(E.a)({},n.metronomeState,{bpm:(e=t.action instanceof Function?t.action(n.metronomeState.bpm):t.action,w.a(10,250,e))})});default:return t.type.startsWith("@@redux")||console.log(t,"was not handled"),n}}),ne=function(e){return S.b(e)},te=p.List([{name:"Larghissimo",low:0,high:24},{name:"Grave",low:25,high:45},{name:"Largo",low:40,high:60},{name:"Lento",low:45,high:60},{name:"Larghetto",low:60,high:66},{name:"Adagio",low:66,high:76},{name:"Andante",low:76,high:108},{name:"Marcia moderato",low:83,high:85},{name:"Andante moderato",low:92,high:112},{name:"Moderato",low:108,high:120},{name:"Allegro",low:120,high:156},{name:"Vivace",low:156,high:176},{name:"Vivacissimo",low:172,high:176},{name:"Allegrissimo",low:172,high:176},{name:"Presto",low:168,high:200},{name:"Prestissimo",low:200,high:250}]),ae=h.a(function(e){return""+e},function(e){return te.filter(function(n){var t,a,r=n.high,o=n.low;return t=r,(a=e)>=o&&a<=t})}),re=f.a.memo(function(e){var n=e.name,t=e.low,a=e.high;return f.a.createElement("div",{className:"has-text-centered"},n," - ",t," - ",a)}),oe=f.a.memo(function(e){var n=e.bpm,t=ae(n);return f.a.createElement("div",{style:{minHeight:"6.5em"}},t.map(function(e){var n=e.name,t=e.high,a=e.low;return f.a.createElement(re,{key:"marking-".concat(n),name:n,high:t,low:a})}))},function(e,n){var t=e.bpm,a=n.bpm;return ae(t).equals(ae(a))}),ie=function(){var e=ne(function(e){return e.metronomeState.bpm});return f.a.createElement(oe,{bpm:e})},ce=t(5),ue=t(37),se=t(94),le=t(39),me=t.n(le);function fe(){var e=Object(b.a)(["\n  &:not(:last-child) {\n    margin-bottom: 0 !important;\n  }\n"]);return fe=function(){return e},e}var de=["offIsPrimary","offIsLink","offIsDanger","offIsInfo","offIsSuccess","offIsOutlined"],ge=["isPrimary","isLink","isDanger","isInfo","isSuccess","isOutlined"],ve=function(e){var n=e.on,t=Object(ue.a)(e,["on"]),a=f.a.useMemo(function(){var e=n?de:ge;return se.a(e,t)},[n,t]),r=f.a.useMemo(function(){return t.children instanceof Array&&2===t.children.length?n?t.children[0]:t.children[1]:t.children},[t,n]);return f.a.createElement(be,a,r)},be=function(e){var n=e.isPrimary,t=e.isDanger,a=e.isLink,r=e.isInfo,o=e.isSuccess,i=e.isOutlined,c=e.offIsPrimary,u=e.offIsDanger,s=e.offIsLink,l=e.offIsInfo,m=e.offIsSuccess,d=e.offIsOutlined,g=e.grow,v=e.className,b=Object(ue.a)(e,["isPrimary","isDanger","isLink","isInfo","isSuccess","isOutlined","offIsPrimary","offIsDanger","offIsLink","offIsInfo","offIsSuccess","offIsOutlined","grow","className"]),p=f.a.useMemo(function(){return me()("button",v,{"is-primary":n||c,"is-link":a||s,"is-danger":t||u,"is-info":r||l,"is-success":o||m,"is-outlined":i||d,"is-grow":g})},[v,g,n,c,a,s,t,u,r,l,i,d,o,m]),h=f.a.useMemo(function(){return Object(E.a)({},b,{className:p})},[b,p]);return f.a.createElement("button",h,b.children)},pe=ce.a.div(fe()),he=function(e){var n=e.children,t=e.hasAddons,a=e.ref,r=e.className,o=e.grow,i=Object(ue.a)(e,["children","hasAddons","ref","className","grow"]),c=f.a.useMemo(function(){return me()(r,"buttons",{"has-addons":t,"is-grow":o})},[t,o,r]);return f.a.createElement(pe,Object.assign({ref:a},i,{className:c}),n)};function Ee(){var e=Object(b.a)(["\n  display: flex;\n  flex-grow: 1;\n  margin-bottom: 10px;\n"]);return Ee=function(){return e},e}function je(){var e=Object(b.a)(["\n  display: flex;\n  flex-grow: 1;\n  flex-direction: column;\n"]);return je=function(){return e},e}function Oe(){var e=Object(b.a)(["\n  display: flex;\n  flex-grow: 1;\n"]);return Oe=function(){return e},e}function Se(){var e=Object(b.a)(["\n  width: 1px;\n  margin-left: 1px;\n  margin-right: 1px;\n  flex-grow: 1;\n"]);return Se=function(){return e},e}function we(){var e=Object(b.a)(["\n  display: flex;\n  align-items: baseline;\n  > div {\n    margin-right: 10px;\n  }\n"]);return we=function(){return e},e}var ke=f.a.memo(ce.a.section(we())),ye=f.a.memo(function(e){var n=e.uiEnabledDivisions,t=e.toggleDivisionOption,a=e.clearDivisions;return f.a.createElement(ke,null,f.a.createElement("div",{className:"is-size-5"},"Division"),f.a.createElement(he,{hasAddons:!0,grow:!0,style:{marginRight:"5px"}},[2,3,4,5,6].map(function(e){var a=n.get(e);return f.a.createElement(ve,{grow:!0,on:a,isPrimary:!0,key:"division-options-".concat(e),onClick:function(){return t(e)}},e)})),f.a.createElement(be,{grow:!0,isDanger:!0,isOutlined:!0,onClick:a},"Clear"))}),xe=f.a.memo(function(e){var n=e.setCurrentNumerator,t=e.currentNumerator;return f.a.createElement("section",{className:"section buttons is-centered"},[1,2,3,4,5].map(function(e){var a=t===e;return f.a.createElement(ve,{key:"numerator-button-".concat(e),on:a,isPrimary:!0,isOutlined:!0,grow:!0,onClick:a?function(){}:function(){return n(e)}},f.a.createElement(f.a.Fragment,null,e,"/4"))}))}),Me=f.a.memo(ce.a.div(Se())),Ce=f.a.memo(ce.a.div(Oe())),Ne=f.a.memo(ce.a.div(je())),Ae=f.a.memo(ce.a.div(Ee())),Be=f.a.memo(function(e){var n=e.on,t=e.beatRows,a=f.a.useMemo(function(){return n?"has-background-primary":"has-background-link"},[n]),r=f.a.useMemo(function(){return 70/t},[t]);return f.a.createElement(Me,{className:a,style:{height:r,marginTop:1}})}),Ie=f.a.memo(function(e){var n=e.bools,t=e.beatNumber,a=e.rowIndex,r=e.beatRows,o=a,i=t;return f.a.createElement(Ce,{key:"".concat(i,"-").concat(o)},n.map(function(e,n){return f.a.createElement(Be,{beatRows:r,key:"".concat(i,"-").concat(a,"-").concat(n),on:e})}))}),Fe=f.a.memo(function(e){var n=e.beat,t=e.index,a=n.entrySeq();return f.a.createElement(Ne,{key:"".concat(t)},a.map(function(e,n){var r=Object(v.a)(e,2),o=r[0],i=r[1];return f.a.createElement(Ie,{beatRows:a.size||0,key:"".concat(t,"-").concat(n),divisions:o,bools:i,beatNumber:t,rowIndex:n})}))}),De=f.a.memo(function(){var e=ne(function(e){return e.activeBeats});return f.a.createElement(Ae,null,e.map(function(e,n){return f.a.createElement(Fe,{key:n,beat:e,index:n})}))}),Pe=function(e){var n=e.metronome,t=f.a.useMemo(function(){return n.setSignature},[n.setSignature]),r=ne(function(e){return e.metronomeState.signature.numerator}),o=Object(m.useState)(!1),i=Object(v.a)(o,2),c=i[0],u=i[1],s=I(a.EnabledDivisions,p.Map().set(1,!0)),l=Object(v.a)(s,2),d=l[0],g=l[1];Object(m.useEffect)(function(){c&&t(function(e){return Object(E.a)({},e,{numerator:p.List(y.a(0,e.numerator.size).map(function(){return d}))})})},[d,c,t]);var b=Object(m.useCallback)(function(e){u(!0),g(function(n){var t=n.get(e),a=void 0===t||!t;return n.set(e,a)})},[g]),h=Object(m.useCallback)(function(){g(p.Map().set(1,!0))},[g]),j=f.a.useState(r.size),O=Object(v.a)(j,2),S=O[0],w=O[1];return f.a.useEffect(function(){t(function(e){return Object(E.a)({},e,{numerator:p.List(y.a(0,S).map(function(){return d}))})})},[S,t,d]),f.a.createElement(f.a.Fragment,null,f.a.createElement(De,null),f.a.createElement(ye,{uiEnabledDivisions:d,toggleDivisionOption:b,clearDivisions:h}),f.a.createElement(xe,{currentNumerator:r.size,setCurrentNumerator:w}))},Le=t(98),Te=t(99),_e=t(97),Re=t(100),Ke=t(95),ze=t(96),Ge=Le.a(function(e){return Te.a(2,e)},_e.a(function(e){var n=Object(v.a)(e,2),t=n[0];return n[1]-t}),Re.a,Ke.a(6e4),Math.trunc),We=function(e){var n=e.setBPM,t=Object(m.useState)([]),a=Object(v.a)(t,2),r=a[0],o=a[1];return f.a.createElement(be,{isLink:!0,isOutlined:!0,onClick:function(){var e=performance.now(),t=ze.a(e,r).filter(function(n){return e-n<3e3});if(t.length>1){var a=Ge(t);n(a)}o(t)}},"Tap In")};function qe(){var e=Object(b.a)(["\n  margin-top: 10px;\n"]);return qe=function(){return e},e}for(var Ue={0:"A",1:"Bb",2:"B",3:"C",4:"Db",5:"D",6:"Eb",7:"E",8:"F",9:"Gb",10:"G",11:"Ab"},Je=[],He=-4;He<4;He++)for(var Ve=0;Ve<12;Ve++){var Ye=440*Math.pow(2,He),Xe=Ye/1200,$e=Ye*Math.pow(2,Ve/12),Qe=He+4,Ze=Ue[Ve];Je.push({octave:Qe,note:Ze,frequency:$e,centsPerOctave:Xe})}var en=f.a.memo(function(){var e=D(!1),n=Object(v.a)(e,2),t=n[0],a=n[1],r=Object(m.useState)(),o=Object(v.a)(r,2),i=o[0],c=o[1],u=Object(m.useState)(),s=Object(v.a)(u,2),l=s[0],d=s[1],g=Object(m.useState)(440),b=Object(v.a)(g,2),p=b[0],h=b[1],E=Object(m.useState)(),j=Object(v.a)(E,2),O=j[0],S=j[1];Object(m.useEffect)(function(){t&&!O&&void 0!==C&&S(new C)},[t,O]),Object(m.useEffect)(function(){if(t&&O){d(O.sampleRate);var e,n=navigator.mediaDevices;if(n)return n.getUserMedia({audio:!0}).then(function(n){e=n;var t=O.createAnalyser();t.fftSize=8192,O.createMediaStreamSource(n).connect(t),c(t)}),function(){e.getAudioTracks().forEach(function(e){return e.stop()})}}},[t,O]),Object(m.useEffect)(function(){if(t&&i&&l){var e=function(){var e=i.frequencyBinCount,n=new Float32Array(e);i.getFloatFrequencyData(n);var t=n.reduce(function(e,n,t){return e[0]<n?[n,t]:e},[-1/0,-1]),a=Object(v.a)(t,2)[1],r=l/i.fftSize;h(r*a)};e();var n=setInterval(e,50);return function(){clearInterval(n)}}},[t,i,l]);var w=function(e){for(var n=0,t=0;t<Je.length;t++)if(Je[t].frequency>=e){n=t;break}var a=n+1,r=Je[n],o=Je[a],i=(r.frequency+o.frequency)/2,c=Je[a],u=c.frequency-e;e<i&&(c=Je[n]);var s=c.centsPerOctave*u;return Object.assign(c,{originalFrequency:e,difference:u,cents:s})}(p||0),k=w.octave,y=w.note,x=w.cents;return f.a.createElement(nn,{className:"box has-text-centered"},f.a.createElement("div",{className:"is-size-1"},t?y+k:"Stopped"),f.a.createElement("div",null,t?f.a.createElement(f.a.Fragment,null,x.toFixed(2)," Cents ",x<0?"flat":"sharp"):"press start to tune"),f.a.createElement(he,{className:"is-right"},f.a.createElement(ve,{on:t,isDanger:!0,offIsPrimary:!0,onClick:a},f.a.createElement(f.a.Fragment,null,"Stop"),f.a.createElement(f.a.Fragment,null,"Start"))))}),nn=ce.a.section(qe()),tn=en;function an(){var e=Object(b.a)(["\n  align-self: center;\n  margin: auto;\n  z-index: 1;\n  pointer-events: none;\n"]);return an=function(){return e},e}function rn(){var e=Object(b.a)(["\n  width: 100px;\n  height: 100px;\n  border-radius: 100px;\n  position: absolute;\n  touch-action: none;\n"]);return rn=function(){return e},e}function on(){var e=Object(b.a)(["\n  margin: auto;\n  position: relative;\n  height: 300px;\n  width: 300px;\n  border-radius: 300px;\n  display: flex;\n  margin-bottom: 10px;\n"]);return on=function(){return e},e}var cn=ce.a.div(on()),un=ce.a.div(rn()),sn=f.a.memo(ce.a.div(an())),ln=function(e){var n=e.size,t=void 0===n?300:n,r=e.addDiff,o=e.children,i=I(a.Radians,3*Math.PI/2),c=Object(v.a)(i,2),u=c[0],s=c[1],l=Object(m.useRef)(Math.PI);Object(m.useEffect)(function(){l.current=u},[u]);var d=Object(m.useState)(!1),g=Object(v.a)(d,2),b=g[0],p=g[1],h=Object(m.useRef)(!1);Object(m.useEffect)(function(){h.current=b},[b]);var E=Object(m.useState)(0),j=Object(v.a)(E,2),O=j[0],S=j[1],w=Object(m.useRef)(0);Object(m.useEffect)(function(){w.current=O},[O]);var k=Object(m.useRef)(null),y=Object(m.useCallback)(function(e){p(!0),e.preventDefault()},[]),x=Object(m.useCallback)(function(e){p(!1)},[]),M=Object(m.useCallback)(function(e){Math.abs(w.current)<.2?S(function(n){return n+e}):(r(w.current>0?-1:1),S(0))},[r]),C=Object(m.useCallback)(function(e){var n=e.clientX,t=e.clientY,a=k.current.getBoundingClientRect(),r=a.left+a.width/2,o=-(a.top+a.height/2-t),i=-(r-n),c=Math.atan2(o,i),u=l.current-c;u<-Math.PI?u=-l.current-c:u>Math.PI&&(u=l.current- -c),0!==u&&M(u),c===l.current||s(c)},[M,s]),N=Object(m.useCallback)(function(e){h.current&&C(e)},[C]);Object(m.useEffect)(function(){return window.addEventListener("mouseup",x),window.addEventListener("mousemove",N),function(){window.removeEventListener("mouseup",x),window.removeEventListener("mousemove",N)}},[N,x]);var A=Object(m.useCallback)(function(e){var n=e.changedTouches[0];C(n)},[C]),B=f.a.useMemo(function(){return t/2+Math.sin(u)*(t/4)+Math.sin(u)*t/16-t/6},[u,t]),F=f.a.useMemo(function(){return t/2+Math.cos(u)*(t/4)+Math.cos(u)*t/16-t/6},[u,t]);return f.a.createElement(cn,{ref:k,className:"has-background-primary"},f.a.createElement(un,{className:"has-background-info",onMouseDown:y,onTouchMove:A,style:{top:B,left:F}}),f.a.createElement(sn,null,o))};function mn(){var e=Object(b.a)(["\n  margin: 0 !important;\n  height: 100%;\n  width: 100%;\n  position: fixed;\n  z-index: 1;\n  left: 0;\n  top: 0;\n  background-color: rgba(0, 0, 0, 0.8);\n  color: white;\n  text-align: center;\n"]);return mn=function(){return e},e}var fn=ce.a.div(mn()),dn=function(){var e=ne(function(e){return e.metronomeState.bpm});return f.a.createElement("div",{className:"has-text-centered is-size-1"},e)},gn=f.a.memo(function(e){var n=e.addBPM;return f.a.createElement("section",{className:"section"},f.a.createElement(ln,{addDiff:n},f.a.createElement(dn,null),f.a.createElement(ie,null)))}),vn=f.a.memo(function(e){var n=e.showTuner,t=e.toggleTuner,a=e.playing,r=e.toggleStart,o=e.setBPM,i=e.pending;return f.a.createElement("section",{className:"section"},f.a.createElement(he,{hasAddons:!0},f.a.createElement(ve,{isLink:!0,offIsOutlined:!0,offIsLink:!0,on:n,onClick:t},"Tuner"),f.a.createElement(We,{setBPM:o}),f.a.createElement(ve,{on:a,offIsPrimary:!0,grow:!0,isOutlined:!0,isDanger:!0,disabled:i,onClick:r},f.a.createElement(f.a.Fragment,null,"Stop"),f.a.createElement(f.a.Fragment,null,"Start"))))}),bn=function(e){var n=e.appSettings,t=e.audioContext,r=U(t),o=n.state.keepAwake,i=F(a.ShowTuner,!1),c=Object(v.a)(i,2),u=c[0],s=c[1],l=function(){var e=Object(m.useState)(new B.a),n=Object(v.a)(e,1)[0];return{lock:Object(m.useCallback)(function(){n.enable()},[n]),release:Object(m.useCallback)(function(){n.disable()},[n])}}(),d=l.lock,g=l.release,b=ne(function(e){return e.metronomeState.playing}),p=ne(function(e){return e.metronomeState.pending}),h=f.a.useCallback(r.addBPM,[r.addBPM]),E=f.a.useCallback(r.setBPM,[r.setBPM]),j=f.a.useCallback(r.toggleStart,[r.toggleStart]);return Object(m.useEffect)(function(){o&&b?d():g()},[b,o,d,g]),f.a.useEffect(function(){var e;"pending"!==t&&void 0!==t&&(e=!1,ee.dispatch({type:T.SetPending,action:e}))},[t]),f.a.createElement(f.a.Fragment,null,p&&f.a.createElement(fn,null,"Tap to enable audio."),u&&f.a.createElement(tn,null),f.a.createElement(gn,{addBPM:h}),f.a.createElement(Pe,{metronome:r}),f.a.createElement(vn,{showTuner:u,toggleTuner:s,toggleStart:j,playing:b,setBPM:E,pending:p}))};function pn(){var e=Object(b.a)([""]);return pn=function(){return e},e}var hn,En=ce.a.section(pn()),jn=function(e){var n=e.appSettings,t=n.state.keepAwake,a=n.toggleKeepAwake;return f.a.createElement(En,null,f.a.createElement("h2",{className:"is-size-4"},"Settings"),f.a.createElement("div",{className:"field"},f.a.createElement("div",{className:"control"},f.a.createElement("label",{className:"checkbox"},f.a.createElement("input",{style:{marginRight:"5px"},type:"checkbox",checked:t,onChange:a}),"Keep screen on while metronome is running."))))},On=function(){return O.reduce(function(e,n){return function(e,n){return e.add({scaleKey:t=n,pitch:t[0],mode:t[1],known:!1,learning:!1,bpm:60});var t}(e,n)},p.Set())},Sn=function(e,n){return e.filter(n)},wn=function(){var e=I(a.ScalesDB,On),n=Object(v.a)(e,2),t=n[0],r=n[1],o=f.a.useCallback(function(){throw new Error("not implemented")},[]),i=f.a.useCallback(function(e){return function(e,n){return Sn(e,n).first()}(t,e)},[t]),c=f.a.useCallback(function(e){return Sn(t,e).sort(function(e,n){return e.scaleKey[0].localeCompare(n.scaleKey[0])})},[t]);return{addBPM:f.a.useCallback(function(e,n){var a=t.get(e);a&&r(t.remove(a).add(Object(E.a)({},a,{bpm:a.bpm+n})))},[t,r]),toggleLearning:f.a.useCallback(function(e){var n=t.get(e);n&&r(t.remove(n).add(Object(E.a)({},n,{learning:!n.learning})))},[t,r]),toggleKnown:f.a.useCallback(function(e){var n=t.get(e);n&&r(t.remove(n).add(Object(E.a)({},n,{known:!n.known})))},[t,r]),addScale:o,getScale:i,getScales:c}};!function(e){e.NOT_STARTED="not-started",e.KNOWN="known",e.LEARNING="learning"}(hn||(hn={}));var kn=function(e){var n=Object(v.a)(e.scaleKey,2),t=n[0],a=n[1],r=e.learning,o=e.known,i=e.toggleLearning,c=e.toggleKnown;return f.a.createElement("div",{className:"is-grouped field has-addons"},f.a.createElement("div",{className:"is-size-5 control is-expanded"},t," ",a),f.a.createElement(he,null,f.a.createElement(ve,{on:o,isInfo:!0,onClick:c},"Known"),f.a.createElement(ve,{on:r,isLink:!0,onClick:i},"Learning")))},yn=function(e){var n=e.scales,t=e.reset,a=e.scaleMode,r=e.metronome,o=n.getScales,i=n.getScale,c=n.addBPM,u=f.a.useState(function(){return function(e){var n,t,a;for(a=e.length-1;a>0;a--)n=Math.floor(Math.random()*(a+1)),t=e[a],e[a]=e[n],e[n]=t;return e}(o(function(e){return a===hn.LEARNING?e.learning:a===hn.KNOWN&&e.known}).valueSeq().map(function(e){return e.scaleKey}).toArray())}),s=Object(v.a)(u,2),l=s[0],m=s[1],d=f.a.useCallback(r.start,[r.start]),g=l[0]||[],b=i(function(e){return e.mode===g[1]&&e.pitch===g[0]});f.a.useEffect(function(){void 0!==b&&d(b.bpm)},[b,d]);var p=l.length>1?"Next Scale":"Finish";if(0===l.length)return f.a.createElement("div",null,"No more scales");var h=b,E=h,j=E.mode,O=E.pitch,S=E.bpm;return f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:"box"},f.a.createElement("div",{style:{alignSelf:"center",fontWeight:"bold"},className:"control is-expanded is-size-5"},a),f.a.createElement("div",{style:{display:"flex",marginBottom:"5px"}},f.a.createElement("div",{style:{alignSelf:"center",marginRight:"10px"}},O," ",j," @ ",S,"bpm"),f.a.createElement(he,{grow:!0,hasAddons:!0},f.a.createElement(be,{isDanger:!0,isOutlined:!0,grow:!0,onClick:function(){return c(h,-10)}},"-10"),f.a.createElement(be,{isDanger:!0,isOutlined:!0,grow:!0,onClick:function(){return c(h,-1)}},"-"),f.a.createElement(be,{isPrimary:!0,isOutlined:!0,grow:!0,onClick:function(){return c(h,1)}},"+"),f.a.createElement(be,{isPrimary:!0,isOutlined:!0,grow:!0,onClick:function(){return c(h,10)}},"+10"))),f.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},f.a.createElement(be,{isDanger:!0,isOutlined:!0,onClick:t},"Stop"),f.a.createElement(be,{isPrimary:!0,onClick:function(){m(function(e){var n=e.slice(1);return 0===n.length&&t(),n})}},p))),f.a.createElement(Pe,{metronome:r}))},xn=function(e){var n=e.audioContext,t=U(n),o=t.stop,i=f.a.useState(hn.NOT_STARTED),c=Object(v.a)(i,2),u=c[0],s=c[1],l=F(a.ShowKnown,!1),m=Object(v.a)(l,2),d=m[0],g=m[1];f.a.useEffect(function(){u===hn.NOT_STARTED&&o()},[u,o]);var b=wn(),p=b.getScale,h=b.getScales,E=b.toggleLearning,j=b.toggleKnown;return f.a.createElement("div",{style:{marginTop:"10px"}},u===hn.NOT_STARTED?f.a.createElement("div",{style:{marginBottom:"5px"}},f.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},f.a.createElement("div",{style:{alignSelf:"center",fontWeight:"bold"},className:"control is-expanded is-size-5"},"Scales"),f.a.createElement(he,null,f.a.createElement(be,{onClick:function(){return s(hn.KNOWN)},disabled:void 0===p(function(e){return e.known}),className:"is-info is-outlined"},"Start Known"),f.a.createElement(be,{onClick:function(){return s(hn.LEARNING)},disabled:void 0===p(function(e){return e.learning}),className:"is-link is-outlined"},"Start Learning"))),f.a.createElement("hr",null),f.a.createElement(he,null,f.a.createElement(be,{onClick:g,className:"".concat(d?"is-primary is-outlined":"is-danger")},d?"Hide Known":"Show Known")),h(function(e){return e.mode===r.Major&&(!!d||!1===e.known)}).map(function(e){return f.a.createElement(kn,Object.assign({key:"".concat(e.pitch,"-").concat(e.mode)},e,{toggleLearning:function(){return E(e)},toggleKnown:function(){return j(e)}}))}),f.a.createElement("hr",null),h(function(e){return e.mode===r.Minor&&(!!d||!1===e.known)}).map(function(e){return f.a.createElement(kn,Object.assign({key:"".concat(e.pitch,"-").concat(e.mode)},e,{toggleLearning:function(){return E(e)},toggleKnown:function(){return j(e)}}))})):f.a.createElement(yn,{scaleMode:u,scales:b,reset:function(){return s(hn.NOT_STARTED)},metronome:t}))},Mn=t(36),Cn=t(20),Nn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function An(e){if("serviceWorker"in navigator){if(new URL("/metronome",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var n="".concat("/metronome","/service-worker.js");Nn?(!function(e,n){fetch(e).then(function(t){var a=t.headers.get("content-type");404===t.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Bn(e,n)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(n,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):Bn(n,e)})}}function Bn(e,n){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;null!=t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(e)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}function In(){var e=Object(b.a)(["\n  position: absolute;\n  max-width: ",";\n  width: 95%;\n  margin-top: 10px;\n  left: 0;\n  right: 0;\n  margin-left: auto !important;\n  margin-right: auto !important;\n  z-index: 10;\n  display: flex !important;\n  justify-content: space-between;\n  animation: ease-in 1s ",";\n"]);return In=function(){return e},e}function Fn(){var e=Object(b.a)(["\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n"]);return Fn=function(){return e},e}var Dn=Object(ce.b)(Fn()),Pn=ce.a.section(In(),"40em",Dn),Ln=!1,Tn=function(){var e=Object(m.useState)(!1),n=Object(v.a)(e,2),t=n[0],a=n[1],r=f.a.useCallback(function(){window.location.reload()},[]),o=f.a.useCallback(function(){a(!1)},[]);return Object(m.useEffect)(function(){Ln||An({onUpdate:function(){a(!0)}}),Ln=!0},[]),f.a.createElement(f.a.Fragment,null,t&&f.a.createElement(Pn,{className:"box"},f.a.createElement("span",null,"An Update is Available!"),f.a.createElement(he,null,f.a.createElement(be,{isPrimary:!0,isOutlined:!0,onClick:r},"Refresh"),f.a.createElement(be,{isDanger:!0,isOutlined:!0,onClick:o},"x"))))},_n=function(){return{keepAwake:!1}},Rn=t(42),Kn=t(28);function zn(){var e=Object(b.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  justify-content: flex-end;\n  margin-top: 5px;\n"]);return zn=function(){return e},e}function Gn(){var e=Object(b.a)(["\n  max-width: ",";\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  > * {\n    margin-left: 10px;\n    margin-right: 10px;\n  }\n"]);return Gn=function(){return e},e}function Wn(){var e=Object(b.a)(["\n  margin-left: 5px;\n"]);return Wn=function(){return e},e}function qn(){var e=Object(b.a)([""]);return qn=function(){return e},e}function Un(){var e=Object(b.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  padding-right: 10px;\n  align-self: flex-end;\n  > a {\n    animation: ease-in 0.3s ",";\n    font-size: 1.5rem;\n  }\n"]);return Un=function(){return e},e}function Jn(){var e=Object(b.a)(["\n  from {\nfont-size: 0px;\n  }\n"]);return Jn=function(){return e},e}function Hn(){var e=Object(b.a)(["\n  display: flex;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  padding-left: 10px;\n  padding-right: 10px;\n  justify-content: space-between;\n  > h2 {\n    margin: 0 !important;\n  }\n"]);return Hn=function(){return e},e}function Vn(){var e=Object(b.a)(["\n  align-self: center;\n"]);return Vn=function(){return e},e}function Yn(){var e=Object(b.a)(["\n  margin-bottom: 10px;\n  margin-left: 0px !important;\n  margin-right: 0px !important;\n  display: flex;\n  flex-direction: column;\n"]);return Yn=function(){return e},e}var Xn=f.a.memo(ce.a.section(Yn())),$n=f.a.memo(ce.a.span(Vn())),Qn=f.a.memo(ce.a.section(Hn())),Zn=Object(ce.b)(Jn()),et=f.a.memo(ce.a.nav(Un(),Zn)),nt=f.a.memo(Object(ce.a)(Mn.b)(qn())),tt=f.a.memo(Object(ce.a)(Rn.a)(Wn())),at=f.a.memo(function(){var e=D(!1),n=Object(v.a)(e,2),t=n[0],a=n[1];return f.a.createElement(Xn,null,f.a.createElement(Qn,{className:"has-background-primary has-text-light"},f.a.createElement(Mn.b,{to:"/",className:"has-text-white"},f.a.createElement("h2",{className:"is-size-4 is-bold"},"(mjh)tronome")),f.a.createElement($n,{onClick:a},f.a.createElement(Rn.a,{icon:Kn.a,size:"2x"}))),t&&f.a.createElement(et,{onClick:a},f.a.createElement(nt,{to:"/"},"Home",f.a.createElement(tt,{icon:Kn.c})),f.a.createElement(nt,{to:"/scales"},"Scales",f.a.createElement(tt,{icon:Kn.d})),f.a.createElement(nt,{to:"/settings"},"Settings",f.a.createElement(tt,{icon:Kn.b}))))}),rt=f.a.memo(ce.a.div(Gn(),"40em")),ot=f.a.memo(ce.a.div(zn())),it=f.a.memo(function(e){var n=e.children;return f.a.createElement(rt,null,f.a.createElement(Tn,null),f.a.createElement(at,null),n,f.a.createElement(ot,null,"v".concat("1.0.24")))}),ct=function(){var e=function(){var e=I(a.AppSettings,_n),n=Object(v.a)(e,2),t=n[0],r=n[1];return{state:t,toggleKeepAwake:f.a.useCallback(function(){r(function(e){return Object(E.a)({},e,{keepAwake:!e.keepAwake})})},[r])}}(),n=function(){var e=f.a.useState(),n=Object(v.a)(e,2),t=n[0],a=n[1],r=f.a.useRef(),o=f.a.useState(!1),i=Object(v.a)(o,2),c=i[0],u=i[1],s=Object(m.useCallback)(function(){c||void 0!==r.current&&(a("pending"),r.current.resume().then(function(){u(!0),a(r.current),document.removeEventListener("touchstart",s),document.removeEventListener("click",s),document.removeEventListener("touchend",s)}))},[c,u]);return f.a.useEffect(function(){if(void 0===C)a("not-supported");else{var e=new C;r.current=e,"suspended"===e.state?(document.addEventListener("touchstart",s),document.addEventListener("click",s),document.addEventListener("touchend",s)):a(e)}},[s]),t}();return f.a.createElement(Mn.a,{basename:"/metronome"},f.a.createElement(it,null,"not-supported"===n&&f.a.createElement("div",null,"Your browser doesn't support the audioContext api, so this will not work. Sorry :("),f.a.createElement(Cn.a,{exact:!0,path:"/",render:function(){return f.a.createElement(bn,{audioContext:n,appSettings:e})}}),f.a.createElement(Cn.a,{exact:!0,path:"/scales",render:function(){return f.a.createElement(xn,{audioContext:n})}}),f.a.createElement(Cn.a,{exact:!0,path:"/settings",render:function(){return f.a.createElement(jn,{appSettings:e})}})))},ut=(t(89),function(e){function n(e){var t;return Object(i.a)(this,n),(t=Object(u.a)(this,Object(s.a)(n).call(this,e))).state={error:void 0},t}return Object(l.a)(n,e),Object(c.a)(n,[{key:"render",value:function(){return this.state.error?f.a.createElement("div",null,f.a.createElement("h1",null,"Something went wrong"),f.a.createElement("hr",null),f.a.createElement("code",null,this.state.error instanceof Error&&this.state.error.name),f.a.createElement("hr",null),f.a.createElement("code",null,this.state.error instanceof Error&&this.state.error.message),f.a.createElement("hr",null),f.a.createElement("code",null,this.state.error instanceof Error&&this.state.error.stack),f.a.createElement("hr",null),f.a.createElement("code",null,JSON.stringify(this.state.error,void 0,"  "))):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),n}(f.a.Component));g.a.render(f.a.createElement(S.a,{store:ee},f.a.createElement(ut,null,f.a.createElement(ct,null))),document.getElementById("root"))}},[[66,1,2]]]);
//# sourceMappingURL=main.92b9ab3d.chunk.js.map