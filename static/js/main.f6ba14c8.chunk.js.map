{"version":3,"sources":["click.wav","TempoMarking.tsx","hooks.ts","Common.tsx","Tuner.tsx","TimeSignature.tsx","metronome.ts","TapIn.tsx","Dial.tsx","types.ts","Scales.tsx","serviceWorker.ts","App.tsx","index.tsx"],"names":["module","exports","__webpack_require__","p","markings","name","range","fromBPM","bpm","filter","_ref3","_ref","test","_ref2","Object","slicedToArray","from","to","inRange","TempoMarking","_ref4","react_default","a","createElement","style","minHeight","map","_ref5","idx","key","className","useLocalStorage","initialValue","override","arguments","length","undefined","_useState","useState","firstValue","fromLocal","localStorage","getItem","Function","JSON","parse","window","setItem","stringify","_useState2","value","setValue","useCallback","valueAction","oldValue","newValue","useToggle","sideEffect","toggleState","_useState3","_useState4","old","Button","_ref$classes","classes","children","props","objectWithoutProperties","concat","join","allProps","assign","GrowButton","styled","_templateObject","Buttons","_ref2$classes","SigColumn","div","TimeSignature_templateObject","SigColumns","_templateObject2","TimeSignature","playing","setSignature","signature","beats","activeSubDivisions","_useToggle","_useToggle2","edit","toggleEdit","hasChanged","setHasChanged","_useLocalStorage","_useLocalStorage2","divisions","setDivisions","setNumerator","numerator","objectSpread","R","classesForDivisions","division","indexOf","useEffect","Fragment","marginTop","num","onClick","divisionOption","sort","subDivisions","beat","beatIdx","current","d","bg","justifyContent","Common_Button","click","require","scheduleNote","audioContext","time","gain","buffer","pitch","sound","createBufferSource","detune","volume","createGain","connect","destination","start","beatsFor","startOfBeatTime","secondsPerBeat","currentBeat","reduce","acc","noteOffset","newBeats","divisionIndex","useScheduleAhead","state","beatToSchedule","nextBeat","cancelUIUpdateRef","url","updateBuffer","fetch","then","response","arrayBuffer","decodeAudioData","useAudioBuffer","nextNoteTimeRef","useRef","delay","scheduleAhead","stateRef","beatToScheduleRef","initialTime","currentTime","id","setInterval","nextNoteTime","_state$current","beatData","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_loop","runAtTime","oldDivisions","newDivisions","resetActiveSubDivisions","thing","find","_iterator","Symbol","iterator","next","done","err","return","scheduleGroup","clearInterval","timeToRun","callback","now","setTimeout","currentBeatIndex","calculateBPM","tapTimes","Math","trunc","TapIn","setBPM","taps","setTaps","performance","newTaps","tap","noteIdx","0","1","2","3","4","5","6","7","8","9","10","11","notes","i","j","base","pow","centsPerOctave","frequency","octave","note","push","Tuner","analyser","setAnalyser","setDataArray","_useState5","_useState6","sampleRate","setSampleRate","_useState7","_useState8","freq","setFreq","AudioContext","mediaDevices","navigator","getUserMedia","audio","createAnalyser","fftSize","createMediaStreamSource","close","useLayoutEffect","animationFrame","tick","bufferLength","frequencyBinCount","dataArray","Float32Array","getFloatFrequencyData","_dataArray$reduce","b","maxIdx","resolution","loop","requestAnimationFrame","cancelAnimationFrame","_freqToPitch","low","high","lowPitch","highPitch","average","difference","cents","originalFrequency","freqToPitch","toFixed","Mode","Pitch","Outer","Dial_templateObject","Inner","Dial_templateObject2","ChildContainer","_templateObject3","InfiniKnob","_ref$size","size","addDiff","PI","radians","setRadions","radiansRef","mouseDown","setMouseDown","mouseDownRef","totalDiff","setTotalDiff","totalDiffRef","knobContainer","onMouseUp","_","addToBuffer","diff","abs","oldDiff","moveKnob","e","clientX","clientY","box","getBoundingClientRect","boxCenter","left","width","y","top","height","x","newRadians","atan2","onMouseMove","addEventListener","removeEventListener","sin","cos","ref","onMouseDown","preventDefault","onTouchMove","t0","changedTouches","ScaleMode","A","Major","B","C","D","E","F","G","A_Flat","B_Flat","C_Flat","D_Flat","E_Flat","G_Flat","C_Sharp","D_Sharp","E_Sharp","F_Sharp","Minor","A_Sharp","G_Sharp","getScaleByFilter","scalesDB","getScalesByFilter","scales","entries","forEach","lilMap","scale","initScalesDB","addScale","mode","pitchMap","known","learning","scaleFor","ScalesGroup","toggleLearning","toggleKnown","Common_Buttons","LearnScales","_ref6","addBPM","reset","scaleMode","startMetronome","floor","random","shuffle","s","LEARNING","KNOWN","_ref7","scaleKeys","setScales","currentKey","maybeScale","nextScaleText","_ref8","alignSelf","fontWeight","display","marginBottom","marginRight","flexGrow","nu","slice","Scales","_ref9","stopMetronome","setScalesDB","NOT_STARTED","setScaleMode","_ref10","_ref11","disabled","Scales_ScalesGroup","Scales_LearnScales","_ref12","n","isLocalhost","Boolean","location","hostname","match","register","config","URL","process","href","origin","swUrl","contentType","headers","get","status","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","console","log","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","error","Metronome","setAudioContext","_useMetronome","setPlaying","setBeatToSchedule","_useLocalStorage3","denominator","_useLocalStorage4","_useLocalStorage5","_useLocalStorage6","numeratorRef","bpmRef","stop","toggleStart","bpmToAdd","useMetronome","_useMetronome$state","showScales","toggleScales","_useToggle3","_useToggle4","showTuner","toggleTuner","_useToggle5","_useToggle6","showDial","toggleDial","updateAvailable","setUpdateAvailable","InnerBody","src_TimeSignature","Dial","src_TempoMarking","src_TapIn","src_Scales","src_Tuner","App_templateObject","App","App_Metronome","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.f6ba14c8.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/click.b48ed3e5.wav\";","import React from \"react\";\n\ninterface Marking {\n  range: [number, number];\n  name: string;\n}\n\nexport const markings: Array<Marking> = [\n  { name: \"Larghissimo\", range: [0, 24] },\n  { name: \"Grave\", range: [25, 45] },\n  { name: \"Largo\", range: [40, 60] },\n  { name: \"Lento\", range: [45, 60] },\n  { name: \"Larghetto\", range: [60, 66] },\n  { name: \"Adagio\", range: [66, 76] },\n  { name: \"Andante\", range: [76, 108] },\n  { name: \"Marcia moderato\", range: [83, 85] },\n  { name: \"Andante moderato\", range: [92, 112] },\n  { name: \"Moderato\", range: [108, 120] },\n  { name: \"Allegro\", range: [120, 156] },\n  { name: \"Vivace\", range: [156, 176] },\n  { name: \"Vivacissimo\", range: [172, 176] },\n  { name: \"Allegrissimo\", range: [172, 176] },\n  { name: \"Presto\", range: [168, 200] },\n  { name: \"Prestissimo\", range: [200, 250] }\n];\n\nconst inRange = ([from, to]: [number, number], test: number) => {\n  return test >= from && test <= to;\n};\n\nconst fromBPM = (bpm: number): Array<Marking> => {\n  return markings.filter(({ range }) => inRange(range, bpm));\n};\n\ninterface Props {\n  bpm: number;\n}\n\nconst TempoMarking = ({ bpm }: Props) => {\n  const markings = fromBPM(bpm);\n  return (\n      <div style={{minHeight: '6.5em'}}>\n          {markings.map(({ name, range }, idx) => (\n              <div key={idx} className=\"has-text-centered\">\n                  {name} - {range[0]} - {range[1]}\n              </div>\n          ))}\n              </div>\n  );\n};\n\nexport default TempoMarking;\n","import { useState, Dispatch, SetStateAction, useCallback } from \"react\";\n\n// TODO - add in some logic to do simple migrations. Otherwise, we get stuck\n// with this state forever and have to blow it away.\nexport const useLocalStorage = <T>(\n  key: string,\n  initialValue: T | (() => T),\n  override: boolean = false\n): [T, Dispatch<SetStateAction<T>>] => {\n  const [value, setValue] = useState(() => {\n    let firstValue;\n    const fromLocal = localStorage.getItem(key);\n    if (fromLocal !== null && fromLocal !== undefined && !override) {\n      firstValue = JSON.parse(fromLocal);\n    } else {\n      firstValue =\n        initialValue instanceof Function ? initialValue() : initialValue;\n    }\n    window.localStorage.setItem(key, JSON.stringify(firstValue));\n    return firstValue;\n  });\n\n  const setNewValue: Dispatch<SetStateAction<T>> = useCallback(\n    (valueAction: SetStateAction<T>) => {\n      setValue((oldValue: T) => {\n        const newValue =\n          valueAction instanceof Function ? valueAction(oldValue) : valueAction;\n        window.localStorage.setItem(key, JSON.stringify(newValue));\n        return newValue;\n      });\n    },\n    [key]\n  );\n\n  return [value, setNewValue];\n};\n\nexport const useToggle = (\n  initialValue: boolean,\n  sideEffect = (toggleState: boolean) => {}\n): [boolean, () => void] => {\n  const [value, setValue] = useState(initialValue);\n  const toggle = () =>\n    setValue((old: boolean) => {\n      const newValue = !old;\n      sideEffect(newValue);\n      return newValue;\n    });\n  return [value, toggle];\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\n\ninterface ButtonProps\n  extends React.DetailedHTMLProps<\n    React.ButtonHTMLAttributes<HTMLButtonElement>,\n    HTMLButtonElement\n  > {\n  classes?: string[];\n}\n\nexport const Button = ({ classes = [], children, ...props }: ButtonProps) => {\n  const className = `button ${classes.join(\" \")} ${\n    props[\"className\"] === undefined ? \"\" : props[\"className\"]\n  } `;\n  const allProps = Object.assign(props, { className });\n  return (\n    <button {...allProps} {...props}>\n      {children}\n    </button>\n  );\n};\n\nexport const GrowButton = styled(Button)`\n  flex-grow: 1;\n`;\n\ninterface ButtonsProps\n  extends React.DetailedHTMLProps<\n    React.HTMLAttributes<HTMLDivElement>,\n    HTMLDivElement\n  > {\n  classes?: string[];\n}\n\nexport const Buttons = ({ classes = [], children, ...props }: ButtonsProps) => {\n  const className = `buttons has-addons ${classes.join(\" \")}`;\n  const allProps = Object.assign(props, { className });\n  return <div {...allProps}>{children}</div>;\n};\n","import React, { useEffect, useState, useRef, useLayoutEffect } from \"react\";\n\nconst noteIdx: { [note: number]: string } = {\n  0: \"A\",\n  1: \"Bb\",\n  2: \"B\",\n  3: \"C\",\n  4: \"Db\",\n  5: \"D\",\n  6: \"Eb\",\n  7: \"E\",\n  8: \"F\",\n  9: \"Gb\",\n  10: \"G\",\n  11: \"Ab\"\n};\n\nconst A4 = 440;\nconst notes: Array<{\n  octave: number;\n  note: string;\n  frequency: number;\n  centsPerOctave: number;\n}> = [];\nfor (let i = -4; i < 4; i++) {\n  for (let j = 0; j < 12; j++) {\n    const base = A4 * Math.pow(2, i);\n    const centsPerOctave = base / 1200;\n    const frequency = base * Math.pow(2, j / 12);\n    const octave = i + 4;\n    const note = noteIdx[j];\n    notes.push({ octave, note, frequency, centsPerOctave });\n  }\n}\n\nconst freqToPitch = (freq: number) => {\n  let low = 0;\n  for (let i = 0; i < notes.length; i++) {\n    let note = notes[i];\n    if (note.frequency >= freq) {\n      low = i;\n      break;\n    }\n  }\n  const high = low + 1;\n  const lowPitch = notes[low];\n  const highPitch = notes[high];\n  const average = (lowPitch.frequency + highPitch.frequency) / 2;\n  let note = notes[high];\n  let difference = note.frequency - freq;\n  if (freq < average) {\n    note = notes[low];\n  }\n  const cents = note.centsPerOctave * difference;\n  return Object.assign(note, { originalFrequency: freq, difference, cents });\n};\n\nconst Tuner = () => {\n  const [analyser, setAnalyser] = useState<AnalyserNode>();\n  const [, setDataArray] = useState();\n  const [sampleRate, setSampleRate] = useState<number>();\n  const [freq, setFreq] = useState<number>(440);\n\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n\n  useEffect(() => {\n    const audioContext = new AudioContext();\n    setSampleRate(audioContext.sampleRate);\n    const mediaDevices = navigator.mediaDevices;\n    if (mediaDevices) {\n      mediaDevices.getUserMedia({ audio: true }).then((thing: MediaStream) => {\n        const analyser = audioContext.createAnalyser();\n        // If this isn't big, I don't have very good frequency accuracy, and I\n        // can't change the sample rate because web audio sucks.\n        analyser.fftSize = 8192;\n        const mic = audioContext.createMediaStreamSource(thing);\n        mic.connect(analyser);\n        setAnalyser(analyser);\n      });\n    }\n    return () => {\n      audioContext.close();\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    let animationFrame: number;\n\n    const tick = () => {\n      const bufferLength = analyser!.frequencyBinCount;\n      const dataArray = new Float32Array(bufferLength);\n      analyser!.getFloatFrequencyData(dataArray);\n      setDataArray(dataArray);\n\n      const [, maxIdx] = dataArray.reduce(\n        (a, b, i) => (a[0] < b ? [b, i] : a),\n        [-Infinity, -1]\n      );\n\n      const resolution = sampleRate! / analyser!.fftSize;\n      const freq = resolution * maxIdx;\n      setFreq(freq);\n\n      loop();\n    };\n\n    const loop = () => {\n      animationFrame = requestAnimationFrame(tick);\n    };\n\n    if (analyser !== undefined) {\n      loop();\n      return () => {\n        cancelAnimationFrame(animationFrame);\n      };\n    }\n  }, [analyser, sampleRate]);\n\n  const { octave, note, cents } = freqToPitch(freq || 0);\n  return (\n    <div className=\"box\">\n      <div className=\"has-text-centered\">\n        <div className=\"is-size-1\">{note + octave}</div>\n        <div>\n          {cents.toFixed(2)} Cents {cents < 0 ? \"flat\" : \"sharp\"}\n        </div>\n      </div>\n      {false && <canvas width={\"100%\"} height={\"100\"} ref={canvasRef} />}\n    </div>\n  );\n};\n\nexport default Tuner;\n","import React, { useState, useCallback, useEffect } from \"react\";\nimport * as R from \"ramda\";\nimport styled from \"styled-components\";\nimport { useToggle, useLocalStorage } from \"./hooks\";\nimport { Button, GrowButton } from \"./Common\";\nimport * as t from \"./types\";\n\ninterface Props {\n  signature: t.Signature;\n  setSignature: React.Dispatch<React.SetStateAction<t.Signature>>;\n  playing: boolean;\n  activeSubDivisions: t.Divisions;\n}\n\nconst SigColumn = styled.div`\n  display: flex;\n  flex-grow: 1;\n`;\n\nconst SigColumns = styled.div`\n  display: flex;\n  height: 20px;\n`;\n\nconst TimeSignature = ({\n  playing,\n  signature: { beats },\n  setSignature,\n  activeSubDivisions\n}: Props) => {\n  const [edit, toggleEdit] = useToggle(false);\n  const [hasChanged, setHasChanged] = useState(false);\n  const [divisions, setDivisions] = useLocalStorage<t.DivisionOptions[]>(\n    \"@mjh/time-signature\",\n    [1]\n  );\n  const setNumerator = useCallback(\n    (numerator: number) => {\n      setHasChanged(true);\n      setSignature(old => ({\n        ...old,\n        beats: R.range(0, numerator).map(() => ({ divisions }))\n      }));\n    },\n    [divisions]\n  );\n\n  const classesForDivisions = useCallback(\n    (division: t.DivisionOptions) => {\n      if (divisions.indexOf(division) === -1) {\n        return [\"\"];\n      } else {\n        return [\"is-primary\"];\n      }\n    },\n    [divisions]\n  );\n\n  useEffect(() => {\n    if (hasChanged) {\n      setSignature(old => ({\n        ...old,\n        beats: R.range(0, old.beats.length).map(() => ({ divisions }))\n      }));\n    }\n  }, [divisions, hasChanged]);\n\n  const toggleDivisionOption = (divisionOption: t.DivisionOptions) => {\n    setHasChanged(true);\n    setDivisions(old => {\n      if (old.indexOf(divisionOption) !== -1) {\n        return old.filter(a => a !== divisionOption);\n      } else {\n        return old.concat([divisionOption]).sort();\n      }\n    });\n  };\n\n  return (\n    <>\n      <section\n        style={{ marginTop: \"10px\" }}\n        className=\"section buttons is-centered\"\n      >\n        {([2, 3, 4, 5, 6] as t.DivisionOptions[]).map(\n          (num: t.DivisionOptions) => (\n            <GrowButton\n              key={`division-options-${num}`}\n              classes={classesForDivisions(num)}\n              onClick={() => toggleDivisionOption(num)}\n            >\n              {num}\n            </GrowButton>\n          )\n        )}\n      </section>\n      <section className=\"section is-mobile columns\" onClick={toggleEdit}>\n        {activeSubDivisions.map((subDivisions, beat) => {\n          return (\n            <div className={`column has-text-centered`} key={beat}>\n              {subDivisions.map(({ divisions, current }, beatIdx) => {\n                return (\n                  <SigColumns\n                    key={`d${divisions}`}\n                    className=\"has-background-light\"\n                  >\n                    {R.range(0, divisions).map((d, idx) => {\n                      const bg =\n                        current === idx && playing\n                          ? \"has-background-primary\"\n                          : \"\";\n                      return (\n                        <SigColumn\n                          key={`d${divisions}-${idx}`}\n                          className={`${bg} has-text-centered`}\n                          style={{ justifyContent: \"center\" }}\n                        >\n                          {beatIdx === 0 && beat + 1}\n                        </SigColumn>\n                      );\n                    })}\n                  </SigColumns>\n                );\n              })}\n            </div>\n          );\n        })}\n      </section>\n      {edit && (\n        <section className=\"section buttons is-centered\">\n          <Button onClick={() => setNumerator(2)}>2/4</Button>\n          <Button onClick={() => setNumerator(3)}>3/4</Button>\n          <Button onClick={() => setNumerator(4)}>4/4</Button>\n          <Button onClick={() => setNumerator(5)}>5/4</Button>\n        </section>\n      )}\n    </>\n  );\n};\n\nexport default TimeSignature;\n","import { useEffect, useState, useCallback, useRef } from \"react\";\nimport * as R from \"ramda\";\nimport * as t from \"./types\";\nimport { useLocalStorage } from \"./hooks\";\nconst click = require(\"./click.wav\");\n\n// When I schedule a group of notes, I need to also add to a queue that it's\n// scheduled, and when the scheduled notes change, I need to run runAtExactly to\n// change the gui information..\n\nconst scheduleNote = (\n  audioContext: AudioContext,\n  { time, gain, buffer, pitch }: t.Beat\n) => {\n  const sound = audioContext.createBufferSource();\n  sound.buffer = buffer;\n  sound.detune.value = -pitch;\n\n  const volume = audioContext.createGain();\n  volume.gain.value = gain;\n\n  sound.connect(volume);\n  volume.connect(audioContext.destination);\n  sound.start(time);\n};\n\nconst beatsFor = (\n  startOfBeatTime: number,\n  secondsPerBeat: number,\n  divisions: t.DivisionOptions[],\n  buffer: AudioBuffer,\n  currentBeat: number\n): Array<t.Beat> => {\n  return divisions.reduce((acc: t.Beat[], divisions) => {\n    const noteOffset = secondsPerBeat / divisions;\n    const newBeats = R.range(0, divisions).map((divisionIndex: number) => {\n      const time = startOfBeatTime + divisionIndex * noteOffset;\n      const beat: t.Beat = {\n        time,\n        pitch: 220,\n        gain: 1.0 * 0.5,\n        buffer,\n        divisions,\n        divisionIndex,\n        currentBeat\n      };\n      return beat;\n    });\n    return acc.concat(newBeats);\n  }, []);\n};\n\nconst useAudioBuffer = (\n  audioContext: AudioContext | undefined,\n  url: string\n): AudioBuffer | undefined => {\n  const [buffer, updateBuffer] = useState<AudioBuffer>();\n  useEffect(() => {\n    if (audioContext !== undefined) {\n      fetch(url)\n        .then(response => response.arrayBuffer())\n        .then(buffer => audioContext.decodeAudioData(buffer))\n        .then(updateBuffer);\n    }\n  }, [url, audioContext]);\n  return buffer;\n};\n\nconst scheduleGroup = (\n  state: React.MutableRefObject<t.State>,\n  scheduleAhead: number,\n  nextNoteTime: React.MutableRefObject<number>,\n  buffer: AudioBuffer,\n  audioContext: AudioContext,\n  setDivisions: React.Dispatch<React.SetStateAction<t.Divisions>>,\n  beatToSchedule: React.MutableRefObject<number>,\n  nextBeat: () => void,\n  cancelUIUpdateRef: React.MutableRefObject<boolean>\n) => {\n  const {\n    bpm,\n    signature,\n    signature: { beats }\n  } = state.current;\n  const beatIdx = beatToSchedule.current;\n  const currentBeat = beats[beatToSchedule.current];\n  // This isn't very elegant, there's probably something that's not right.\n  if (currentBeat === undefined) {\n    return;\n  }\n  const divisions = currentBeat.divisions;\n  const secondsPerBeat = 60.0 / bpm;\n  // TODO - this isn't really nextNoteTime, it's something like scheduledUpTo.\n  while (nextNoteTime.current < audioContext.currentTime + scheduleAhead) {\n    // schedule the whole beat, I think.\n    const beatData = beatsFor(\n      nextNoteTime.current,\n      secondsPerBeat,\n      divisions,\n      buffer,\n      beatIdx\n    );\n    for (const beat of beatData) {\n      // TODO - I think I shouldn't play all of the beat 1's\n      scheduleNote(audioContext, beat);\n      runAtTime(audioContext, beat.time, () => {\n        // We only want to update the UI if important assumptions haven't\n        // changed in the time this was scheduled.\n        const shouldStillUpdate =\n          state.current.signature === signature && state.current.playing; // stateBeforeSchedule === state.current;\n        if (shouldStillUpdate) {\n          setDivisions((oldDivisions: t.Divisions) => {\n            const newDivisions = resetActiveSubDivisions(\n              beats,\n              beatIdx,\n              oldDivisions[beatIdx]\n            );\n            const thing = newDivisions[beatIdx].find(\n              d => d.divisions === beat.divisions\n            );\n            if (thing !== undefined) {\n              thing.current = beat.divisionIndex;\n            }\n            return newDivisions;\n          });\n        }\n      });\n    }\n    nextNoteTime.current += secondsPerBeat;\n    nextBeat();\n  }\n};\n\nconst useScheduleAhead = (\n  audioContext: AudioContext | undefined,\n  state: t.State,\n  setDivisions: React.Dispatch<React.SetStateAction<t.Divisions>>,\n  beatToSchedule: number,\n  nextBeat: () => void,\n  cancelUIUpdateRef: React.MutableRefObject<boolean>\n) => {\n  const scheduleAhead = 0.3;\n  const { playing } = state;\n  const buffer = useAudioBuffer(audioContext, click);\n  const nextNoteTimeRef = useRef<number>(0);\n  const delay = playing ? (scheduleAhead * 1000) / 2 : undefined;\n\n  const stateRef = useRef<t.State>(state);\n  useEffect(() => {\n    stateRef.current = state;\n  }, [state]);\n\n  const beatToScheduleRef = useRef(beatToSchedule);\n\n  useEffect(() => {\n    beatToScheduleRef.current = beatToSchedule;\n  }, [beatToSchedule]);\n\n  useEffect(() => {\n    if (\n      delay !== undefined &&\n      audioContext !== undefined &&\n      buffer !== undefined\n    ) {\n      const initialTime = audioContext.currentTime + 0.3;\n      nextNoteTimeRef.current = initialTime;\n      const tick = () => {\n        scheduleGroup(\n          stateRef,\n          scheduleAhead,\n          nextNoteTimeRef,\n          buffer,\n          audioContext,\n          setDivisions,\n          beatToScheduleRef,\n          nextBeat,\n          cancelUIUpdateRef\n        );\n      };\n      const id = setInterval(tick, delay);\n      return () => {\n        clearInterval(id);\n      };\n    }\n  }, [delay, buffer, audioContext, cancelUIUpdateRef, nextBeat, setDivisions]);\n};\n\nconst runAtTime = (\n  audioContext: AudioContext,\n  timeToRun: number,\n  callback: () => void\n) => {\n  const now = audioContext.currentTime;\n  if (timeToRun <= now) {\n    callback();\n  } else {\n    const sleepTime = ((timeToRun - now) / 2) * 1000;\n    setTimeout(() => runAtTime(audioContext, timeToRun, callback), sleepTime);\n  }\n};\n\nconst resetActiveSubDivisions = (\n  beats: t.SignatureBeat[],\n  currentBeatIndex?: number,\n  currentBeat?: t.Division[]\n): t.Divisions => {\n  const b: t.Divisions = beats.map((beat: t.SignatureBeat, idx: number) => {\n    if (idx === currentBeatIndex && currentBeat !== undefined) {\n      return currentBeat;\n    }\n    return beat.divisions.map((divisions: t.DivisionOptions) => ({\n      divisions,\n      current: undefined,\n      pitch: 220,\n      gain: 1.0\n    }));\n  });\n  return b;\n};\n\nexport const useMetronome = (\n  audioContext: AudioContext | undefined\n): t.Metronome => {\n  const [playing, setPlaying] = useState(false);\n  // TODO, the exposed setBPM function should clamp the value.\n  const [bpm, setBPM] = useLocalStorage(\"@mjh/bpm\", 90);\n  const [beatToSchedule, setBeatToSchedule] = useState(0);\n  const [signature, setSignature] = useLocalStorage<t.Signature>(\n    \"@mjh/saved-signature\",\n    {\n      denominator: 4,\n      beats: [{ divisions: [1] }, { divisions: [1] }, { divisions: [1] }]\n    }\n  );\n  const [divisions, setDivisions] = useLocalStorage<t.Division[][]>(\n    \"@mjh/saved-divisions\",\n    resetActiveSubDivisions(signature.beats)\n  );\n\n  const state: t.State = {\n    bpm,\n    playing,\n    signature,\n    divisions\n  };\n  const { beats } = signature;\n\n  const cancelUIUpdateRef = useRef(false);\n  const numeratorRef = useRef(beats.length);\n\n  const addBPM = (bpmToAdd: number) => {\n    setBPM(R.add(bpmToAdd));\n  };\n\n  const bpmRef = useRef(bpm);\n  useEffect(() => {\n    bpmRef.current = bpm;\n  }, [bpm]);\n\n  const start = useCallback(\n    (bpm?: number) => {\n      if (bpm !== undefined) {\n        setBPM(bpm);\n      }\n      setPlaying(true);\n    },\n    [setPlaying]\n  );\n\n  const toggleStart = () => setPlaying(R.not);\n\n  const stop = useCallback(() => {\n    setPlaying(false);\n  }, [setPlaying]);\n\n  const nextBeat = useCallback(() => {\n    setBeatToSchedule(current => (current + 1) % numeratorRef.current);\n  }, []);\n\n  // Effects for updating state.\n\n  // If the time signature changes, we need to reset the active subdivisions.\n  useEffect(() => {\n    // TODO - This would be fancier if when the next beat can still happen, it\n    // didn't clear the active beat in the UI.\n    setDivisions(resetActiveSubDivisions(beats));\n    setBeatToSchedule(0);\n    numeratorRef.current = beats.length;\n  }, [beats, signature]);\n\n  useEffect(() => {\n    if (!playing) {\n      setBeatToSchedule(0);\n      setDivisions(resetActiveSubDivisions(beats));\n      setTimeout(() => {\n        setBeatToSchedule(0);\n        setDivisions(resetActiveSubDivisions(beats));\n      }, 100);\n    }\n  }, [playing, beats]);\n\n  useScheduleAhead(\n    audioContext,\n    state,\n    setDivisions,\n    beatToSchedule,\n    nextBeat,\n    cancelUIUpdateRef\n  );\n\n  return {\n    toggleStart,\n    setSignature,\n    start,\n    stop,\n    setBPM,\n    addBPM,\n    state\n  };\n};\n","import React, { useState } from \"react\";\nimport * as R from \"ramda\";\nimport { Button } from \"./Common\";\n\ninterface Props {\n  setBPM: (bpm: number) => void;\n}\n\nconst calculateBPM = R.pipe(\n  (tapTimes: number[]) => R.aperture(2, tapTimes),\n  R.map(([a, b]) => b - a),\n  R.mean,\n  R.divide(60000),\n  Math.trunc\n);\n\nconst TapIn = ({ setBPM }: Props) => {\n  const [taps, setTaps] = useState<number[]>([]);\n\n  const onTap = () => {\n    const now = performance.now();\n    const newTaps = R.append(now, taps).filter(tap => now - tap < 3000);\n    if (newTaps.length > 1) {\n      const bpm = calculateBPM(newTaps);\n      setBPM(bpm);\n    }\n    setTaps(newTaps);\n  };\n\n  return <Button onClick={onTap}>Tap In</Button>;\n};\n\nexport default TapIn;\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport styled from \"styled-components\";\n\nconst Outer = styled.div`\n  margin: auto;\n  position: relative;\n  height: 300px;\n  width: 300px;\n  border-radius: 300px;\n  display: flex;\n  margin-bottom: 10px;\n`;\n\nconst Inner = styled.div`\n  width: 100px;\n  height: 100px;\n  border-radius: 100px;\n  position: absolute;\n  touch-action: none;\n`;\n\ninterface Props {\n  initialValue: number;\n  addDiff: (diff: number) => void;\n  size?: number;\n}\n\nconst InfiniKnob = ({\n  size = 300,\n  initialValue,\n  addDiff,\n  children\n}: Props &\n  React.DetailedHTMLProps<\n    React.HTMLAttributes<HTMLDivElement>,\n    HTMLDivElement\n  >) => {\n  const [radians, setRadions] = useState((initialValue * (Math.PI * 3)) / 2);\n  const radiansRef = useRef(Math.PI);\n  useEffect(() => {\n    radiansRef.current = radians;\n  }, [radians]);\n\n  const [mouseDown, setMouseDown] = useState(false);\n  const mouseDownRef = useRef(false);\n  useEffect(() => {\n    mouseDownRef.current = mouseDown;\n  }, [mouseDown]);\n\n  const [totalDiff, setTotalDiff] = useState(0);\n  const totalDiffRef = useRef(0);\n  useEffect(() => {\n    totalDiffRef.current = totalDiff;\n  }, [totalDiff]);\n\n  const knobContainer = useRef<HTMLDivElement>(null);\n\n  const onMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\n    setMouseDown(true);\n    e.preventDefault();\n  };\n\n  const onMouseUp = useCallback((_: MouseEvent) => {\n    setMouseDown(false);\n  }, []);\n\n  const addToBuffer = useCallback(\n    (diff: number) => {\n      const threshold = 0.2;\n      if (Math.abs(totalDiffRef.current) < threshold) {\n        setTotalDiff(oldDiff => oldDiff + diff);\n      } else {\n        addDiff(totalDiffRef.current > 0 ? -1 : 1);\n        setTotalDiff(0);\n      }\n    },\n    [addDiff]\n  );\n\n  const moveKnob = useCallback(\n    (e: React.Touch | React.MouseEvent | MouseEvent) => {\n      const { clientX, clientY } = e;\n      const box = knobContainer.current!.getBoundingClientRect();\n\n      const boxCenter = {\n        x: box.left + box.width / 2,\n        y: box.top + box.height / 2\n      };\n      const y = -(boxCenter.y - clientY);\n      const x = -(boxCenter.x - clientX);\n      const newRadians = Math.atan2(y, x);\n      let diff = radiansRef.current - newRadians;\n      if (diff < -Math.PI) {\n        diff = -radiansRef.current - newRadians;\n      } else if (diff > Math.PI) {\n        diff = radiansRef.current - -newRadians;\n      }\n      if (diff !== 0) {\n        addToBuffer(diff);\n      }\n      const same = newRadians === radiansRef.current;\n      if (!same) {\n        setRadions(newRadians);\n      }\n    },\n    [addToBuffer]\n  );\n\n  const onMouseMove = useCallback(\n    (e: React.MouseEvent<HTMLDivElement> | MouseEvent) => {\n      if (mouseDownRef.current) {\n        moveKnob(e);\n      }\n    },\n    [moveKnob]\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"mouseup\", onMouseUp);\n    window.addEventListener(\"mousemove\", onMouseMove);\n    return () => {\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n    };\n  }, [onMouseMove, onMouseUp]);\n\n  const onTouchMove = (e: React.TouchEvent<HTMLDivElement>) => {\n    const t = e.changedTouches;\n    const t0 = t[0];\n    moveKnob(t0);\n  };\n\n  const top =\n    size / 2 +\n    Math.sin(radians) * (size / 4) +\n    (Math.sin(radians) * size) / 16 -\n    size / 6;\n  const left =\n    size / 2 +\n    Math.cos(radians) * (size / 4) +\n    (Math.cos(radians) * size) / 16 -\n    size / 6;\n\n  return (\n    <Outer ref={knobContainer} className=\"has-background-primary\">\n      <Inner\n        className=\"has-background-info\"\n        onMouseDown={onMouseDown}\n        onTouchMove={onTouchMove}\n        style={{\n          top,\n          left\n        }}\n      />\n      <ChildContainer>{children}</ChildContainer>\n    </Outer>\n  );\n};\n\nconst ChildContainer = styled.div`\n  align-self: center;\n  margin: auto;\n  z-index: 1;\n  pointer-events: none;\n`;\n\nexport default InfiniKnob;\n","import React from \"react\";\n\n// TODO - figure out a better way to manage this.\nexport interface SubDivision {\n  on: boolean;\n  pitch: number;\n  divisions: number;\n  label: string;\n  gain: number;\n}\n\nexport enum Mode {\n  Major = \"Major\",\n  Minor = \"Minor\"\n}\n\nexport enum Pitch {\n  A = \"A\",\n  B = \"B\",\n  C = \"C\",\n  D = \"D\",\n  E = \"E\",\n  F = \"F\",\n  G = \"G\",\n\n  A_Flat = \"Ab\",\n  B_Flat = \"Bb\",\n  C_Flat = \"Bb\",\n  D_Flat = \"Db\",\n  E_Flat = \"Eb\",\n  F_Flat = \"Eb\",\n  G_Flat = \"Gb\",\n\n  A_Sharp = \"A#\",\n  B_Sharp = \"B#\",\n  C_Sharp = \"B#\",\n  D_Sharp = \"D#\",\n  E_Sharp = \"E#\",\n  F_Sharp = \"E#\",\n  G_Sharp = \"G#\"\n}\n\n// TODO - this seems promising to be able to iterate through all options, just need to add them all in.\nexport type ScaleKey =\n  // First The naturals\n  | [Pitch.A, Mode.Major]\n  | [Pitch.B, Mode.Major]\n  | [Pitch.C, Mode.Major]\n  | [Pitch.D, Mode.Major]\n  | [Pitch.E, Mode.Major]\n  | [Pitch.F, Mode.Major]\n  | [Pitch.G, Mode.Major]\n  // Now The Flats\n  | [Pitch.A_Flat, Mode.Major]\n  | [Pitch.B_Flat, Mode.Major]\n  | [Pitch.C_Flat, Mode.Major]\n  | [Pitch.D_Flat, Mode.Major]\n  | [Pitch.E_Flat, Mode.Major]\n  | [Pitch.G_Flat, Mode.Major]\n  // The sharps\n  | [Pitch.C_Sharp, Mode.Major]\n  | [Pitch.D_Sharp, Mode.Major]\n  | [Pitch.E_Sharp, Mode.Major]\n  | [Pitch.F_Sharp, Mode.Major]\n  // Now The Minors\n  | [Pitch.A, Mode.Minor]\n  | [Pitch.B, Mode.Minor]\n  | [Pitch.C, Mode.Minor]\n  | [Pitch.D, Mode.Minor]\n  | [Pitch.E, Mode.Minor]\n  | [Pitch.F, Mode.Minor]\n  | [Pitch.G, Mode.Minor]\n  // Flat\n  | [Pitch.A_Flat, Mode.Minor]\n  | [Pitch.B_Flat, Mode.Minor]\n  | [Pitch.E_Flat, Mode.Minor]\n  // Sharp\n  | [Pitch.A_Sharp, Mode.Minor]\n  | [Pitch.C_Sharp, Mode.Minor]\n  | [Pitch.D_Sharp, Mode.Minor]\n  | [Pitch.F_Sharp, Mode.Minor]\n  | [Pitch.G_Sharp, Mode.Minor];\n\n// It's easy to forget one of these, so be careful, I guess. I couldn't figure\n// out a good way to do this, but this definitely works. I just copy the thing at the top and replace | with ,\nexport const scaleKeys: ScaleKey[] = [\n  // First The naturals\n  [Pitch.A, Mode.Major],\n  [Pitch.B, Mode.Major],\n  [Pitch.C, Mode.Major],\n  [Pitch.D, Mode.Major],\n  [Pitch.E, Mode.Major],\n  [Pitch.F, Mode.Major],\n  [Pitch.G, Mode.Major],\n  // Now The Flats\n  [Pitch.A_Flat, Mode.Major],\n  [Pitch.B_Flat, Mode.Major],\n  [Pitch.C_Flat, Mode.Major],\n  [Pitch.D_Flat, Mode.Major],\n  [Pitch.E_Flat, Mode.Major],\n  [Pitch.G_Flat, Mode.Major],\n  // The sharps\n  [Pitch.C_Sharp, Mode.Major],\n  [Pitch.D_Sharp, Mode.Major],\n  [Pitch.E_Sharp, Mode.Major],\n  [Pitch.F_Sharp, Mode.Major],\n  // Now The Minors\n  [Pitch.A, Mode.Minor],\n  [Pitch.B, Mode.Minor],\n  [Pitch.C, Mode.Minor],\n  [Pitch.D, Mode.Minor],\n  [Pitch.E, Mode.Minor],\n  [Pitch.F, Mode.Minor],\n  [Pitch.G, Mode.Minor],\n  // Flat\n  [Pitch.A_Flat, Mode.Minor],\n  [Pitch.B_Flat, Mode.Minor],\n  [Pitch.E_Flat, Mode.Minor],\n  // Sharp\n  [Pitch.A_Sharp, Mode.Minor],\n  [Pitch.C_Sharp, Mode.Minor],\n  [Pitch.D_Sharp, Mode.Minor],\n  [Pitch.F_Sharp, Mode.Minor],\n  [Pitch.G_Sharp, Mode.Minor]\n];\n\nexport interface Scale {\n  mode: Mode;\n  pitch: Pitch;\n  known: boolean;\n  learning: boolean;\n  bpm: number;\n}\n\nexport type ScalesDB = {\n  [pitch: string]: {\n    [mode: string]: Scale;\n  };\n}; // Map<Pitch, Map<Mode, Scale>>;\n\nexport interface Beat {\n  time: number;\n  pitch: number;\n  gain: number;\n  buffer: AudioBuffer;\n  divisions: DivisionOptions;\n  divisionIndex: number;\n  currentBeat: number;\n}\n\nexport interface SignatureBeat {\n  divisions: Array<DivisionOptions>;\n}\n\nexport interface Signature {\n  denominator: number;\n  beats: Array<SignatureBeat>;\n}\n\nexport type DivisionOptions = 1 | 2 | 3 | 4 | 5 | 6;\n\nexport interface Division {\n  gain: number;\n  pitch: number;\n  divisions: DivisionOptions;\n  current: number | undefined;\n}\n\nexport type Divisions = Division[][];\n\nexport interface State {\n  bpm: number;\n  playing: boolean;\n  signature: Signature;\n  // The first index of divisions is always { divisions: 1 }, so it will either\n  // be current: 0, or current: undefined depending on whether or not it is the\n  // current beat.\n  // TODO - I should add an actual assert on this somewhere. It's bound to bite\n  // me eventually.\n  divisions: Divisions;\n}\n\nexport interface Metronome {\n  toggleStart: () => void;\n  start: (bpm?: number) => void;\n  stop: () => void;\n  setBPM: React.Dispatch<React.SetStateAction<number>>;\n  setSignature: React.Dispatch<React.SetStateAction<Signature>>;\n  addBPM: (bpmToAdd: number) => void;\n  state: State;\n}\n","import React, { useEffect, useState } from \"react\";\n\nimport { useLocalStorage } from \"./hooks\";\nimport * as R from \"ramda\";\nimport { Button, Buttons } from \"./Common\";\nimport { Scale, Pitch, Mode, ScalesDB } from \"./types\";\n\nenum ScaleMode {\n  NOT_STARTED = \"Not Started\",\n  LEARNING = \"Learning\",\n  KNOWN = \"Known\"\n}\n\ninterface Props {\n  startMetronome: (bpm: number) => void;\n  stopMetronome: () => void;\n}\n\nconst getScaleByFilter = (\n  scalesDB: ScalesDB,\n  filter: (s: Scale) => boolean\n): Scale | undefined => {\n  return getScalesByFilter(scalesDB, filter)[0];\n};\n\nconst getScalesByFilter = (\n  scalesDB: ScalesDB,\n  filter: (s: Scale) => boolean\n) => {\n  let scales: Scale[] = [];\n  Object.entries(scalesDB).forEach(([, lilMap]) => {\n    Object.entries(lilMap).forEach(([, scale]) => {\n      if (filter(scale)) {\n        scales.push(scale);\n      }\n    });\n  });\n  return scales;\n};\n\nconst initScalesDB = (): ScalesDB => {\n  const scalesDB: ScalesDB = {};\n  const scaleFor = (pitch: Pitch, mode: Mode): Scale => ({\n    pitch,\n    mode,\n    known: false,\n    learning: false,\n    bpm: 60\n  });\n\n  const addScale = (pitch: Pitch, mode: Mode): void => {\n    let pitchMap = scalesDB[pitch];\n    if (pitchMap === undefined) {\n      pitchMap = {};\n      scalesDB[pitch] = pitchMap;\n    }\n    pitchMap[mode] = scaleFor(pitch, mode);\n  };\n  // TODO(me) - clean up scale names & add sharps.\n  // Major\n  addScale(Pitch.A, Mode.Major);\n  addScale(Pitch.B_Flat, Mode.Major);\n  addScale(Pitch.B, Mode.Major);\n  addScale(Pitch.C, Mode.Major);\n  addScale(Pitch.D_Flat, Mode.Major);\n  addScale(Pitch.D, Mode.Major);\n  addScale(Pitch.E_Flat, Mode.Major);\n  addScale(Pitch.E, Mode.Major);\n  addScale(Pitch.F, Mode.Major);\n  addScale(Pitch.G_Flat, Mode.Major);\n  addScale(Pitch.G, Mode.Major);\n  addScale(Pitch.A_Flat, Mode.Major);\n\n  // Minor\n  addScale(Pitch.A, Mode.Minor);\n  addScale(Pitch.B_Flat, Mode.Minor);\n  addScale(Pitch.B, Mode.Minor);\n  addScale(Pitch.C, Mode.Minor);\n  addScale(Pitch.D_Flat, Mode.Minor);\n  addScale(Pitch.D, Mode.Minor);\n  addScale(Pitch.E_Flat, Mode.Minor);\n  addScale(Pitch.E, Mode.Minor);\n  addScale(Pitch.F, Mode.Minor);\n  addScale(Pitch.G_Flat, Mode.Minor);\n  addScale(Pitch.G, Mode.Minor);\n  addScale(Pitch.A_Flat, Mode.Minor);\n  return scalesDB;\n};\n\nconst ScalesGroup = ({\n  pitch,\n  mode,\n  learning,\n  known,\n  toggleLearning,\n  toggleKnown\n}: Scale & { toggleLearning: () => void; toggleKnown: () => void }) => {\n  return (\n    <div className=\"is-grouped field has-addons\">\n      <div className=\"is-size-5 control is-expanded\">\n        {pitch} {mode}\n      </div>\n      <Buttons>\n        <Button classes={[known ? \"is-info\" : \"\"]} onClick={toggleKnown}>\n          Known\n        </Button>\n        <Button classes={[learning ? \"is-link\" : \"\"]} onClick={toggleLearning}>\n          Learning\n        </Button>\n      </Buttons>\n    </div>\n  );\n};\nfunction shuffle<T>(a: Array<T>) {\n  var j, x, i;\n  for (i = a.length - 1; i > 0; i--) {\n    j = Math.floor(Math.random() * (i + 1));\n    x = a[i];\n    a[i] = a[j];\n    a[j] = x;\n  }\n  return a;\n}\n\ninterface LearnScalesProps {\n  scalesDB: ScalesDB;\n  addBPM: (s: Scale, n: number) => () => void;\n  startMetronome: (bpm: number) => void;\n  reset: () => void;\n  scaleMode: ScaleMode;\n}\n\nconst LearnScales = ({\n  scalesDB,\n  addBPM,\n  reset,\n  scaleMode,\n  startMetronome\n}: LearnScalesProps) => {\n  const [scaleKeys, setScales] = useState<Array<[Mode, Pitch]>>(() =>\n    shuffle(\n      getScalesByFilter(scalesDB, s => {\n        if (scaleMode === ScaleMode.LEARNING) {\n          return s.learning;\n        } else if (scaleMode === ScaleMode.KNOWN) {\n          return s.known;\n        }\n        return false;\n      }).map(({ mode, pitch }) => [mode, pitch])\n    )\n  );\n  const nextScale = () => {\n    setScales(old => {\n      const nu = old.slice(1);\n      if (nu.length === 0) {\n        reset();\n      }\n      return nu;\n    });\n  };\n\n  const currentKey = scaleKeys[0] || [];\n  const maybeScale = getScaleByFilter(\n    scalesDB,\n    (s: Scale) => s.mode === currentKey[0] && s.pitch === currentKey[1]\n  );\n  useEffect(() => {\n    if (maybeScale !== undefined) {\n      startMetronome(maybeScale.bpm);\n    }\n  }, [maybeScale, startMetronome]);\n  const nextScaleText = scaleKeys.length > 1 ? \"Next Scale\" : \"Finish\";\n\n  // TODO - this error handling makes me sad, I should really do better.\n  if (scaleKeys.length === 0) {\n    return <div>No more scales</div>;\n  }\n  const scale = maybeScale!;\n  const { mode, pitch, bpm } = scale!;\n\n  return (\n    <div>\n      <div\n        style={{ alignSelf: \"center\", fontWeight: \"bold\" }}\n        className=\"control is-expanded is-size-5\"\n      >\n        {scaleMode}\n      </div>\n      <div style={{ display: \"flex\", marginBottom: \"5px\" }}>\n        <div style={{ alignSelf: \"center\", marginRight: \"10px\" }}>\n          {pitch} {mode} @ {bpm}bpm\n        </div>\n        <Buttons style={{ flexGrow: 1 }}>\n          <Button\n            classes={[\"is-danger\", \"is-outlined\"]}\n            style={{ flexGrow: 1 }}\n            onClick={addBPM(scale, -10)}\n          >\n            -10\n          </Button>\n          <Button\n            classes={[\"is-danger\", \"is-outlined\"]}\n            style={{ flexGrow: 1 }}\n            onClick={addBPM(scale, -1)}\n          >\n            -\n          </Button>\n          <Button\n            classes={[\"is-success\", \"is-outlined\"]}\n            style={{ flexGrow: 1 }}\n            onClick={addBPM(scale, 1)}\n          >\n            +\n          </Button>\n          <Button\n            classes={[\"is-success\", \"is-outlined\"]}\n            style={{ flexGrow: 1 }}\n            onClick={addBPM(scale, 10)}\n          >\n            +10\n          </Button>\n        </Buttons>\n      </div>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n        <Button onClick={reset}>Stop</Button>\n        <Button onClick={nextScale}>{nextScaleText}</Button>\n      </div>\n    </div>\n  );\n};\n\nconst Scales = ({ startMetronome, stopMetronome, ...props }: Props) => {\n  const [scalesDB, setScalesDB] = useLocalStorage(\n    \"@mjh/metronome/scales-db\",\n    initScalesDB\n  );\n\n  const [scaleMode, setScaleMode] = useState(ScaleMode.NOT_STARTED);\n\n  useEffect(() => {\n    if (scaleMode === ScaleMode.NOT_STARTED) {\n      stopMetronome();\n    }\n  }, [scaleMode, stopMetronome]);\n\n  const toggleLearning = ({ pitch, mode }: Scale) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"learning\"]), R.not));\n  };\n\n  const toggleKnown = ({ pitch, mode }: Scale) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"known\"]), R.not));\n  };\n\n  const addBPM = ({ pitch, mode }: Scale, n: number) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"bpm\"]), R.add(n)));\n  };\n\n  return (\n    <div className=\"box\" style={{ marginTop: \"10px\" }}>\n      {scaleMode === ScaleMode.NOT_STARTED ? (\n        <div style={{ marginBottom: \"5px\" }}>\n          <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n            <div\n              style={{ alignSelf: \"center\", fontWeight: \"bold\" }}\n              className=\"control is-expanded is-size-5\"\n            >\n              Scales\n            </div>\n            <Buttons>\n              <Button\n                onClick={() => setScaleMode(ScaleMode.KNOWN)}\n                disabled={\n                  getScaleByFilter(scalesDB, s => s.known) === undefined\n                }\n                classes={[\"is-info\", \"is-outlined\"]}\n              >\n                Start Known\n              </Button>\n              <Button\n                onClick={() => setScaleMode(ScaleMode.LEARNING)}\n                disabled={\n                  getScaleByFilter(scalesDB, s => s.learning) === undefined\n                }\n                classes={[\"is-link\", \"is-outlined\"]}\n              >\n                Start Learning\n              </Button>\n            </Buttons>\n          </div>\n          <hr />\n\n          {getScalesByFilter(scalesDB, s => s.mode === Mode.Major).map(\n            (scale: Scale) => (\n              <ScalesGroup\n                key={`${scale.pitch}-${scale.mode}`}\n                {...scale}\n                toggleLearning={toggleLearning(scale)}\n                toggleKnown={toggleKnown(scale)}\n              />\n            )\n          )}\n          <hr />\n          {getScalesByFilter(scalesDB, s => s.mode === Mode.Minor).map(\n            (scale: Scale) => (\n              <ScalesGroup\n                key={`${scale.pitch}-${scale.mode}`}\n                {...scale}\n                toggleLearning={toggleLearning(scale)}\n                toggleKnown={toggleKnown(scale)}\n              />\n            )\n          )}\n        </div>\n      ) : (\n        <LearnScales\n          scaleMode={scaleMode}\n          startMetronome={startMetronome}\n          addBPM={addBPM}\n          scalesDB={scalesDB}\n          reset={() => setScaleMode(ScaleMode.NOT_STARTED)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Scales;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React, { useEffect } from \"react\";\nimport { useState } from \"react\";\nimport styled from \"styled-components\";\nimport TempoMarking from \"./TempoMarking\";\nimport TimeSignature from \"./TimeSignature\";\nimport { useMetronome } from \"./metronome\";\nimport TapIn from \"./TapIn\";\nimport Tuner from \"./Tuner\";\nimport Dial from \"./Dial\";\nimport Scales from \"./Scales\";\nimport { useToggle } from \"./hooks\";\nimport { Button, GrowButton, Buttons } from \"./Common\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nconst Metronome = () => {\n  const [audioContext, setAudioContext] = useState<AudioContext | undefined>();\n  const {\n    state: { playing, signature, divisions, bpm },\n    start,\n    stop,\n    toggleStart,\n    setSignature,\n    setBPM,\n    addBPM\n  } = useMetronome(audioContext);\n\n  // Initialize AudioContext as a singleton on first start.\n  useEffect(() => {\n    if (playing && audioContext === undefined) {\n      setAudioContext(new AudioContext());\n    }\n  }, [playing, audioContext]);\n\n  const [showScales, toggleScales] = useToggle(false);\n  const [showTuner, toggleTuner] = useToggle(false);\n  const [showDial, toggleDial] = useToggle(true);\n\n  // TODO - This doesn't seem to work, but I don't really know why.\n  const [updateAvailable, setUpdateAvailable] = useState(false);\n  useEffect(() => {\n    serviceWorker.register({\n      onUpdate: () => {\n        setUpdateAvailable(true);\n      }\n    });\n  });\n\n  return (\n    <InnerBody>\n      {updateAvailable && (\n        <section\n          className=\"box is-grouped field has-addons\"\n          style={{ marginBottom: \"10px\" }}\n        >\n          <p style={{ alignSelf: \"center\" }} className=\"control is-expanded\">\n            An Update is Available!\n          </p>\n          <Button onClick={() => window.location.reload()}>Refresh</Button>\n        </section>\n      )}\n      <TimeSignature\n        playing={playing}\n        signature={signature}\n        setSignature={setSignature}\n        activeSubDivisions={divisions}\n      />\n      {showDial && (\n        <section className=\"section\">\n          <Dial initialValue={bpm} addDiff={addBPM}>\n            <div className=\"has-text-centered is-size-1\">{bpm}</div>\n            <TempoMarking bpm={bpm} />\n          </Dial>\n        </section>\n      )}\n\n      <section className=\"section\">\n        <Buttons>\n          {/* <SubDivisions subDivisions={subDivisions} toggle={toggleSubDivision} /> */}\n          <TapIn setBPM={setBPM} />\n          <GrowButton\n            classes={[\"is-outlined\", playing ? \"is-danger\" : \"is-primary\"]}\n            onClick={toggleStart}\n          >\n            {playing ? \"Stop\" : \"Start\"}\n          </GrowButton>\n        </Buttons>\n      </section>\n      {showScales && <Scales startMetronome={start} stopMetronome={stop} />}\n      {showTuner && <Tuner />}\n      <nav className=\"navbar is-fixed-bottom has-background-light\">\n        <InnerBody className=\" buttons is-right\">\n          <Button classes={[showDial ? \"is-primary\" : \"\"]} onClick={toggleDial}>\n            Dial\n          </Button>\n          <Button\n            classes={[showScales ? \"is-primary\" : \"\"]}\n            onClick={toggleScales}\n          >\n            Scales\n          </Button>\n          <Button\n            classes={[showTuner ? \"is-primary\" : \"\"]}\n            onClick={toggleTuner}\n          >\n            Tuner\n          </Button>\n          <div>{`v${process.env.REACT_APP_VERSION}`}</div>\n        </InnerBody>\n      </nav>\n    </InnerBody>\n  );\n};\n\nconst InnerBody = styled.div`\n  max-width: 500px;\n  margin: 0 auto;\n  padding-left: 10px;\n  padding-right: 10px;\n`;\n\nconst App: React.FC = () => {\n  return <Metronome />;\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./bulma-overrides.sass\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}