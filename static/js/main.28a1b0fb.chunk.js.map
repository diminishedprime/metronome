{"version":3,"sources":["click.wav","types.ts","TempoMarking.tsx","hooks.ts","Common.tsx","TimeSignature.tsx","util.ts","metronome.ts","TapIn.tsx","Tuner.tsx","Dial.tsx","Scales.tsx","Metronome.tsx","serviceWorker.ts","Update.tsx","App.tsx","index.tsx"],"names":["module","exports","__webpack_require__","p","LocalStorageKey","Mode","Pitch","markings","name","range","fromBPM","bpm","filter","_ref3","_ref","test","_ref2","Object","slicedToArray","from","to","inRange","TempoMarking","_ref4","react_default","a","createElement","style","minHeight","map","_ref5","idx","key","className","scaleKeys","A","Major","B","C","D","E","F","G","A_Flat","B_Flat","C_Flat","D_Flat","E_Flat","G_Flat","C_Sharp","F_Sharp","Minor","A_Sharp","D_Sharp","G_Sharp","useLocalStorage","initialValue","override","arguments","length","undefined","_useState3","useState","firstValue","fromLocal","localStorage","getItem","Function","JSON","parse","window","setItem","stringify","_useState4","value","setValue","useCallback","valueAction","oldValue","newValue","usePersistantToggle","_useLocalStorage","_useLocalStorage2","storageValue","setStorageValue","R","useDetectChangedValue","_len","values","Array","_key","oldValues","useRef","useEffect","lastValues","current","newValues","forEach","lastValue","index","diff","d","console","log","concat","ToggleButton","props","_useState","_useState2","buttonProps","setButtonProps","on","children","_props$className","newProps","renderProps","objectWithoutProperties","child","Common_Button","Button","isPrimary","isDanger","isLink","isInfo","isSuccess","isOutlined","offIsPrimary","offIsDanger","offIsLink","offIsInfo","offIsSuccess","offIsOutlined","grow","primary","link","danger","info","success","outlined","offprimary","offlink","offdanger","offinfo","offsuccess","offoutlined","propClassName","flexGrow","assign","objectSpread","Buttons","classes","allProps","SigColumn","styled","div","_templateObject","SigColumns","_templateObject2","BeatColumnRow","playing","activeBeats","beatIdx","division","divisionIdx","beatDivisions","enabledDivisions","divisions","parseInt","bg","marginTop","marginLeft","marginRight","justifyContent","height","keys","BeatColumn","TimeSignature_BeatColumnRow","TimeSignature","numerator","signature","setSignature","hasChanged","setHasChanged","t","SignatureDivisions","1","uIenabledDivisions","setUiEnabledDivisions","setNumerator","old","toggleDivisionOption","divisionOption","clearDivisions","Fragment","paddingLeft","marginBottom","num","onClick","TimeSignature_BeatColumn","click","require","scheduleNote","audioContext","time","gain","buffer","pitch","currentBeat","divisionIndex","isOne","sound","createBufferSource","detune","volume","createGain","connect","destination","start","addBeatsToQueue","state","nextNoteTime","currentTime","scheduleAhead","beatsQueue","nextBeat","secondsPerBeat","beatsForNextMeasure","startOfBeatTime","beats","noteOffset","beat","push","sort","b","beatsFor","apply","toConsumableArray","intervalError","useScheduleAhead","setActiveDivisions","url","_useState7","_useState8","updateBuffer","fetch","then","response","arrayBuffer","decodeAudioData","useAudioBuffer","nextNoteTimeRef","delay","stateRef","beatToSchedule","setBeatToSchedule","beatToScheduleRef","setActiveBeat","oldBeats","withNewBeat","activeBeat","defineProperty","lastBeatIdx","reduce","acc","updateUi","runAtTime","timeToRun","callback","now","setTimeout","Deque","firstClickTime","tick","Math","min","intervalLength","scheduleTil","peekFront","first","shift","playBeatsTill","id","setInterval","clearInterval","resetActiveBeats","clampBPM","useMetronome","setPlaying","_useAdvice","advice","originalT","originalSetter","newSetter","action","oldT","useAdvice","BPM","_useAdvice2","setBPM","denominator","_useLocalStorage3","ActiveBeats","_useLocalStorage4","activeDivisions","bpmRef","toggleStart","stop","addBPM","bpmToAdd","calculateBPM","tapTimes","trunc","TapIn","taps","setTaps","performance","newTaps","tap","noteIdx","0","2","3","4","5","6","7","8","9","10","11","notes","i","j","base","pow","centsPerOctave","frequency","octave","note","TunerWrapper","section","Tuner_templateObject","Tuner","_useToggle","sideEffect","toggleState","_useState5","_useState6","useToggle","_useToggle2","toggleOn","analyser","setAnalyser","sampleRate","setSampleRate","freq","setFreq","setAudioContext","AudioContext","mediaStream","mediaDevices","navigator","getUserMedia","audio","ms","createAnalyser","fftSize","createMediaStreamSource","getAudioTracks","track","bufferLength","frequencyBinCount","dataArray","Float32Array","getFloatFrequencyData","_dataArray$reduce","maxIdx","resolution","interval","_freqToPitch","low","high","lowPitch","highPitch","average","difference","cents","originalFrequency","freqToPitch","toFixed","Common_Buttons","Common_ToggleButton","ScaleMode","Outer","Dial_templateObject","Inner","Dial_templateObject2","ChildContainer","_templateObject3","InfiniKnob","_ref$size","size","addDiff","Radians","PI","radians","setRadians","radiansRef","mouseDown","setMouseDown","mouseDownRef","totalDiff","setTotalDiff","totalDiffRef","knobContainer","onMouseUp","_","addToBuffer","abs","oldDiff","moveKnob","e","clientX","clientY","box","getBoundingClientRect","boxCenter","left","width","y","top","x","newRadians","atan2","onMouseMove","addEventListener","removeEventListener","sin","cos","ref","onMouseDown","preventDefault","onTouchMove","t0","changedTouches","getScaleByFilter","scalesDB","getScalesByFilter","scales","entries","lilMap","scale","initScalesDB","addScale","scaleKey","mode","pitchMap","known","learning","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","err","return","ScalesGroup","_ref5$scaleKey","toggleLearning","toggleKnown","LearnScales","_ref6","reset","scaleMode","startMetronome","floor","random","shuffle","s","LEARNING","KNOWN","_ref7","setScales","currentKey","maybeScale","nextScaleText","_ref8","alignSelf","fontWeight","display","nu","slice","Scales","_ref9","stopMetronome","ScalesDB","setScalesDB","NOT_STARTED","setScaleMode","_ref10","_ref11","_usePersistantToggle","ShowKnown","_usePersistantToggle2","showKnown","toggleShowKnown","disabled","Scales_ScalesGroup","Scales_LearnScales","_ref12","n","TopSettings","Metronome_templateObject","Metronome","WakeLock","wakeLock","toggleWakeLock","_usePersistantToggle3","ShowScales","_usePersistantToggle4","showScales","toggleScales","_usePersistantToggle5","ShowTuner","_usePersistantToggle6","showTuner","toggleTuner","_usePersistantToggle7","ShowDial","_usePersistantToggle8","showDial","toggleDial","_useSleepLock","NoSleep","noSleep","lock","enable","release","disable","useSleepLock","_useMetronome","_useMetronome$state","InnerBody","src_Tuner","Dial","src_TempoMarking","src_TimeSignature","src_TapIn","src_Scales","Metronome_templateObject2","isLocalhost","Boolean","location","hostname","match","register","config","URL","process","href","origin","swUrl","contentType","headers","get","status","indexOf","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","error","rotate","keyframes","Update_templateObject","UpdateStyle","Update_templateObject2","Update","updateAvailable","setUpdateAvailable","React","close","TopBarWrapper","App_templateObject","TopBar","react_router_dom","WrapperStyle","App_templateObject2","FooterStyle","App_templateObject3","Wrapper","App_TopBar","App","basename","App_Wrapper","react_router","exact","path","component","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.28a1b0fb.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/click.b48ed3e5.wav\";","import React from \"react\";\n\nexport enum LocalStorageKey {\n  SignatureDivisions = \"@mjh/k/signature-divisions-3\",\n  ShowKnown = \"@mjh/k/show-known-2\",\n  ScalesDB = \"@mjh/k/scales-db-1\",\n  ActiveBeats = \"@mjh/k/active-beats-2\",\n  TimeSignature = \"@mjh/k/signature-2\",\n  BPM = \"@mjh/k/bpm-0\",\n  KnownScales = \"@mjh/k/known-scales-0\",\n  ShowScales = \"@mjh/k/show-scales-0\",\n  ShowTuner = \"@mjh/k/show-tuner-0\",\n  ShowDial = \"@mjh/k/show-dial-0\",\n  Radians = \"@mjh/k/radians-0\",\n  WakeLock = \"@mjh/k/wake-lock-0\"\n}\n\nexport enum Mode {\n  Major = \"Major\",\n  Minor = \"Minor\"\n}\n\nexport enum Pitch {\n  A = \"A\",\n  B = \"B\",\n  C = \"C\",\n  D = \"D\",\n  E = \"E\",\n  F = \"F\",\n  G = \"G\",\n\n  A_Flat = \"Ab\",\n  B_Flat = \"Bb\",\n  C_Flat = \"Cb\",\n  D_Flat = \"Db\",\n  E_Flat = \"Eb\",\n  F_Flat = \"Fb\",\n  G_Flat = \"Gb\",\n\n  A_Sharp = \"A#\",\n  B_Sharp = \"B#\",\n  C_Sharp = \"C#\",\n  D_Sharp = \"D#\",\n  E_Sharp = \"E#\",\n  F_Sharp = \"F#\",\n  G_Sharp = \"G#\"\n}\n\n// TODO - this seems promising to be able to iterate through all options, just need to add them all in.\nexport type ScaleKey =\n  // First The naturals\n  | [Pitch.A, Mode.Major]\n  | [Pitch.B, Mode.Major]\n  | [Pitch.C, Mode.Major]\n  | [Pitch.D, Mode.Major]\n  | [Pitch.E, Mode.Major]\n  | [Pitch.F, Mode.Major]\n  | [Pitch.G, Mode.Major]\n  // Now The Flats\n  | [Pitch.A_Flat, Mode.Major]\n  | [Pitch.B_Flat, Mode.Major]\n  | [Pitch.C_Flat, Mode.Major]\n  | [Pitch.D_Flat, Mode.Major]\n  | [Pitch.E_Flat, Mode.Major]\n  | [Pitch.G_Flat, Mode.Major]\n  // The sharps\n  | [Pitch.C_Sharp, Mode.Major]\n  | [Pitch.D_Sharp, Mode.Major]\n  | [Pitch.E_Sharp, Mode.Major]\n  | [Pitch.F_Sharp, Mode.Major]\n  // Now The Minors\n  | [Pitch.A, Mode.Minor]\n  | [Pitch.B, Mode.Minor]\n  | [Pitch.C, Mode.Minor]\n  | [Pitch.D, Mode.Minor]\n  | [Pitch.E, Mode.Minor]\n  | [Pitch.F, Mode.Minor]\n  | [Pitch.G, Mode.Minor]\n  // Flat\n  | [Pitch.A_Flat, Mode.Minor]\n  | [Pitch.B_Flat, Mode.Minor]\n  | [Pitch.E_Flat, Mode.Minor]\n  // Sharp\n  | [Pitch.A_Sharp, Mode.Minor]\n  | [Pitch.C_Sharp, Mode.Minor]\n  | [Pitch.D_Sharp, Mode.Minor]\n  | [Pitch.F_Sharp, Mode.Minor]\n  | [Pitch.G_Sharp, Mode.Minor];\n\n// It's easy to forget one of these, so be careful, I guess. I couldn't figure\n// out a good way to do this, but this definitely works. I just copy the thing at the top and replace | with ,\nexport const scaleKeys: ScaleKey[] = [\n  // First The naturals\n  [Pitch.A, Mode.Major],\n  [Pitch.B, Mode.Major],\n  [Pitch.C, Mode.Major],\n  [Pitch.D, Mode.Major],\n  [Pitch.E, Mode.Major],\n  [Pitch.F, Mode.Major],\n  [Pitch.G, Mode.Major],\n  // Now The Flats\n  [Pitch.A_Flat, Mode.Major],\n  [Pitch.B_Flat, Mode.Major],\n  [Pitch.C_Flat, Mode.Major],\n  [Pitch.D_Flat, Mode.Major],\n  [Pitch.E_Flat, Mode.Major],\n  [Pitch.G_Flat, Mode.Major],\n  // The sharps\n  [Pitch.C_Sharp, Mode.Major],\n  [Pitch.F_Sharp, Mode.Major],\n  // Now The Minors\n  [Pitch.A, Mode.Minor],\n  [Pitch.B, Mode.Minor],\n  [Pitch.C, Mode.Minor],\n  [Pitch.D, Mode.Minor],\n  [Pitch.E, Mode.Minor],\n  [Pitch.F, Mode.Minor],\n  [Pitch.G, Mode.Minor],\n  // Flat\n  [Pitch.A_Flat, Mode.Minor],\n  [Pitch.B_Flat, Mode.Minor],\n  [Pitch.E_Flat, Mode.Minor],\n  // Sharp\n  [Pitch.A_Sharp, Mode.Minor],\n  [Pitch.C_Sharp, Mode.Minor],\n  [Pitch.D_Sharp, Mode.Minor],\n  [Pitch.F_Sharp, Mode.Minor],\n  [Pitch.G_Sharp, Mode.Minor]\n];\n\nexport interface Scale {\n  scaleKey: ScaleKey;\n  mode: Mode;\n  pitch: Pitch;\n  known: boolean;\n  learning: boolean;\n  bpm: number;\n}\n\nexport type ScalesDB = {\n  [pitch: string]: {\n    [mode: string]: Scale;\n  };\n}; // Map<Pitch, Map<Mode, Scale>>;\n\nexport interface Beat {\n  time: number;\n  pitch: number;\n  gain: number;\n  buffer: AudioBuffer;\n  divisions: Division;\n  divisionIndex: number;\n  currentBeat: number;\n}\n\nexport type Division = 1 | 2 | 3 | 4 | 5 | 6;\n\nexport type ActiveDivisions = {\n  [divisionOption: number]: number | undefined;\n};\nexport type EnabledDivisions = {\n  [divisionOption: number]: boolean;\n};\n\nexport interface TimeSignature {\n  denominator: number;\n  numerator: EnabledDivisions[];\n}\n\nexport interface State {\n  bpm: number;\n  playing: boolean;\n  signature: TimeSignature;\n  activeDivisions: Array<ActiveDivisions>;\n}\n\nexport interface Metronome {\n  toggleStart: () => void;\n  start: (bpm?: number) => void;\n  stop: () => void;\n  setBPM: React.Dispatch<React.SetStateAction<number>>;\n  setSignature: React.Dispatch<React.SetStateAction<TimeSignature>>;\n  addBPM: (bpmToAdd: number) => void;\n  state: State;\n}\n","import React from \"react\";\n\ninterface Marking {\n  range: [number, number];\n  name: string;\n}\n\nexport const markings: Array<Marking> = [\n  { name: \"Larghissimo\", range: [0, 24] },\n  { name: \"Grave\", range: [25, 45] },\n  { name: \"Largo\", range: [40, 60] },\n  { name: \"Lento\", range: [45, 60] },\n  { name: \"Larghetto\", range: [60, 66] },\n  { name: \"Adagio\", range: [66, 76] },\n  { name: \"Andante\", range: [76, 108] },\n  { name: \"Marcia moderato\", range: [83, 85] },\n  { name: \"Andante moderato\", range: [92, 112] },\n  { name: \"Moderato\", range: [108, 120] },\n  { name: \"Allegro\", range: [120, 156] },\n  { name: \"Vivace\", range: [156, 176] },\n  { name: \"Vivacissimo\", range: [172, 176] },\n  { name: \"Allegrissimo\", range: [172, 176] },\n  { name: \"Presto\", range: [168, 200] },\n  { name: \"Prestissimo\", range: [200, 250] }\n];\n\nconst inRange = ([from, to]: [number, number], test: number) => {\n  return test >= from && test <= to;\n};\n\nconst fromBPM = (bpm: number): Array<Marking> => {\n  return markings.filter(({ range }) => inRange(range, bpm));\n};\n\ninterface Props {\n  bpm: number;\n}\n\nconst TempoMarking = ({ bpm }: Props) => {\n  const markings = fromBPM(bpm);\n  return (\n    <div style={{ minHeight: \"6.5em\" }}>\n      {markings.map(({ name, range }, idx) => (\n        <div key={idx} className=\"has-text-centered\">\n          {name} - {range[0]} - {range[1]}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default TempoMarking;\n","import {\n  useState,\n  Dispatch,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useRef\n} from \"react\";\nimport * as R from \"ramda\";\nimport * as d from \"deep-object-diff\";\nimport * as t from \"./types\";\nimport NoSleep from \"nosleep.js\";\n\nexport const useSleepLock = () => {\n  const [noSleep] = useState(new NoSleep());\n\n  const lock = useCallback(() => {\n    noSleep.enable();\n  }, [noSleep]);\n\n  const release = useCallback(() => {\n    noSleep.disable();\n  }, [noSleep]);\n\n  return {\n    lock,\n    release\n  };\n};\n\n// TODO - add in some logic to do simple migrations. Otherwise, we get stuck\n// with this state forever and have to blow it away.\nexport const useLocalStorage = <T>(\n  key: t.LocalStorageKey,\n  initialValue: T | (() => T),\n  override: boolean = false\n): [T, Dispatch<SetStateAction<T>>] => {\n  const [value, setValue] = useState(() => {\n    let firstValue;\n    const fromLocal = localStorage.getItem(key);\n    if (fromLocal !== null && fromLocal !== undefined && !override) {\n      firstValue = JSON.parse(fromLocal);\n    } else {\n      firstValue =\n        initialValue instanceof Function ? initialValue() : initialValue;\n    }\n    window.localStorage.setItem(key, JSON.stringify(firstValue));\n    return firstValue;\n  });\n\n  const setNewValue: Dispatch<SetStateAction<T>> = useCallback(\n    (valueAction: SetStateAction<T>) => {\n      setValue((oldValue: T) => {\n        const newValue =\n          valueAction instanceof Function ? valueAction(oldValue) : valueAction;\n        window.localStorage.setItem(key, JSON.stringify(newValue));\n        return newValue;\n      });\n    },\n    [key]\n  );\n\n  return [value, setNewValue];\n};\n\nexport const usePersistantToggle = (\n  key: t.LocalStorageKey,\n  initialValue: boolean\n): [boolean, () => void] => {\n  const [storageValue, setStorageValue] = useLocalStorage(key, initialValue);\n  const toggle = useCallback(() => {\n    setStorageValue(R.not);\n  }, [setStorageValue]);\n  return [storageValue, toggle];\n};\n\nexport const useToggle = (\n  initialValue: boolean,\n  sideEffect = (toggleState: boolean) => {}\n): [boolean, () => void] => {\n  const [value, setValue] = useState(initialValue);\n  const toggle = useCallback(\n    () =>\n      setValue((old: boolean) => {\n        const newValue = !old;\n        sideEffect(newValue);\n        return newValue;\n      }),\n    [sideEffect]\n  );\n  return [value, toggle];\n};\n\nexport const useAdvice = <T>(\n  [originalT, originalSetter]: [T, React.Dispatch<React.SetStateAction<T>>],\n  advice: (t: T) => T\n): [T, React.Dispatch<React.SetStateAction<T>>] => {\n  const newSetter = useCallback(\n    (action: React.SetStateAction<T>) => {\n      originalSetter(oldT =>\n        advice(action instanceof Function ? action(oldT) : action)\n      );\n    },\n    [advice, originalSetter]\n  );\n  useDetectChangedValue(advice, originalSetter);\n  return [originalT, newSetter];\n};\n\nexport const useDetectChangedValue = (...values: any[]) => {\n  const oldValues = useRef<any[]>(values);\n\n  useEffect(() => {\n    const lastValues = oldValues.current;\n    const newValues = values;\n    lastValues.forEach((lastValue: any, index: number) => {\n      const newValue = newValues[index];\n      if (newValue !== lastValue) {\n        const diff = d.detailedDiff(lastValue, newValue);\n        console.log(`Change at argument index: ${index}`, diff);\n      }\n    });\n    oldValues.current = values;\n  }, [values]);\n};\n\nexport const useAudioBuffer = (\n  audioContext: AudioContext | undefined,\n  url: string\n): AudioBuffer | undefined => {\n  const [buffer, updateBuffer] = useState<AudioBuffer>();\n  useEffect(() => {\n    if (audioContext !== undefined) {\n      fetch(url)\n        .then(response => response.arrayBuffer())\n        .then(buffer => audioContext.decodeAudioData(buffer))\n        .then(updateBuffer);\n    }\n  }, [url, audioContext]);\n  return buffer;\n};\n","import React, { useState, useEffect } from \"react\";\nimport * as R from \"ramda\";\n\nexport const maxWidth = \"40em\";\n\ninterface ButtonProps\n  extends React.DetailedHTMLProps<\n    React.ButtonHTMLAttributes<HTMLButtonElement>,\n    HTMLButtonElement\n  > {\n  primary?: true;\n  isPrimary?: true;\n  isLink?: true;\n  isInfo?: true;\n  isSuccess?: true;\n  isDanger?: true;\n  isOutlined?: true;\n  offIsPrimary?: true;\n  offIsLink?: true;\n  offIsInfo?: true;\n  offIsSuccess?: true;\n  offIsDanger?: true;\n  offIsOutlined?: true;\n  grow?: true;\n}\n\ninterface ToggleButtonProps extends ButtonProps {\n  on: boolean;\n}\n\nexport const ToggleButton = (props: ToggleButtonProps) => {\n  const [buttonProps, setButtonProps] = useState(props);\n  const { on, children, className = \"\" } = props;\n  useEffect(() => {\n    let newProps = props;\n    if (!props.on) {\n      newProps = R.dissoc(\"isPrimary\", newProps);\n      newProps = R.dissoc(\"isLink\", newProps);\n      newProps = R.dissoc(\"isDanger\", newProps);\n      newProps = R.dissoc(\"isInfo\", newProps);\n      newProps = R.dissoc(\"isSuccess\", newProps);\n    } else {\n      newProps = R.dissoc(\"offIsPrimary\", newProps);\n      newProps = R.dissoc(\"offIsLink\", newProps);\n      newProps = R.dissoc(\"offIsDanger\", newProps);\n      newProps = R.dissoc(\"offIsInfo\", newProps);\n      newProps = R.dissoc(\"offIsSuccess\", newProps);\n    }\n    setButtonProps(newProps);\n  }, [className, props]);\n  const { on: _1, ...renderProps } = buttonProps;\n  const child =\n    children instanceof Array && children.length === 2\n      ? on\n        ? children[0]\n        : children[1]\n      : children;\n  return <Button {...renderProps}>{child}</Button>;\n};\n\nexport const Button = ({\n  isPrimary,\n  isDanger,\n  isLink,\n  isInfo,\n  isSuccess,\n  isOutlined,\n  offIsPrimary,\n  offIsDanger,\n  offIsLink,\n  offIsInfo,\n  offIsSuccess,\n  offIsOutlined,\n  grow,\n  ...props\n}: ButtonProps) => {\n  const primary = isPrimary ? \"is-primary\" : \"\";\n  const link = isLink ? \"is-link\" : \"\";\n  const danger = isDanger ? \"is-danger\" : \"\";\n  const info = isInfo ? \"is-info\" : \"\";\n  const success = isSuccess ? \"is-success\" : \"\";\n  const outlined = isOutlined ? \"is-outlined\" : \"\";\n  const offprimary = offIsPrimary ? \"is-primary\" : \"\";\n  const offlink = offIsLink ? \"is-link\" : \"\";\n  const offdanger = offIsDanger ? \"is-danger\" : \"\";\n  const offinfo = offIsInfo ? \"is-info\" : \"\";\n  const offsuccess = offIsSuccess ? \"is-success\" : \"\";\n  const offoutlined = offIsOutlined ? \"is-outlined\" : \"\";\n  const propClassName = props.className ? props.className : \"\";\n\n  const className = `${propClassName} button ${primary} ${link} ${outlined} ${danger} ${info} ${success} ${offprimary} ${offdanger} ${offdanger} ${offinfo} ${offlink} ${offsuccess} ${offoutlined}`;\n\n  const style = grow ? { flexGrow: 1 } : {};\n\n  return (\n    <button style={style} {...{ ...props, className }}>\n      {props.children}\n    </button>\n  );\n};\n\ninterface ButtonsProps\n  extends React.DetailedHTMLProps<\n    React.HTMLAttributes<HTMLDivElement>,\n    HTMLDivElement\n  > {\n  classes?: string[];\n}\n\nexport const Buttons = ({ children, className, ...props }: ButtonsProps) => {\n  const classes = `${className} buttons has-addons}`;\n  const allProps = Object.assign(props, { className: classes });\n  return <div {...allProps}>{children}</div>;\n};\n","import React, { useState, useCallback, useEffect } from \"react\";\nimport * as R from \"ramda\";\nimport styled from \"styled-components\";\nimport { useLocalStorage } from \"./hooks\";\nimport { Button } from \"./Common\";\nimport * as t from \"./types\";\n\ninterface Props {\n  signature: t.TimeSignature;\n  setSignature: React.Dispatch<React.SetStateAction<t.TimeSignature>>;\n  playing: boolean;\n  activeBeats: t.ActiveDivisions[];\n}\n\nconst SigColumn = styled.div`\n  display: flex;\n  flex-grow: 1;\n`;\n\nconst SigColumns = styled.div`\n  display: flex;\n`;\n\nconst BeatColumnRow = ({\n  playing,\n  activeBeats,\n  beatIdx,\n  division,\n  divisionIdx,\n  enabledDivisions: beatDivisions\n}: {\n  division: string;\n  playing: boolean;\n  activeBeats: t.ActiveDivisions[];\n  divisionIdx: number;\n  beatIdx: number;\n  enabledDivisions: t.EnabledDivisions;\n}) => {\n  const divisions = parseInt(division, 10);\n  return (\n    <SigColumns key={`d${divisions}`}>\n      {R.range(0, divisions).map(idx => {\n        const bg =\n          playing &&\n          activeBeats[beatIdx] &&\n          activeBeats[beatIdx][divisions] === idx\n            ? beatIdx === 0\n              ? \"has-background-info\"\n              : \"has-background-primary\"\n            : \"has-background-light\";\n        const marginTop = divisions === 1 ? 0 : 5;\n        const marginLeft = idx === 0 ? 0 : 10 / divisions;\n        const marginRight = idx === divisions - 1 ? 0 : 10 / divisions;\n        return (\n          <SigColumn\n            key={`d${divisions}-${idx}`}\n            className={`${bg} has-text-centered`}\n            style={{\n              justifyContent: \"center\",\n              height:\n                70 /\n                  Object.keys(beatDivisions).filter(\n                    key => beatDivisions[key as any]\n                  ).length -\n                marginTop,\n              marginLeft,\n              marginRight,\n              marginTop\n            }}\n          >\n            {divisionIdx === 0 && beatIdx + 1}\n          </SigColumn>\n        );\n      })}\n    </SigColumns>\n  );\n};\n\nconst BeatColumn = (props: {\n  playing: boolean;\n  activeBeats: t.ActiveDivisions[];\n  beatIdx: number;\n  enabledDivisions: t.EnabledDivisions;\n}) => {\n  return (\n    <div className={`column has-text-centered`}>\n      {Object.keys(props.enabledDivisions)\n        .filter(key => props.enabledDivisions[key as any])\n        .map((division, divisionIdx) => (\n          <BeatColumnRow\n            key={`${props.beatIdx}-${divisionIdx}`}\n            {...{ ...props, division, divisionIdx }}\n          />\n        ))}\n    </div>\n  );\n};\n\nconst TimeSignature = ({\n  playing,\n  signature: { numerator },\n  setSignature,\n  activeBeats\n}: Props) => {\n  const [hasChanged, setHasChanged] = useState(false);\n  const [uIenabledDivisions, setUiEnabledDivisions] = useLocalStorage<\n    t.EnabledDivisions\n  >(t.LocalStorageKey.SignatureDivisions, { 1: true });\n  const setNumerator = useCallback(\n    (numerator: number) => {\n      setHasChanged(true);\n      setSignature(old => {\n        return R.assoc(\n          \"numerator\",\n          R.range(0, numerator).map(() => uIenabledDivisions),\n          old\n        );\n      });\n    },\n    [uIenabledDivisions, setSignature]\n  );\n\n  useEffect(() => {\n    if (hasChanged) {\n      setSignature(old => ({\n        ...old,\n        numerator: R.range(0, old.numerator.length).map(\n          () => uIenabledDivisions\n        )\n      }));\n    }\n  }, [uIenabledDivisions, hasChanged, setSignature]);\n\n  const toggleDivisionOption = useCallback(\n    (divisionOption: t.Division) => {\n      setHasChanged(true);\n      setUiEnabledDivisions(old =>\n        R.over(R.lensPath([divisionOption]), R.not, old)\n      );\n    },\n    [setUiEnabledDivisions]\n  );\n\n  const clearDivisions = useCallback(() => {\n    setUiEnabledDivisions({ 1: true });\n  }, [setUiEnabledDivisions]);\n\n  // TODO - make it where clicking on a division group lets you set the volume & accents for that group.\n  // TODO - add an option to turn on or off the accent at the start of every measure.\n  // TODO - clean up these buttons to not use className.\n  return (\n    <>\n      <h3\n        className=\"subtitle is-5\"\n        style={{ paddingLeft: \"10px\", marginBottom: \"0\" }}\n      >\n        Divisions\n      </h3>\n      <section\n        style={{ marginTop: \"10px\" }}\n        className=\"section buttons is-centered\"\n      >\n        {([2, 3, 4, 5, 6] as t.Division[]).map((num: t.Division) => {\n          const isPrimary = uIenabledDivisions[num] || undefined;\n          return (\n            <Button\n              grow\n              isPrimary={isPrimary}\n              key={`division-options-${num}`}\n              onClick={() => toggleDivisionOption(num)}\n            >\n              {num}\n            </Button>\n          );\n        })}\n        <Button grow isDanger isOutlined onClick={clearDivisions}>\n          Clear\n        </Button>\n      </section>\n      <section className=\"section is-mobile columns\">\n        {numerator.map(\n          (enabledDivisions: t.EnabledDivisions, beatIdx: number) => (\n            <BeatColumn\n              key={`${beatIdx}-enabledDivisionColumn`}\n              {...{ playing, beatIdx, enabledDivisions, activeBeats }}\n            />\n          )\n        )}\n      </section>\n      <section className=\"section buttons is-centered\">\n        {[1, 2, 3, 4, 5].map(num => {\n          const on = numerator.length === num || undefined;\n          return (\n            <Button\n              key={`numerator-button-${num}`}\n              isPrimary={on}\n              grow\n              onClick={on ? () => {} : () => setNumerator(num)}\n            >\n              {num}/4\n            </Button>\n          );\n        })}\n      </section>\n    </>\n  );\n};\n\nexport default TimeSignature;\n","export function assertNever(value: never): never {\n  throw new Error(\n    `Unhandled discriminated union member: ${JSON.stringify(value)}`\n  );\n}\n\nexport const runAtTime = (\n  audioContext: AudioContext,\n  timeToRun: number,\n  callback: () => void\n) => {\n  const now = audioContext.currentTime;\n  if (timeToRun <= now) {\n    callback();\n  } else {\n    const sleepTime = ((timeToRun - now) / 2) * 1000;\n    setTimeout(() => runAtTime(audioContext, timeToRun, callback), sleepTime);\n  }\n};\n","import { useEffect, useState, useCallback, useRef } from \"react\";\nimport * as R from \"ramda\";\nimport * as t from \"./types\";\nimport { useLocalStorage, useAdvice, useAudioBuffer } from \"./hooks\";\nimport Deque from \"double-ended-queue\";\nimport { runAtTime } from \"./util\";\nconst click = require(\"./click.wav\");\n\nconst scheduleNote = (\n  audioContext: AudioContext,\n  { time, gain, buffer, pitch, currentBeat, divisionIndex }: t.Beat\n) => {\n  const isOne = currentBeat === 0 && divisionIndex === 0;\n  const sound = audioContext.createBufferSource();\n  sound.buffer = buffer;\n  sound.detune.value = isOne ? 0 : -pitch;\n\n  const volume = audioContext.createGain();\n  volume.gain.value = isOne ? 1.0 : gain;\n\n  sound.connect(volume);\n  volume.connect(audioContext.destination);\n  sound.start(time);\n};\n\nconst beatsFor = (\n  startOfBeatTime: number,\n  secondsPerBeat: number,\n  divisions: t.EnabledDivisions,\n  buffer: AudioBuffer,\n  currentBeat: number\n): Array<t.Beat> => {\n  const beats = [];\n  for (const key in divisions) {\n    if (divisions[key]) {\n      let divisionOption = parseInt(key, 10) as t.Division;\n      const noteOffset = secondsPerBeat / divisionOption;\n      for (\n        let divisionIndex = 0;\n        divisionIndex < divisionOption;\n        divisionIndex++\n      ) {\n        const time = startOfBeatTime + divisionIndex * noteOffset;\n        const beat: t.Beat = {\n          time,\n          pitch: 220,\n          gain: 1.0 * 0.5,\n          buffer,\n          divisions: divisionOption,\n          divisionIndex,\n          currentBeat\n        };\n        beats.push(beat);\n      }\n    }\n  }\n  beats.sort((a, b) => a.time - b.time);\n  return beats;\n};\n\nconst playBeatsTill = (\n  beatsQueue: Deque<t.Beat>,\n  intervalLength: number,\n  audioContext: AudioContext,\n  updateUi: (audioContext: AudioContext, beat: t.Beat) => void\n) => {\n  const now = audioContext.currentTime;\n  const scheduleTil = now + intervalLength + intervalError;\n  while (beatsQueue.peekFront() && beatsQueue.peekFront()!.time < scheduleTil) {\n    const first = beatsQueue.shift()!;\n    if (first.divisionIndex !== 0 || first.divisions === 1) {\n      scheduleNote(audioContext, first);\n    }\n    updateUi(audioContext, first);\n  }\n};\n\n// TODO - I should clean this up if possible. It takes way too many arguments.\nconst addBeatsToQueue = (\n  state: t.State,\n  nextNoteTime: React.MutableRefObject<number>,\n  currentBeat: t.EnabledDivisions,\n  beatIdx: number,\n  currentTime: number,\n  scheduleAhead: number,\n  buffer: AudioBuffer,\n  beatsQueue: Deque<t.Beat>,\n  nextBeat: () => void\n) => {\n  const { bpm } = state;\n  const secondsPerBeat = 60.0 / bpm;\n  const divisions = currentBeat;\n  if (nextNoteTime.current < currentTime + scheduleAhead) {\n    const beatsForNextMeasure = beatsFor(\n      nextNoteTime.current,\n      secondsPerBeat,\n      divisions,\n      buffer,\n      beatIdx\n    );\n    beatsQueue.push(...beatsForNextMeasure);\n    nextNoteTime.current += secondsPerBeat;\n    nextBeat();\n  }\n};\n\nconst intervalError = 0.1;\n\nconst useScheduleAhead = (\n  audioContext: AudioContext | undefined,\n  state: t.State,\n  setActiveDivisions: React.Dispatch<React.SetStateAction<t.ActiveDivisions[]>>\n) => {\n  const scheduleAhead = 0.3;\n  const { playing } = state;\n  const buffer = useAudioBuffer(audioContext, click);\n  const nextNoteTimeRef = useRef<number>(0);\n  const delay = playing ? (scheduleAhead * 1000) / 2 : undefined;\n\n  const stateRef = useRef<t.State>(state);\n  useEffect(() => {\n    stateRef.current = state;\n  }, [state]);\n\n  const [beatToSchedule, setBeatToSchedule] = useState<number>(0);\n  useEffect(() => {\n    if (!state.playing) {\n      setBeatToSchedule(0);\n    }\n  }, [state.playing]);\n\n  const beatToScheduleRef = useRef(beatToSchedule);\n  useEffect(() => {\n    beatToScheduleRef.current = beatToSchedule;\n  }, [beatToSchedule]);\n\n  const nextBeat = () => {\n    setBeatToSchedule(\n      old => (old + 1) % stateRef.current.signature.numerator.length\n    );\n  };\n\n  // TODO - this is super janky.\n  // TODO - this would be much nicer with an animation.\n  const setActiveBeat = useCallback(\n    (beat: t.Beat) => {\n      setActiveDivisions(oldBeats => {\n        const withNewBeat = R.adjust(\n          beat.currentBeat,\n          (activeBeat: t.ActiveDivisions) => {\n            return { ...activeBeat, [beat.divisions]: beat.divisionIndex };\n          },\n          oldBeats\n        );\n        let lastBeatIdx = beat.currentBeat - 1;\n        if (lastBeatIdx < 0) {\n          if (oldBeats.length === 1) {\n            return withNewBeat;\n          }\n          lastBeatIdx = stateRef.current.signature.numerator.length - 1;\n        }\n        return R.adjust(\n          lastBeatIdx,\n          (activeBeat: t.ActiveDivisions) => {\n            return Object.keys(activeBeat).reduce(\n              (acc, key) => ({ ...acc, [key]: undefined }),\n              {}\n            );\n          },\n          withNewBeat\n        );\n      });\n    },\n    [setActiveDivisions]\n  );\n\n  // TODO - because the ui callbacks run in the future, I can get in a weird\n  // spot state-wise. I should figure out a way to either cancel them running\n  // when the number of divisions changes.\n  const updateUi = useCallback(\n    (audioContext: AudioContext, beat: t.Beat) => {\n      // We ovewrite activeBeats here because it's definitely changing.\n      runAtTime(audioContext, beat.time, () => {\n        if (stateRef.current.playing) {\n          setActiveBeat(beat);\n        }\n      });\n    },\n    [setActiveBeat]\n  );\n\n  useEffect(() => {\n    if (\n      delay !== undefined &&\n      audioContext !== undefined &&\n      buffer !== undefined\n    ) {\n      const beatsQueue = new Deque<t.Beat>();\n      const firstClickTime = audioContext.currentTime + 0.3;\n      nextNoteTimeRef.current = firstClickTime;\n      const tick = () => {\n        const {\n          signature: { numerator }\n        } = stateRef.current;\n        const beatIdx = Math.min(\n          beatToScheduleRef.current,\n          numerator.length - 1\n        );\n        const currentBeat = numerator[beatIdx];\n        addBeatsToQueue(\n          stateRef.current,\n          nextNoteTimeRef,\n          currentBeat,\n          beatToScheduleRef.current,\n          audioContext.currentTime,\n          scheduleAhead,\n          buffer,\n          beatsQueue,\n          nextBeat\n        );\n        playBeatsTill(beatsQueue, delay / 1000, audioContext, updateUi);\n      };\n      tick();\n      const id = setInterval(tick, delay);\n      return () => {\n        clearInterval(id);\n      };\n    }\n  }, [\n    delay,\n    buffer,\n    audioContext,\n    setActiveDivisions,\n    setActiveBeat,\n    updateUi\n  ]);\n};\n\nconst resetActiveBeats = (beats: t.EnabledDivisions[]): t.ActiveDivisions[] =>\n  beats.map((enabledDivisions: t.EnabledDivisions) =>\n    R.mapObjIndexed(() => undefined, enabledDivisions)\n  );\n\nconst clampBPM = (bpm: number) => R.clamp(10, 250, bpm);\n\nexport const useMetronome = (\n  audioContext: AudioContext | undefined\n): t.Metronome => {\n  const [playing, setPlaying] = useState(false);\n  const [bpm, setBPM] = useAdvice(\n    useLocalStorage(t.LocalStorageKey.BPM, 90),\n    clampBPM\n  );\n  const [signature, setSignature] = useLocalStorage<t.TimeSignature>(\n    t.LocalStorageKey.TimeSignature,\n    {\n      denominator: 4,\n      numerator: [{ 1: true }, { 1: true }, { 1: true }]\n    }\n  );\n  const [activeDivisions, setActiveDivisions] = useLocalStorage<\n    t.ActiveDivisions[]\n  >(t.LocalStorageKey.ActiveBeats, resetActiveBeats(signature.numerator));\n\n  const state: t.State = {\n    bpm,\n    playing,\n    signature,\n    activeDivisions\n  };\n  const { numerator } = signature;\n\n  const bpmRef = useRef(bpm);\n  useEffect(() => {\n    bpmRef.current = bpm;\n  }, [bpm]);\n\n  // Effects for updating state.\n\n  // If the time signature changes, we need to reset the active subdivisions.\n  useEffect(() => {\n    // TODO - This would be fancier if when the next beat can still happen, it\n    // didn't clear the active beat in the UI.\n    setActiveDivisions(resetActiveBeats(numerator));\n  }, [numerator, signature, setActiveDivisions]);\n\n  useEffect(() => {\n    if (!playing) {\n      setActiveDivisions(resetActiveBeats(numerator));\n      setTimeout(() => {\n        setActiveDivisions(resetActiveBeats(numerator));\n      }, 300);\n    }\n  }, [playing, numerator, setActiveDivisions]);\n\n  useScheduleAhead(audioContext, state, setActiveDivisions);\n\n  // External API Things.\n  const addBPM = (bpmToAdd: number) => {\n    setBPM(R.add(bpmToAdd));\n  };\n\n  const toggleStart = () => setPlaying(R.not);\n\n  const start = useCallback(\n    (bpm?: number) => {\n      if (bpm !== undefined) {\n        setBPM(bpm);\n      }\n      setPlaying(true);\n    },\n    [setPlaying, setBPM]\n  );\n\n  const stop = useCallback(() => {\n    setPlaying(false);\n  }, [setPlaying]);\n\n  return {\n    toggleStart,\n    setSignature,\n    start,\n    stop,\n    setBPM,\n    addBPM,\n    state\n  };\n};\n","import React, { useState } from \"react\";\nimport * as R from \"ramda\";\nimport { Button } from \"./Common\";\n\ninterface Props {\n  setBPM: (bpm: number) => void;\n}\n\nconst calculateBPM = R.pipe(\n  (tapTimes: number[]) => R.aperture(2, tapTimes),\n  R.map(([a, b]) => b - a),\n  R.mean,\n  R.divide(60000),\n  Math.trunc\n);\n\nconst TapIn = ({ setBPM }: Props) => {\n  const [taps, setTaps] = useState<number[]>([]);\n\n  const onTap = () => {\n    const now = performance.now();\n    const newTaps = R.append(now, taps).filter(tap => now - tap < 3000);\n    if (newTaps.length > 1) {\n      const bpm = calculateBPM(newTaps);\n      setBPM(bpm);\n    }\n    setTaps(newTaps);\n  };\n\n  return (\n    <Button isLink onClick={onTap}>\n      Tap In\n    </Button>\n  );\n};\n\nexport default TapIn;\n","import React, { useEffect, useState, useLayoutEffect } from \"react\";\nimport { useToggle } from \"./hooks\";\nimport { ToggleButton, Buttons } from \"./Common\";\nimport styled from \"styled-components\";\n\nconst noteIdx: { [note: number]: string } = {\n  0: \"A\",\n  1: \"Bb\",\n  2: \"B\",\n  3: \"C\",\n  4: \"Db\",\n  5: \"D\",\n  6: \"Eb\",\n  7: \"E\",\n  8: \"F\",\n  9: \"Gb\",\n  10: \"G\",\n  11: \"Ab\"\n};\n\nconst A4 = 440;\nconst notes: Array<{\n  octave: number;\n  note: string;\n  frequency: number;\n  centsPerOctave: number;\n}> = [];\nfor (let i = -4; i < 4; i++) {\n  for (let j = 0; j < 12; j++) {\n    const base = A4 * Math.pow(2, i);\n    const centsPerOctave = base / 1200;\n    const frequency = base * Math.pow(2, j / 12);\n    const octave = i + 4;\n    const note = noteIdx[j];\n    notes.push({ octave, note, frequency, centsPerOctave });\n  }\n}\n\nconst freqToPitch = (freq: number) => {\n  let low = 0;\n  for (let i = 0; i < notes.length; i++) {\n    let note = notes[i];\n    if (note.frequency >= freq) {\n      low = i;\n      break;\n    }\n  }\n  const high = low + 1;\n  const lowPitch = notes[low];\n  const highPitch = notes[high];\n  const average = (lowPitch.frequency + highPitch.frequency) / 2;\n  let note = notes[high];\n  let difference = note.frequency - freq;\n  if (freq < average) {\n    note = notes[low];\n  }\n  const cents = note.centsPerOctave * difference;\n  return Object.assign(note, { originalFrequency: freq, difference, cents });\n};\n\nconst Tuner = () => {\n  const [on, toggleOn] = useToggle(false);\n  const [analyser, setAnalyser] = useState<AnalyserNode>();\n  const [sampleRate, setSampleRate] = useState<number>();\n  const [freq, setFreq] = useState<number>(440);\n  const [audioContext, setAudioContext] = useState<AudioContext>();\n\n  // Initailize the AudioContext when user turns on the tuner.\n  useEffect(() => {\n    if (!audioContext) {\n      setAudioContext(new AudioContext());\n    }\n  }, [on, audioContext]);\n\n  // Prompt for microphone when user turns on the tuner.\n  useEffect(() => {\n    if (on && audioContext) {\n      setSampleRate(audioContext.sampleRate);\n      const mediaDevices = navigator.mediaDevices;\n      if (mediaDevices) {\n        let mediaStream: MediaStream;\n        mediaDevices.getUserMedia({ audio: true }).then((ms: MediaStream) => {\n          mediaStream = ms;\n          const analyser = audioContext.createAnalyser();\n          // If this isn't big, I don't have very good frequency accuracy, and I\n          // can't change the sample rate because web audio sucks.\n          analyser.fftSize = 8192;\n          const mic = audioContext.createMediaStreamSource(ms);\n          mic.connect(analyser);\n          setAnalyser(analyser);\n        });\n        return () => {\n          mediaStream.getAudioTracks().forEach(track => track.stop());\n        };\n      }\n    }\n  }, [on, audioContext]);\n\n  useEffect(() => {\n    if (on && analyser && sampleRate) {\n      const tick = () => {\n        const bufferLength = analyser.frequencyBinCount;\n        const dataArray = new Float32Array(bufferLength);\n        analyser.getFloatFrequencyData(dataArray);\n        const [, maxIdx] = dataArray.reduce(\n          (a, b, i) => (a[0] < b ? [b, i] : a),\n          [-Infinity, -1]\n        );\n        const resolution = sampleRate / analyser.fftSize;\n        const freq = resolution * maxIdx;\n        setFreq(freq);\n      };\n      tick();\n      let interval = setInterval(tick, 50);\n\n      return () => {\n        clearInterval(interval);\n      };\n    }\n  }, [on, analyser, sampleRate]);\n\n  const { octave, note, cents } = freqToPitch(freq || 0);\n  // TODO - add in a graph of the FFT that's label with pitches and neato log bars.\n  return (\n    <TunerWrapper className=\"box has-text-centered\">\n      <div className=\"is-size-1\">{on ? note + octave : \"Stopped\"}</div>\n\n      <div>\n        {on ? (\n          <>\n            {cents.toFixed(2)} Cents {cents < 0 ? \"flat\" : \"sharp\"}\n          </>\n        ) : (\n          \"press start to tune\"\n        )}\n      </div>\n      <Buttons className=\"is-right\">\n        <ToggleButton on={on} isDanger offIsPrimary onClick={toggleOn}>\n          <>Stop</>\n          <>Start</>\n        </ToggleButton>\n      </Buttons>\n    </TunerWrapper>\n  );\n};\n\nconst TunerWrapper = styled.section`\n  margin-top: 10px;\n`;\n\nexport default Tuner;\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useLocalStorage } from \"./hooks\";\nimport styled from \"styled-components\";\nimport * as t from \"./types\";\n\nconst Outer = styled.div`\n  margin: auto;\n  position: relative;\n  height: 300px;\n  width: 300px;\n  border-radius: 300px;\n  display: flex;\n  margin-bottom: 10px;\n`;\n\nconst Inner = styled.div`\n  width: 100px;\n  height: 100px;\n  border-radius: 100px;\n  position: absolute;\n  touch-action: none;\n`;\n\ninterface Props {\n  initialValue: number;\n  addDiff: (diff: number) => void;\n  size?: number;\n}\n\nconst InfiniKnob = ({\n  size = 300,\n  initialValue,\n  addDiff,\n  children\n}: React.PropsWithChildren<Props>) => {\n  const [radians, setRadians] = useLocalStorage(\n    t.LocalStorageKey.Radians,\n    (initialValue * (Math.PI * 3)) / 2\n  );\n  const radiansRef = useRef(Math.PI);\n  useEffect(() => {\n    radiansRef.current = radians;\n  }, [radians]);\n\n  const [mouseDown, setMouseDown] = useState(false);\n  const mouseDownRef = useRef(false);\n  useEffect(() => {\n    mouseDownRef.current = mouseDown;\n  }, [mouseDown]);\n\n  const [totalDiff, setTotalDiff] = useState(0);\n  const totalDiffRef = useRef(0);\n  useEffect(() => {\n    totalDiffRef.current = totalDiff;\n  }, [totalDiff]);\n\n  const knobContainer = useRef<HTMLDivElement>(null);\n\n  const onMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\n    setMouseDown(true);\n    e.preventDefault();\n  };\n\n  const onMouseUp = useCallback((_: MouseEvent) => {\n    setMouseDown(false);\n  }, []);\n\n  const addToBuffer = useCallback(\n    (diff: number) => {\n      const threshold = 0.2;\n      if (Math.abs(totalDiffRef.current) < threshold) {\n        setTotalDiff(oldDiff => oldDiff + diff);\n      } else {\n        addDiff(totalDiffRef.current > 0 ? -1 : 1);\n        setTotalDiff(0);\n      }\n    },\n    [addDiff]\n  );\n\n  const moveKnob = useCallback(\n    (e: React.Touch | React.MouseEvent | MouseEvent) => {\n      const { clientX, clientY } = e;\n      const box = knobContainer.current!.getBoundingClientRect();\n\n      const boxCenter = {\n        x: box.left + box.width / 2,\n        y: box.top + box.height / 2\n      };\n      const y = -(boxCenter.y - clientY);\n      const x = -(boxCenter.x - clientX);\n      const newRadians = Math.atan2(y, x);\n      let diff = radiansRef.current - newRadians;\n      if (diff < -Math.PI) {\n        diff = -radiansRef.current - newRadians;\n      } else if (diff > Math.PI) {\n        diff = radiansRef.current - -newRadians;\n      }\n      if (diff !== 0) {\n        addToBuffer(diff);\n      }\n      const same = newRadians === radiansRef.current;\n      if (!same) {\n        setRadians(newRadians);\n      }\n    },\n    [addToBuffer, setRadians]\n  );\n\n  const onMouseMove = useCallback(\n    (e: React.MouseEvent<HTMLDivElement> | MouseEvent) => {\n      if (mouseDownRef.current) {\n        moveKnob(e);\n      }\n    },\n    [moveKnob]\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"mouseup\", onMouseUp);\n    window.addEventListener(\"mousemove\", onMouseMove);\n    return () => {\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n    };\n  }, [onMouseMove, onMouseUp]);\n\n  const onTouchMove = (e: React.TouchEvent<HTMLDivElement>) => {\n    const t = e.changedTouches;\n    const t0 = t[0];\n    moveKnob(t0);\n  };\n\n  const top =\n    size / 2 +\n    Math.sin(radians) * (size / 4) +\n    (Math.sin(radians) * size) / 16 -\n    size / 6;\n  const left =\n    size / 2 +\n    Math.cos(radians) * (size / 4) +\n    (Math.cos(radians) * size) / 16 -\n    size / 6;\n\n  return (\n    <Outer ref={knobContainer} className=\"has-background-primary\">\n      <Inner\n        className=\"has-background-info\"\n        onMouseDown={onMouseDown}\n        onTouchMove={onTouchMove}\n        style={{\n          top,\n          left\n        }}\n      />\n      <ChildContainer>{children}</ChildContainer>\n    </Outer>\n  );\n};\n\nconst ChildContainer = styled.div`\n  align-self: center;\n  margin: auto;\n  z-index: 1;\n  pointer-events: none;\n`;\n\nexport default InfiniKnob;\n","import React, { useEffect, useState } from \"react\";\n\nimport { useLocalStorage, usePersistantToggle } from \"./hooks\";\nimport * as R from \"ramda\";\nimport { Button, Buttons, ToggleButton } from \"./Common\";\nimport { Scale, Mode, ScalesDB, ScaleKey, scaleKeys } from \"./types\";\nimport * as t from \"./types\";\n\nenum ScaleMode {\n  NOT_STARTED = \"Not Started\",\n  LEARNING = \"Learning\",\n  KNOWN = \"Known\"\n}\n\ninterface Props {\n  startMetronome: (bpm: number) => void;\n  stopMetronome: () => void;\n}\n\nconst getScaleByFilter = (\n  scalesDB: ScalesDB,\n  filter: (s: Scale) => boolean\n): Scale | undefined => {\n  return getScalesByFilter(scalesDB, filter)[0];\n};\n\nconst getScalesByFilter = (\n  scalesDB: ScalesDB,\n  filter: (s: Scale) => boolean\n) => {\n  let scales: Scale[] = [];\n  Object.entries(scalesDB).forEach(([, lilMap]) => {\n    Object.entries(lilMap).forEach(([, scale]) => {\n      if (filter(scale)) {\n        scales.push(scale);\n      }\n    });\n  });\n  return scales;\n};\n\nconst initScalesDB = (): ScalesDB => {\n  const scalesDB: ScalesDB = {};\n  const scaleFor = (scaleKey: ScaleKey): Scale => ({\n    scaleKey,\n    pitch: scaleKey[0],\n    mode: scaleKey[1],\n    known: false,\n    learning: false,\n    bpm: 60\n  });\n\n  const addScale = (key: ScaleKey): void => {\n    const [pitch, mode] = key;\n    let pitchMap = scalesDB[pitch];\n    if (pitchMap === undefined) {\n      pitchMap = {};\n      scalesDB[pitch] = pitchMap;\n    }\n    pitchMap[mode] = scaleFor(key);\n  };\n  // TODO(me) - clean up scale names & add sharps.\n  // Major\n  for (const key of scaleKeys) {\n    addScale(key);\n  }\n  return scalesDB;\n};\n\nconst ScalesGroup = ({\n  scaleKey: [pitch, mode],\n  learning,\n  known,\n  toggleLearning,\n  toggleKnown\n}: Scale & { toggleLearning: () => void; toggleKnown: () => void }) => {\n  return (\n    <div className=\"is-grouped field has-addons\">\n      <div className=\"is-size-5 control is-expanded\">\n        {pitch} {mode}\n      </div>\n      <Buttons>\n        <ToggleButton on={known} isInfo onClick={toggleKnown}>\n          Known\n        </ToggleButton>\n        <ToggleButton on={learning} isLink onClick={toggleLearning}>\n          Learning\n        </ToggleButton>\n      </Buttons>\n    </div>\n  );\n};\nfunction shuffle<T>(a: Array<T>) {\n  var j, x, i;\n  for (i = a.length - 1; i > 0; i--) {\n    j = Math.floor(Math.random() * (i + 1));\n    x = a[i];\n    a[i] = a[j];\n    a[j] = x;\n  }\n  return a;\n}\n\ninterface LearnScalesProps {\n  scalesDB: ScalesDB;\n  addBPM: (s: Scale, n: number) => () => void;\n  startMetronome: (bpm: number) => void;\n  reset: () => void;\n  scaleMode: ScaleMode;\n}\n\nconst LearnScales = ({\n  scalesDB,\n  addBPM,\n  reset,\n  scaleMode,\n  startMetronome\n}: LearnScalesProps) => {\n  const [scaleKeys, setScales] = useState<Array<ScaleKey>>(() =>\n    shuffle(\n      getScalesByFilter(scalesDB, s => {\n        if (scaleMode === ScaleMode.LEARNING) {\n          return s.learning;\n        } else if (scaleMode === ScaleMode.KNOWN) {\n          return s.known;\n        }\n        return false;\n      }).map(({ scaleKey }) => scaleKey)\n    )\n  );\n  const nextScale = () => {\n    setScales(old => {\n      const nu = old.slice(1);\n      if (nu.length === 0) {\n        reset();\n      }\n      return nu;\n    });\n  };\n\n  const currentKey = scaleKeys[0] || [];\n  const maybeScale = getScaleByFilter(\n    scalesDB,\n    (s: Scale) => s.mode === currentKey[1] && s.pitch === currentKey[0]\n  );\n  useEffect(() => {\n    if (maybeScale !== undefined) {\n      startMetronome(maybeScale.bpm);\n    }\n  }, [maybeScale, startMetronome]);\n  const nextScaleText = scaleKeys.length > 1 ? \"Next Scale\" : \"Finish\";\n\n  // TODO - this error handling makes me sad, I should really do better.\n  if (scaleKeys.length === 0) {\n    return <div>No more scales</div>;\n  }\n  const scale = maybeScale!;\n  const { mode, pitch, bpm } = scale!;\n\n  return (\n    <div>\n      <div\n        style={{ alignSelf: \"center\", fontWeight: \"bold\" }}\n        className=\"control is-expanded is-size-5\"\n      >\n        {scaleMode}\n      </div>\n      <div style={{ display: \"flex\", marginBottom: \"5px\" }}>\n        <div style={{ alignSelf: \"center\", marginRight: \"10px\" }}>\n          {pitch} {mode} @ {bpm}bpm\n        </div>\n        <Buttons style={{ flexGrow: 1 }}>\n          <Button isDanger isOutlined grow onClick={addBPM(scale, -10)}>\n            -10\n          </Button>\n          <Button isDanger isOutlined grow onClick={addBPM(scale, -1)}>\n            -\n          </Button>\n          <Button isPrimary isOutlined grow onClick={addBPM(scale, 1)}>\n            +\n          </Button>\n          <Button isPrimary isOutlined grow onClick={addBPM(scale, 10)}>\n            +10\n          </Button>\n        </Buttons>\n      </div>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n        <Button isDanger isOutlined onClick={reset}>\n          Stop\n        </Button>\n        <Button isPrimary onClick={nextScale}>\n          {nextScaleText}\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nconst Scales = ({ startMetronome, stopMetronome }: Props) => {\n  // TODO - Add a button to start learning a new scale. This will be a scale\n  // that is know known and is not learning.\n  const [scalesDB, setScalesDB] = useLocalStorage(\n    t.LocalStorageKey.ScalesDB,\n    initScalesDB\n  );\n\n  const [scaleMode, setScaleMode] = useState(ScaleMode.NOT_STARTED);\n\n  useEffect(() => {\n    if (scaleMode === ScaleMode.NOT_STARTED) {\n      stopMetronome();\n    }\n  }, [scaleMode, stopMetronome]);\n\n  const toggleLearning = ({ pitch, mode }: Scale) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"learning\"]), R.not));\n  };\n\n  const toggleKnown = ({ pitch, mode }: Scale) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"known\"]), R.not));\n  };\n\n  const [showKnown, toggleShowKnown] = usePersistantToggle(\n    t.LocalStorageKey.ShowKnown,\n    false\n  );\n\n  const addBPM = ({ pitch, mode }: Scale, n: number) => () => {\n    setScalesDB(R.over(R.lensPath([pitch, mode, \"bpm\"]), R.add(n)));\n  };\n\n  return (\n    <div className=\"box\" style={{ marginTop: \"10px\" }}>\n      {scaleMode === ScaleMode.NOT_STARTED ? (\n        <div style={{ marginBottom: \"5px\" }}>\n          <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n            <div\n              style={{ alignSelf: \"center\", fontWeight: \"bold\" }}\n              className=\"control is-expanded is-size-5\"\n            >\n              Scales\n            </div>\n            <Buttons>\n              <Button\n                onClick={() => setScaleMode(ScaleMode.KNOWN)}\n                disabled={\n                  getScaleByFilter(scalesDB, s => s.known) === undefined\n                }\n                className=\"is-info is-outlined\"\n              >\n                Start Known\n              </Button>\n              <Button\n                onClick={() => setScaleMode(ScaleMode.LEARNING)}\n                disabled={\n                  getScaleByFilter(scalesDB, s => s.learning) === undefined\n                }\n                className=\"is-link is-outlined\"\n              >\n                Start Learning\n              </Button>\n            </Buttons>\n          </div>\n          <hr />\n\n          <Buttons>\n            <Button\n              onClick={toggleShowKnown}\n              className={`${\n                showKnown ? \"is-primary is-outlined\" : \"is-danger\"\n              }`}\n            >\n              {showKnown ? \"Hide Known\" : \"Show Known\"}\n            </Button>\n          </Buttons>\n          {getScalesByFilter(\n            scalesDB,\n            s => s.mode === Mode.Major && (showKnown ? true : s.known === false)\n          ).map((scale: Scale) => (\n            <ScalesGroup\n              key={`${scale.pitch}-${scale.mode}`}\n              {...scale}\n              toggleLearning={toggleLearning(scale)}\n              toggleKnown={toggleKnown(scale)}\n            />\n          ))}\n          <hr />\n          {getScalesByFilter(\n            scalesDB,\n            s => s.mode === Mode.Minor && (showKnown ? true : s.known === false)\n          ).map((scale: Scale) => (\n            <ScalesGroup\n              key={`${scale.pitch}-${scale.mode}`}\n              {...scale}\n              toggleLearning={toggleLearning(scale)}\n              toggleKnown={toggleKnown(scale)}\n            />\n          ))}\n        </div>\n      ) : (\n        <LearnScales\n          scaleMode={scaleMode}\n          startMetronome={startMetronome}\n          addBPM={addBPM}\n          scalesDB={scalesDB}\n          reset={() => setScaleMode(ScaleMode.NOT_STARTED)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Scales;\n","import React, { useEffect } from \"react\";\nimport { useState } from \"react\";\nimport styled from \"styled-components\";\nimport TempoMarking from \"./TempoMarking\";\nimport TimeSignature from \"./TimeSignature\";\nimport { useMetronome } from \"./metronome\";\nimport TapIn from \"./TapIn\";\nimport Tuner from \"./Tuner\";\nimport Dial from \"./Dial\";\nimport Scales from \"./Scales\";\nimport { usePersistantToggle, useSleepLock } from \"./hooks\";\nimport { Buttons, ToggleButton } from \"./Common\";\nimport * as t from \"./types\";\n\nconst TopSettings = styled.section`\n  display: flex;\n`;\n\nexport default () => {\n  const [audioContext, setAudioContext] = useState<AudioContext | undefined>();\n  const [wakeLock, toggleWakeLock] = usePersistantToggle(\n    t.LocalStorageKey.WakeLock,\n    false\n  );\n  const [showScales, toggleScales] = usePersistantToggle(\n    t.LocalStorageKey.ShowScales,\n    false\n  );\n  const [showTuner, toggleTuner] = usePersistantToggle(\n    t.LocalStorageKey.ShowTuner,\n    false\n  );\n  const [showDial, toggleDial] = usePersistantToggle(\n    t.LocalStorageKey.ShowDial,\n    true\n  );\n  const { lock, release } = useSleepLock();\n  const {\n    state: { playing, signature, bpm, activeDivisions },\n    start,\n    stop,\n    toggleStart,\n    setSignature,\n    setBPM,\n    addBPM\n  } = useMetronome(audioContext);\n\n  useEffect(() => {\n    if (wakeLock && playing) {\n      lock();\n    } else {\n      release();\n    }\n  }, [playing, wakeLock, lock, release]);\n\n  // Initialize AudioContext as a singleton on first start.\n  useEffect(() => {\n    if (playing && audioContext === undefined) {\n      setAudioContext(new AudioContext());\n    }\n  }, [playing, audioContext]);\n\n  return (\n    <InnerBody>\n      <TopSettings className=\"buttons\">\n        <ToggleButton grow isPrimary on={wakeLock} onClick={toggleWakeLock}>\n          Keep Awake\n        </ToggleButton>\n        <ToggleButton grow isPrimary on={showDial} onClick={toggleDial}>\n          Dial\n        </ToggleButton>\n        <ToggleButton grow isPrimary on={showScales} onClick={toggleScales}>\n          Scales\n        </ToggleButton>\n        <ToggleButton grow isPrimary on={showTuner} onClick={toggleTuner}>\n          Tuner\n        </ToggleButton>\n      </TopSettings>\n\n      {showTuner && <Tuner />}\n      {showDial && (\n        <section className=\"section\">\n          <Dial initialValue={bpm} addDiff={addBPM}>\n            <div className=\"has-text-centered is-size-1\">{bpm}</div>\n            <TempoMarking bpm={bpm} />\n          </Dial>\n        </section>\n      )}\n      <TimeSignature\n        playing={playing}\n        signature={signature}\n        setSignature={setSignature}\n        activeBeats={activeDivisions}\n      />\n\n      <section className=\"section\">\n        <Buttons>\n          <TapIn setBPM={setBPM} />\n          <ToggleButton\n            on={playing}\n            offIsPrimary\n            grow\n            isOutlined\n            isDanger\n            onClick={toggleStart}\n          >\n            <>Stop</>\n            <>Start</>\n          </ToggleButton>\n        </Buttons>\n      </section>\n      {showScales && <Scales startMetronome={start} stopMetronome={stop} />}\n    </InnerBody>\n  );\n};\n\nconst InnerBody = styled.div``;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React, { useState, useEffect } from \"react\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport { Buttons, Button, maxWidth } from \"./Common\";\nimport styled, { keyframes } from \"styled-components\";\n\nconst rotate = keyframes`\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n`;\n\nconst UpdateStyle = styled.section`\n  position: absolute;\n  max-width: ${maxWidth};\n  width: 95%;\n  margin-top: 10px;\n  left: 0;\n  right: 0;\n  margin-left: auto;\n  margin-right: auto;\n  z-index: 10;\n  display: flex !important;\n  justify-content: space-between;\n  animation: ease-in 1s ${rotate};\n`;\n\nexport default () => {\n  const [updateAvailable, setUpdateAvailable] = useState(false);\n\n  const reload = React.useCallback(() => {\n    window.location.reload();\n  }, []);\n\n  const close = React.useCallback(() => {\n    setUpdateAvailable(false);\n  }, []);\n\n  useEffect(() => {\n    serviceWorker.register({\n      onUpdate: () => {\n        setUpdateAvailable(true);\n      }\n    });\n  });\n  return (\n    <>\n      {updateAvailable && (\n        <UpdateStyle className=\"box\">\n          <span>An Update is Available!</span>\n          <Buttons>\n            <Button isPrimary isOutlined onClick={reload}>\n              Refresh\n            </Button>\n            <Button isDanger isOutlined onClick={close}>\n              x\n            </Button>\n          </Buttons>\n        </UpdateStyle>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport Metronome from \"./Metronome\";\nimport { BrowserRouter as Router, Route, Link } from \"react-router-dom\";\nimport Update from \"./Update\";\nimport styled from \"styled-components\";\nimport { maxWidth } from \"./Common\";\n\nconst TopBarWrapper = styled.section`\n  padding-top: 10px;\n  padding-bottom: 10px;\n  margin-bottom: 10px;\n  > h2 {\n    margin: 0 !important;\n  }\n`;\n\nconst TopBar = () => {\n  return (\n    <TopBarWrapper className=\"has-background-primary has-text-light\">\n      <h2 className=\"is-size-2\">(mjh)tronome</h2>\n      <Link style={{ display: \"none\" }} to=\"/\">\n        Home\n      </Link>\n    </TopBarWrapper>\n  );\n};\n\nconst WrapperStyle = styled.div`\n  max-width: ${maxWidth};\n  margin: 0 auto;\n  > * {\n    padding-left: 10px;\n    padding-right: 10px;\n  }\n`;\n\nconst FooterStyle = styled.div`\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 5px;\n`;\n\nconst Wrapper: React.FC = ({ children }) => {\n  return (\n    <WrapperStyle>\n      <Update />\n      <TopBar />\n      {children}\n      <FooterStyle>{`v${process.env.REACT_APP_VERSION}`}</FooterStyle>\n    </WrapperStyle>\n  );\n};\n\nconst App: React.FC = () => {\n  return (\n    <Router basename={process.env.PUBLIC_URL}>\n      <Wrapper>\n        <Route exact path=\"/\" component={Metronome} />\n      </Wrapper>\n    </Router>\n  );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./bulma-overrides.sass\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}